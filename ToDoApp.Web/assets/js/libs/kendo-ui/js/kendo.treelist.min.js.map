{"version":3,"file":"kendo.treelist.min.js","sources":["kendo.treelist.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.treelist',[\n        \"kendo.dom\",\n        \"kendo.data\",\n        \"kendo.columnsorter\",\n        \"kendo.editable\",\n        \"kendo.window\",\n        \"kendo.filtermenu\",\n        \"kendo.columnmenu\",\n        \"kendo.selectable\",\n        \"kendo.resizable\",\n        \"kendo.treeview.draganddrop\",\n        \"kendo.pager\",\n        'kendo.filtercell',\n        'kendo.textbox',\n        'kendo.form'\n    ], f);\n})(function() {\n\nvar __meta__ = {\n    id: \"treelist\",\n    name: \"TreeList\",\n    category: \"web\",\n    description: \"The TreeList widget displays self-referencing data and offers rich support for interacting with data, sorting, filtering, and selection.\",\n    depends: [ \"dom\", \"data\", \"pager\" ],\n    features: [ {\n        id: \"treelist-sorting\",\n        name: \"Sorting\",\n        description: \"Support for column sorting\",\n        depends: [ \"columnsorter\" ]\n    }, {\n        id: \"treelist-filtering\",\n        name: \"Filtering\",\n        description: \"Support for record filtering\",\n        depends: [ \"filtermenu\" ]\n    }, {\n        id: \"treelist-columnmenu\",\n        name: \"Column menu\",\n        description: \"Support for header column menu\",\n        depends: [ \"columnmenu\" ]\n    }, {\n        id: \"treelist-editing\",\n        name: \"Editing\",\n        description: \"Support for record editing\",\n        depends: [ \"editable\", \"window\", \"textbox\", \"form\" ]\n    }, {\n        id: \"treelist-selection\",\n        name: \"Selection\",\n        description: \"Support for row selection\",\n        depends: [ \"selectable\" ]\n    }, {\n        id: \"treelist-column-resize\",\n        name: \"Column resizing\",\n        description: \"Support for column resizing\",\n        depends: [ \"resizable\" ]\n    }, {\n        id: \"treelist-dragging\",\n        name: \"Drag & Drop\",\n        description: \"Support for drag & drop of rows\",\n        depends: [ \"treeview.draganddrop\" ]\n    }, {\n        id: \"treelist-excel-export\",\n        name: \"Excel export\",\n        description: \"Export data as Excel spreadsheet\",\n        depends: [ \"excel\" ]\n    }, {\n        id: \"treelist-pdf-export\",\n        name: \"PDF export\",\n        description: \"Export data as PDF\",\n        depends: [ \"pdf\", \"drawing\" ]\n    }, {\n        id: \"treelist-paging\",\n        name: \"Paging\",\n        description: \"Support for treelist paging\",\n        depends: [ \"pager\" ]\n    } ]\n};\n\n(function($, undefined) {\n    var data = kendo.data;\n    var kendoDom = kendo.dom;\n    var kendoDomElement = kendoDom.element;\n    var kendoTextElement = kendoDom.text;\n    var kendoHtmlElement = kendoDom.html;\n    var outerWidth = kendo._outerWidth;\n    var keys = kendo.keys;\n    var outerHeight = kendo._outerHeight;\n    var ui = kendo.ui;\n    var DataBoundWidget = ui.DataBoundWidget;\n    var DataSource = data.DataSource;\n    var ObservableArray = data.ObservableArray;\n    var Query = data.Query;\n    var Model = data.Model;\n    var browser = kendo.support.browser;\n    var kendoTemplate = kendo.template;\n    var activeElement = kendo._activeElement;\n    var touchDevice = kendo.support.touch;\n\n    var isArray = Array.isArray;\n    var extend = $.extend;\n    var map = $.map;\n    var grep = $.grep;\n    var inArray = $.inArray;\n    var isPlainObject = $.isPlainObject;\n\n    var push = Array.prototype.push;\n\n    var STRING = \"string\";\n    var CHANGE = \"change\";\n    var ITEM_CHANGE = \"itemChange\";\n    var ERROR = \"error\";\n    var PROGRESS = \"progress\";\n    var DOT = \".\";\n    var NS = \".kendoTreeList\";\n    var CLICK = \"click\";\n    var INPUT = \"input\";\n    var BEFORE_EDIT = \"beforeEdit\";\n    var EDIT = \"edit\";\n    var PAGE = \"page\";\n    var PAGE_CHANGE = \"pageChange\";\n    var SAVE = \"save\";\n    var SAVE_CHANGES = \"saveChanges\";\n    var SORT = \"sort\";\n    var EXPAND = \"expand\";\n    var COLLAPSE = \"collapse\";\n    var CELL_CLOSE = \"cellClose\";\n    var REMOVE = \"remove\";\n    var DATA_CELL = \"td:not(.k-group-cell):not(.k-hierarchy-cell):visible\";\n    var FILTER_CELL = \".k-filter-row th:not(.k-group-cell):not(.k-hierarchy-cell):visible\";\n    var DATABINDING = \"dataBinding\";\n    var DATABOUND = \"dataBound\";\n    var CANCEL = \"cancel\";\n    var TABINDEX = \"tabIndex\";\n    var FILTERMENUINIT = \"filterMenuInit\";\n    var FILTERMENUOPEN = \"filterMenuOpen\";\n    var COLUMNHIDE = \"columnHide\";\n    var COLUMNSHOW = \"columnShow\";\n    var HEADERCELLS = \"th.k-header\";\n    var COLUMNREORDER = \"columnReorder\";\n    var COLUMNRESIZE = \"columnResize\";\n    var COLUMNMENUINIT = \"columnMenuInit\";\n    var COLUMNMENUOPEN = \"columnMenuOpen\";\n    var COLUMNLOCK = \"columnLock\";\n    var COLUMNUNLOCK = \"columnUnlock\";\n    var PARENTIDFIELD = \"parentId\";\n    var DRAGSTART = \"dragstart\";\n    var DRAG = \"drag\";\n    var DROP = \"drop\";\n    var DRAGEND = \"dragend\";\n    var NAVROW = \"tr:visible\";\n    var NAVCELL = \"td:visible\";\n    var NAVHEADER = \"th:visible\";\n    var NORECORDSCLASS = \"k-grid-norecords\";\n    var ITEMROW = \"tr:not(.k-footer-template):visible\";\n    var isRtl = false;\n    var HEIGHT = \"height\";\n    var INCELL = \"incell\";\n    var INLINE = \"inline\";\n    var POPUP = \"popup\";\n    var TABLE = \"table\";\n    var CHECKBOX = \"k-checkbox\";\n    var CHECKBOXINPUT = \"input[data-role='checkbox'].\" + CHECKBOX;\n    var SELECTCOLUMNTMPL = '<input class=\"' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select row\" aria-checked=\"false\" type=\"checkbox\">';\n    var SELECTCOLUMNHEADERTMPL = '<input class=\"' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select all rows\" aria-checked=\"false\" type=\"checkbox\">';\n    var SELECTED = \"k-selected\";\n    var whitespaceRegExp = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\";\n    var filterRowRegExp = new RegExp(\"(^|\" + whitespaceRegExp + \")\" + \"(k-filter-row)\" + \"(\" + whitespaceRegExp + \"|$)\");\n\n    var classNames = {\n        wrapper: \"k-treelist k-grid k-widget k-grid-display-block\",\n        header: \"k-header\",\n        button: \"k-button\",\n        alt: \"k-alt\",\n        editCell: \"k-edit-cell\",\n        editRow: \"k-grid-edit-row\",\n        dirtyCell: \"k-dirty-cell\",\n        group: \"k-treelist-group\",\n        toolbar: \"k-toolbar\",\n        gridToolbar: \"k-grid-toolbar\",\n        gridHeader: \"k-grid-header\",\n        gridHeaderWrap: \"k-grid-header-wrap\",\n        gridContent: \"k-grid-content\",\n        gridContentWrap: \"k-grid-content\",\n        gridFilter: \"k-grid-filter\",\n        footerTemplate: \"k-footer-template\",\n        focused: \"k-focus\",\n        loading: \"k-i-loading\",\n        refresh: \"k-i-reload\",\n        retry: \"k-request-retry\",\n        selected: \"k-selected\",\n        status: \"k-status\",\n        link: \"k-link\",\n        filterable: \"k-filterable\",\n        icon: \"k-icon\",\n        iconFilter: \"k-i-filter\",\n        iconCollapse: \"k-i-collapse\",\n        iconExpand: \"k-i-expand\",\n        iconHidden: \"k-i-none\",\n        iconPlaceHolder: \"k-icon k-i-none\",\n        input: \"k-input\",\n        dropPositions: \"k-i-insert-up k-i-insert-down k-i-plus k-i-insert-middle\",\n        dropTop: \"k-i-insert-up\",\n        dropBottom: \"k-i-insert-down\",\n        dropAdd: \"k-i-plus\",\n        dropMiddle: \"k-i-insert-middle\",\n        dropDenied: \"k-i-cancel\",\n        dragStatus: \"k-drag-status\",\n        dragClue: \"k-drag-clue\",\n        dragClueText: \"k-clue-text\",\n        headerCellInner: \"k-cell-inner\",\n        columnTitle: \"k-column-title\"\n    };\n\n    var defaultCommands = {\n        create: {\n            imageClass: \"k-i-plus\",\n            className: \"k-grid-add\",\n            methodName: \"addRow\"\n        },\n        createchild: {\n            imageClass: \"k-i-plus\",\n            className: \"k-grid-add\",\n            methodName: \"addRow\"\n        },\n        destroy: {\n            imageClass: \"k-i-close\",\n            className: \"k-grid-delete\",\n            methodName: \"removeRow\"\n        },\n        edit: {\n            imageClass: \"k-i-edit\",\n            className: \"k-grid-edit\",\n            methodName: \"editRow\"\n        },\n        update: {\n            imageClass: \"k-i-check\",\n            className: \"k-button-solid-primary k-grid-update\",\n            methodName: \"saveRow\"\n        },\n        canceledit: {\n            imageClass: \"k-i-cancel\",\n            className: \"k-grid-cancel\",\n            methodName: \"_cancelEdit\"\n        },\n        cancel: {\n            imageClass: \"k-icon k-i-cancel\",\n            text: \"Cancel changes\",\n            className: \"k-grid-cancel-changes\",\n            methodName: \"cancelChanges\"\n        },\n        save: {\n            imageClass: \"k-icon k-i-check\",\n            text: \"Save changes\",\n            className: \"k-grid-save-changes\",\n            methodName: \"saveChanges\"\n        },\n        excel: {\n            imageClass: \"k-i-file-excel\",\n            className: \"k-grid-excel\",\n            methodName: \"saveAsExcel\"\n        },\n        pdf: {\n            imageClass: \"k-i-file-pdf\",\n            className: \"k-grid-pdf\",\n            methodName: \"saveAsPDF\"\n        },\n        search: {\n            template:\n            \"<span class='k-spacer'></span>\" +\n            \"<span class='k-searchbox k-input k-input-md k-rounded-md k-input-solid k-grid-search'>\" +\n                \"<span class='k-input-icon k-icon k-i-search'></span>\" +\n                \"<input autocomplete='off' placeholder='\" + \"#= message #\" + \"' title='\" + \"#= message #\" + \"' class='k-input-inner' />\" +\n            \"</span>\"\n        }\n    };\n\n    var TreeView = kendo.Class.extend({\n        init: function(data, options) {\n            var that = this;\n\n            that.data = data || [];\n            that.options = extend(that.options, options);\n        },\n\n        options: {\n            defaultParentId: null,\n            idField: \"id\",\n            parentIdField: PARENTIDFIELD\n        },\n\n        childrenMap: function() {\n            var that = this;\n            var childrenMap = {};\n            var dataLength = that.data.length;\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n            var idField = that.options.idField;\n            var parentIdField = that.options.parentIdField;\n\n            if (that._childrenMap) {\n                return that._childrenMap;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = this.data[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n\n                childrenMap[dataItemId] = childrenMap[dataItemId] || [];\n                childrenMap[dataItemParentId] = childrenMap[dataItemParentId] || [];\n\n                childrenMap[dataItemParentId].push(dataItem);\n            }\n\n            that._childrenMap = childrenMap;\n\n            return childrenMap;\n        },\n\n        idsMap: function() {\n            var that = this;\n            var idsMap = {};\n            var data = that.data;\n            var dataLength = data.length;\n            var dataItem;\n            var idField = that.options.idField;\n\n            if (that._idMap) {\n                return that._idMap;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n                idsMap[dataItem[idField]] = dataItem;\n            }\n\n            that.idsMap = idsMap;\n            return idsMap;\n        },\n\n        dataMaps: function() {\n            var that = this;\n            var childrenMap = {};\n            var data = that.data;\n            var dataLength = data.length;\n            var idsMap = {};\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n            var idField = that.options.idField;\n            var parentIdField = that.options.parentIdField;\n\n            if (that._dataMaps) {\n                return that._dataMaps;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n\n                idsMap[dataItemId] = dataItem;\n\n                childrenMap[dataItemId] = childrenMap[dataItemId] || [];\n                childrenMap[dataItemParentId] = childrenMap[dataItemParentId] || [];\n                childrenMap[dataItemParentId].push(dataItem);\n            }\n\n            that._dataMaps = {\n                children: childrenMap,\n                ids: idsMap\n            };\n\n            return that._dataMaps;\n        },\n\n        rootNodes: function() {\n            var that = this;\n            var data = that.data;\n            var defaultParentId = that.options.defaultParentId;\n            var dataLength = data.length;\n            var rootNodes = [];\n            var dataItem;\n            var parentIdField = that.options.parentIdField;\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n\n                if (dataItem[parentIdField] === defaultParentId) {\n                    rootNodes.push(dataItem);\n                }\n            }\n\n            return rootNodes;\n        },\n\n        removeCollapsedSubtreesFromRootNodes: function(options) {\n            options = options || {};\n            var that = this;\n            var rootNodes = that.rootNodes();\n            var result = [];\n            var prunedTree;\n\n            that._childrenMap = options.childrenMap = options.childrenMap || that.childrenMap();\n            options.maxDepth = options.maxDepth || Infinity;\n\n            for (var i = 0; i < rootNodes.length; i++) {\n                prunedTree = that.removeCollapsedSubtrees(rootNodes[i], options);\n                result = result.concat(prunedTree);\n            }\n\n            return result;\n        },\n\n        removeCollapsedSubtrees: function(rootNode, options) {\n            options = options || {};\n            var that = this;\n            var result = [];\n            var childIdx;\n            var prunedTree;\n            var childrenMap = options.childrenMap || {};\n            var maxDepth = options.maxDepth || Infinity;\n            var idField = that.options.idField;\n            var children = childrenMap[rootNode[idField]] || [];\n            var expanded = isUndefined(rootNode.expanded) ? options.expanded : rootNode.expanded;\n\n            result.push(rootNode);\n\n            if (children && expanded) {\n                for (childIdx = 0; childIdx < children.length; childIdx++) {\n                    if (result.length >= maxDepth) {\n                        break;\n                    }\n\n                    prunedTree = that.removeCollapsedSubtrees(children[childIdx], options);\n                    result = result.concat(prunedTree);\n                }\n            }\n\n            return result;\n        }\n    });\n\n    var TreeQuery = function(data) {\n        this.data = data || [];\n    };\n\n    TreeQuery.prototype = new Query();\n    TreeQuery.prototype.constructor = TreeQuery;\n\n    TreeQuery.process = function(data, options, inPlace) {\n        options = options || {};\n        var query = new TreeQuery(data);\n        var group = options.group;\n        var sort = Query.normalizeGroup(group || []).concat(Query.normalizeSort(options.sort || []));\n        var filterCallback = options.filterCallback;\n        var filter = options.filter;\n        var skip = options.skip;\n        var take = options.take;\n        var total;\n        var childrenMap;\n        var filteredChildrenMap;\n        var view;\n        var prunedData;\n\n        if (sort && inPlace) {\n            query = query.sort(sort, undefined, undefined, inPlace);\n        }\n\n        if (filter) {\n            query = query.filter(filter);\n\n            if (filterCallback) {\n                query = filterCallback(query);\n            }\n\n            total = query.toArray().length;\n        }\n\n        if (sort && !inPlace) {\n            query = query.sort(sort);\n\n            if (group) {\n                data = query.toArray();\n            }\n        }\n\n        if (options.processFromRootNodes) {\n            view = new TreeView(query.toArray(), options);\n\n            if (filter) {\n                filteredChildrenMap = view.childrenMap();\n            }\n\n            prunedData = view.removeCollapsedSubtreesFromRootNodes({\n                // filtering or sorting requires changes to childrenMap\n                childrenMap: filter || (sort && sort.length) ? undefined : options.childrenMap,\n                expanded: options.expanded,\n                maxDepth: (skip + take) || Infinity\n            });\n\n            childrenMap = view.childrenMap();\n\n            query = new TreeQuery(prunedData);\n        }\n\n        if (skip !== undefined && take !== undefined) {\n            query = query.range(skip, take);\n        }\n\n        if (group) {\n            query = query.group(group, data);\n        }\n\n        return {\n            total: total,\n            data: query.toArray(),\n            childrenMap: childrenMap,\n            filteredChildrenMap: filteredChildrenMap\n        };\n    };\n\n    var TreeListModel = Model.define({\n        id: \"id\",\n\n        parentId: PARENTIDFIELD,\n\n        fields: {\n            id: { type: \"number\" },\n            parentId: { type: \"number\", nullable: true }\n        },\n\n        init: function(value) {\n            Model.fn.init.call(this, value);\n\n            this._loaded = false;\n\n            if (!this.parentIdField) {\n                this.parentIdField = PARENTIDFIELD;\n            }\n\n            this.parentId = this.get(this.parentIdField);\n        },\n\n        accept: function(data) {\n            Model.fn.accept.call(this, data);\n\n            this.parentId = this.get(this.parentIdField);\n        },\n\n        set: function(field, value, initiator) {\n            if (field == PARENTIDFIELD && this.parentIdField != PARENTIDFIELD) {\n                this[this.parentIdField] = value;\n            }\n\n            Model.fn.set.call(this, field, value, initiator);\n\n            if (field == this.parentIdField) {\n                this.parentId = this.get(this.parentIdField);\n            }\n        },\n\n        loaded: function(value) {\n            if (value !== undefined) {\n                this._loaded = value;\n            } else {\n                return this._loaded;\n            }\n        },\n\n        shouldSerialize: function(field) {\n            return Model.fn.shouldSerialize.call(this, field) && field !== \"_loaded\" && field != \"_error\" && field != \"_edit\" && !(this.parentIdField !== \"parentId\" && field === \"parentId\");\n        }\n    });\n\n    TreeListModel.parentIdField = PARENTIDFIELD;\n\n    TreeListModel.define = function(base, options) {\n        if (options === undefined) {\n            options = base;\n            base = TreeListModel;\n        }\n\n        var parentId = options.parentId || PARENTIDFIELD;\n\n        options.parentIdField = parentId;\n\n        var model = Model.define(base, options);\n\n        if (parentId) {\n            model.parentIdField = parentId;\n        }\n\n        return model;\n    };\n\n    function is(field) {\n        return function(object) {\n            return object[field];\n        };\n    }\n\n    function not(func) {\n        return function(object) {\n            return !func(object);\n        };\n    }\n\n    var TreeListDataSource = DataSource.extend({\n        init: function(options) {\n            options = options || {};\n            var that = this;\n            that._dataMaps = that._getDataMaps();\n\n            options.schema = extend(true, {}, {\n                modelBase: TreeListModel,\n                model: TreeListModel\n            }, options.schema);\n\n            DataSource.fn.init.call(this, options);\n        },\n\n        _addRange: function() {\n            // empty override for performance - the treelist does not support virtualization\n        },\n\n        _createNewModel: function(data) {\n            var that = this;\n            var model = {};\n            var fromModel = data instanceof Model;\n            var parentIdField = this._modelParentIdField();\n\n            if (fromModel) {\n                model = data;\n            }\n\n            model = DataSource.fn._createNewModel.call(this, model);\n\n            if (!fromModel) {\n                if (data.parentId) {\n                    data[model.parentIdField] = data.parentId;\n                } else if (that._isPageable() && data[parentIdField]) {\n                    data[model.parentIdField] = data[parentIdField];\n                }\n\n                model.accept(data);\n            }\n\n            return model;\n        },\n\n        _shouldWrap: function() {\n            return true;\n        },\n\n        _push: function(result, operation) {\n            var data = DataSource.fn._readData.call(this, result);\n\n            if (!data) {\n                data = result;\n            }\n\n            this[operation](data);\n        },\n\n        _getData: function() {\n            // do not use .data(), which wraps the data items\n            return this._data || [];\n        },\n\n        _readData: function(newData) {\n            var that = this;\n            var data = that._isPageable() ? that._getData().toJSON() : that.data();\n\n            newData = DataSource.fn._readData.call(this, newData);\n\n            this._replaceData(((data.toJSON ? data.toJSON() : data)).concat(newData), data);\n\n            if (newData instanceof ObservableArray) {\n                return newData;\n            }\n\n            return data;\n        },\n\n        _replaceData: function(source, target) {\n            var sourceLength = source.length;\n\n            for (var i = 0; i < sourceLength; i++) {\n                target[i] = source[i];\n            }\n\n            target.length = sourceLength;\n        },\n\n        _readAggregates: function(data) {\n            var result = extend(this._aggregateResult, this.reader.aggregates(data));\n            if (\"\" in result) {\n                result[this._defaultParentId()] = result[\"\"];\n                delete result[\"\"];\n            }\n\n            return result;\n        },\n\n        read: function(data) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._dataMaps = {};\n                if (!that._modelOptions().expanded) {\n                    that._skip = 0;\n                    that._page = 1;\n                    that._collapsedTotal = undefined;\n                }\n            }\n\n            return DataSource.fn.read.call(that, data);\n        },\n\n        remove: function(root) {\n            this._removeChildData(root);\n\n            this._removeFromDataMaps(root);\n\n            return DataSource.fn.remove.call(this, root);\n        },\n\n        _removeChildData: function(model, removePristine) {\n            var that = this;\n            var pageable = that._isPageable();\n            var data = pageable ? this._getData() : this.data();\n            var childrenMap = pageable ? that._getChildrenMap() || that.childrenMap(data) : that._childrenMap(data);\n            var items = this._subtree(childrenMap, model.id);\n            var shouldRemovePristine = isUndefined(removePristine) ? false : removePristine;\n\n            var removedItems = this._removeItems(items, shouldRemovePristine);\n\n            that._removeFromDataMaps(removedItems);\n        },\n\n        pushDestroy: function(items) {\n            var that = this;\n\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            for (var i = 0; i < items.length; i++) {\n                that._removeChildData(items[i], true);\n                that._removeFromDataMaps(items[i]);\n            }\n\n            DataSource.fn.pushDestroy.call(that, items);\n        },\n\n        insert: function(index, model) {\n            var that = this;\n            var newModel = that._createNewModel(model);\n\n            that._insertInDataMaps(newModel);\n\n            return DataSource.fn.insert.call(that, index, newModel);\n        },\n\n        _filterCallback: function(query) {\n            var that = this;\n            var i, item;\n            var map = {};\n            var result = [];\n            var data = query.toArray();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var pageable = that._isPageable();\n            var parentSubtree = [];\n            var parent;\n\n            for (i = 0; i < data.length; i++) {\n                item = data[i];\n\n                if (pageable) {\n                    // return view from root nodes to child nodes\n                    parentSubtree = [];\n\n                    if (!map[item[idField]]) {\n                        map[item[idField]] = true;\n                        parentSubtree.push(item);\n                    }\n\n                    parent = that._parentNode(item);\n\n                    while (parent) {\n                        if (!map[parent[idField]]) {\n                            map[parent[idField]] = true;\n                            parentSubtree.unshift(parent);\n                            parent = that._parentNode(parent);\n                        } else {\n                            // the parent chain is already processed\n                            break;\n                        }\n                    }\n\n                    if (parentSubtree.length) {\n                        result = result.concat(parentSubtree);\n                    }\n                } else {\n                    while (item) {\n                        if (!map[item[idField]]) {\n                            map[item[idField]] = true;\n                            result.push(item);\n                        }\n\n                        if (!map[item[parentIdField]]) {\n                            map[item[parentIdField]] = true;\n                            item = this.parentNode(item);\n\n                            if (item) {\n                                result.push(item);\n                            }\n                        } else {\n                            break;\n                        }\n                    }\n                }\n            }\n\n            return new Query(result);\n        },\n\n        _subtree: function(map, id) {\n            var that = this;\n            var result = map[id] || [];\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n\n            for (var i = 0, len = result.length; i < len; i++) {\n                if (result[i][idField] !== defaultParentId) {\n                    result = result.concat(that._subtree(map, result[i][idField]));\n                }\n            }\n\n            return result;\n        },\n\n        // builds hash id -> children\n        _childrenMap: function(data) {\n            var map = {};\n            var i, item, id, parentId;\n\n            data = this._observeView(data);\n\n            for (i = 0; i < data.length; i++) {\n                item = data[i];\n                id = item.id;\n                parentId = item.parentId;\n\n                map[id] = map[id] || [];\n                map[parentId] = map[parentId] || [];\n                map[parentId].push(item);\n            }\n\n            return map;\n        },\n\n        childrenMap: function(data) {\n            var view = this._createTreeView(data);\n            var map = view.childrenMap();\n            return map;\n        },\n\n        _getChildrenMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.children;\n        },\n\n        _initIdsMap: function(data) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n\n            if (isUndefined(dataMaps.ids)) {\n                dataMaps.ids = that._idsMap(data);\n            }\n\n            return dataMaps.ids;\n        },\n\n        _idsMap: function(data) {\n            var view = this._createTreeView(data);\n            var map = view.idsMap();\n            return map;\n        },\n\n        _getIdsMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.ids || {};\n        },\n\n        _getFilteredChildrenMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.filteredChildren;\n        },\n\n        _setFilteredChildrenMap: function(map) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            dataMaps.filteredChildren = map;\n        },\n\n        _initDataMaps: function(data) {\n            var that = this;\n            var view = that._createTreeView(data);\n\n            that._dataMaps = view.dataMaps();\n\n            return that._dataMaps;\n        },\n\n        _initChildrenMapForParent: function(parent) {\n            var that = this;\n            var data = that._getData();\n            var childrenMap = that._getChildrenMap();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var parentId = (parent || {})[idField];\n\n            if (childrenMap && parent) {\n                childrenMap[parentId] = [];\n\n                for (var i = 0; i < data.length; i++) {\n                    if (data[i][parentIdField] === parentId) {\n                        childrenMap[parentId].push(data[i]);\n                    }\n                }\n            }\n        },\n\n        _getDataMaps: function() {\n            var that = this;\n            that._dataMaps = that._dataMaps || {};\n            return that._dataMaps;\n        },\n\n        _createTreeView: function(data, options) {\n            var view = new TreeView(data, extend(options, this._defaultTreeModelOptions()));\n            return view;\n        },\n\n        _defaultTreeModelOptions: function() {\n            var that = this;\n            var modelOptions = that._modelOptions();\n\n            return {\n                defaultParentId: that._defaultParentId(),\n                idField: that._modelIdField(),\n                parentIdField: that._modelParentIdField(),\n                expanded: modelOptions.expanded\n            };\n        },\n\n        _defaultDataItemType: function() {\n            return this.reader.model || kendo.data.ObservableObject;\n        },\n\n        _calculateAggregates: function(data, options) {\n            options = options || {};\n            var that = this;\n            var result = {};\n            var item, subtree, i;\n            var filter = options.filter;\n            var skip = options.skip;\n            var take = options.take;\n            var maxDepth = !isUndefined(skip) && !isUndefined(take) ? (skip + take) : Infinity;\n            var pageable = that._isPageable();\n            var filteredChildrenMap = options.filteredChildrenMap;\n            var childrenMap = options.childrenMap;\n            var pageableChildrenMap;\n\n            if (pageable) {\n                if (isUndefined(options.aggregate)) {\n                    return result;\n                }\n\n                if (filteredChildrenMap) {\n                    pageableChildrenMap = filteredChildrenMap;\n                } else if (childrenMap) {\n                    pageableChildrenMap = childrenMap;\n                } else {\n                    pageableChildrenMap = that.childrenMap(that._getData());\n                }\n            }\n\n            if (!pageable && filter) {\n                data = Query.process(data, {\n                    filter: filter,\n                    filterCallback: this._filterCallback.bind(this)\n                }).data;\n            }\n\n            var map = pageable ? pageableChildrenMap : that._childrenMap(data);\n\n            // calculate aggregates for each subtree\n            result[this._defaultParentId()] = new Query(this._subtree(map, this._defaultParentId())).aggregate(options.aggregate);\n\n            for (i = 0; i < data.length; i++) {\n                if (i >= maxDepth) {\n                    break;\n                }\n\n                item = data[i];\n                subtree = this._subtree(map, item.id);\n\n                result[item.id] = new Query(subtree).aggregate(options.aggregate);\n            }\n\n            return result;\n        },\n\n        _queryProcess: function(data, options) {\n            var that = this;\n            var result = {};\n            options = options || {};\n            options.filterCallback = this._filterCallback.bind(this);\n\n            if (that._isPageable()) {\n                return that._processPageableQuery(data, options);\n            } else {\n                var defaultParentId = this._defaultParentId();\n                result = Query.process(data, options);\n                var map = this._childrenMap(result.data);\n                var hasLoadedChildren, i, item, children;\n\n                data = map[defaultParentId] || [];\n\n                for (i = 0; i < data.length; i++) {\n                    item = data[i];\n\n                    if (item.id === defaultParentId) {\n                        continue;\n                    }\n\n                    children = map[item.id];\n                    hasLoadedChildren = !!(children && children.length);\n\n                    if (!item.loaded()) {\n                        item.loaded(hasLoadedChildren || !item.hasChildren);\n                    }\n\n                    if (item.loaded() || item.hasChildren !== true) {\n                        item.hasChildren = hasLoadedChildren;\n                    }\n\n                    if (hasLoadedChildren) {\n                        //cannot use splice due to IE8 bug\n                        data = data.slice(0, i + 1).concat(children, data.slice(i + 1));\n                    }\n                }\n\n                result.data = data;\n            }\n\n            return result;\n        },\n\n        _processPageableQuery: function(data, options) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            var result;\n            var filteredChildrenMap;\n\n            if (that._getData() !== data || !dataMaps.children || !dataMaps.ids) {\n                dataMaps = that._initDataMaps(that._getData());\n            }\n\n            options.childrenMap = dataMaps.children || {};\n            options.idsMap = dataMaps.ids || {};\n\n            result = that._processTreeQuery(data, options);\n\n            that._replaceWithObservedData(result.data, data);\n\n            that._processDataItemsState(result.data, result.childrenMap);\n\n            that._replaceItemsInDataMaps(result.data);\n\n            result.dataToAggregate = that._dataToAggregate(result.data, options);\n\n            if (options.filter || that.filter()) {\n                filteredChildrenMap = result.filteredChildrenMap;\n                that._replaceInMapWithObservedData(filteredChildrenMap, data);\n                that._setFilteredChildrenMap(filteredChildrenMap);\n                options.filteredChildrenMap = filteredChildrenMap;\n                that._calculateCollapsedTotal(result.data);\n            } else {\n                that._collapsedTotal = undefined;\n            }\n\n            return result;\n        },\n\n        _dataToAggregate: function(data) {\n            var that = this;\n            var firstDataItem = data[0] || {};\n            var firstItemParents = that._parentNodes(firstDataItem);\n            var dataToAggregate = firstItemParents.concat(data);\n\n            return dataToAggregate;\n        },\n\n        _replaceItemsInDataMaps: function(observableArray) {\n            var that = this;\n            var view = isArray(observableArray) ? observableArray : [observableArray];\n            var itemType = that._defaultDataItemType();\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var dataMaps = that._getDataMaps();\n            var item;\n            var parents;\n            var directParent;\n\n            for (var viewIndex = 0; viewIndex < view.length; viewIndex++) {\n                item = view[viewIndex];\n\n                if (!(item instanceof itemType)) {\n                    continue;\n                }\n\n                that._insertInIdsMap(item);\n\n                parents = that._parentNodes(item);\n                directParent = parents && parents.length ? parents[parents.length - 1] : undefined;\n\n                if (item[parentIdField] === defaultParentId) {\n                    that._replaceInMap(dataMaps.children, defaultParentId, item, itemType);\n                } else if (directParent) {\n                    that._replaceInMap(dataMaps.children, directParent[idField], item, itemType);\n                }\n            }\n        },\n\n        _replaceInMap: function(map, id, replacement, itemType) {\n            var idField = this._modelIdField();\n            map[id] = map[id] || [];\n            itemType = itemType || this._defaultDataItemType();\n\n            var itemInArray = map[id].filter(function(element) {\n                return replacement[idField] === element[idField];\n            })[0];\n\n            var itemIndex = itemInArray ? map[id].indexOf(itemInArray) : -1;\n\n            if (itemIndex !== -1 && !(itemInArray instanceof itemType)) {\n                map[id][itemIndex] = replacement;\n            }\n        },\n\n        _replaceWithObservedData: function(dataToReplace, replacementArray) {\n            var that = this;\n            var idsMap = that._getDataMaps().ids || {};\n            var idField = that._modelIdField();\n            var itemType = that._defaultDataItemType();\n            var itemToReplace;\n            var itemToReplaceId;\n            var dataItem;\n            var dataItemIndex;\n            var observableItem;\n\n            for (var i = 0; i < dataToReplace.length; i++) {\n                itemToReplace = dataToReplace[i];\n                itemToReplaceId = itemToReplace[idField];\n\n                if (!(itemToReplace instanceof itemType)) {\n                    if (!(idsMap[itemToReplaceId] instanceof itemType)) {\n                        dataItem = that._getById(itemToReplaceId);\n                        dataItemIndex = replacementArray.indexOf(dataItem);\n\n                        if (dataItem && dataItemIndex !== -1) {\n                            observableItem = replacementArray.at(dataItemIndex);\n                            dataToReplace[i] = observableItem;\n                        }\n                    } else {\n                        dataToReplace[i] = idsMap[itemToReplaceId];\n                    }\n                }\n            }\n        },\n\n        _replaceInMapWithObservedData: function(map, replacementArray) {\n            var that = this;\n\n            for (var key in map) {\n                that._replaceWithObservedData(map[key], replacementArray);\n            }\n        },\n\n        _insertInDataMaps: function(item) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._insertInIdsMap(item);\n                that._insertInChildrenMap(item);\n            }\n        },\n\n        _insertInIdsMap: function(item) {\n            var that = this;\n            var idsMap = that._getIdsMap();\n            var idField = that._modelIdField();\n\n            if (!isUndefined(item[idField])) {\n                idsMap[item[idField]] = item;\n            }\n        },\n\n        _insertInChildrenMap: function(item, index) {\n            var that = this;\n            var childrenMap = that._getChildrenMap() || {};\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var itemId = item[idField];\n            var parentId = item[parentIdField];\n            index = index || 0;\n\n            childrenMap[itemId] = childrenMap[itemId] || [];\n            childrenMap[parentId] = childrenMap[parentId] || [];\n            childrenMap[parentId].splice(index, 0, item);\n        },\n\n        _removeFromDataMaps: function(items) {\n            var that = this;\n            items = isArray(items) ? items : [items];\n\n            if (that._isPageable()) {\n                for (var i = 0; i < items.length; i++) {\n                    that._removeFromIdsMap(items[i]);\n                    that._removeFromChildrenMap(items[i]);\n                }\n            }\n        },\n\n        _removeFromIdsMap: function(item) {\n            var that = this;\n            var idsMap = that._getIdsMap();\n            var idField = that._modelIdField();\n\n            if (!isUndefined(item[idField])) {\n                idsMap[item[idField]] = undefined;\n            }\n        },\n\n        _removeFromChildrenMap: function(item) {\n            var that = this;\n            var childrenMap = that._getChildrenMap() || {};\n            var parentIdField = that._modelParentIdField();\n            var parentId = item[parentIdField];\n\n            childrenMap[parentId] = childrenMap[parentId] || [];\n\n            var itemIndex = that._indexInChildrenMap(item);\n\n            if (itemIndex !== -1) {\n                childrenMap[parentId].splice(itemIndex, 1);\n            }\n        },\n\n        _indexInChildrenMap: function(item) {\n            var that = this;\n            return that._itemIndexInMap(item, that._getChildrenMap());\n        },\n\n        _itemIndexInMap: function(item, dataMap) {\n            var that = this;\n            var map = dataMap || {};\n            var parentIdField = that._modelParentIdField();\n            var parentId = item[parentIdField];\n\n            map[parentId] = map[parentId] || [];\n\n            var itemInArray = map[parentId].filter(function(element) {\n                return item.uid === element.uid;\n            })[0];\n\n            var itemIndex = itemInArray ? map[parentId].indexOf(itemInArray) : -1;\n\n            return itemIndex;\n        },\n\n        _getById: function(id) {\n            var that = this;\n            var idField = that._modelIdField();\n            var data = that._getData();\n\n            for (var i = 0; i < data.length; i++) {\n                if (data[i][idField] === id) {\n                    return data[i];\n                }\n            }\n        },\n\n        _isLastItemInView: function(dataItem) {\n            var view = this.view();\n            return view.length && view[view.length - 1] === dataItem;\n        },\n\n        _defaultPageableQueryOptions: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            var options = {\n                skip: that.skip(),\n                take: that.take(),\n                page: that.page(),\n                pageSize: that.pageSize(),\n                sort: that.sort(),\n                filter: that.filter(),\n                group: that.group(),\n                aggregate: that.aggregate(),\n                filterCallback: that._filterCallback.bind(that),\n                childrenMap: dataMaps.children,\n                idsMap: dataMaps.ids\n            };\n\n            return options;\n        },\n\n        _isPageable: function() {\n            var pageSize = this.pageSize();\n            return (!isUndefined(pageSize) && pageSize > 0 && !this.options.serverPaging);\n        },\n\n        _updateTotalForAction: function(action, items) {\n            var that = this;\n\n            DataSource.fn._updateTotalForAction.call(that, action, items);\n\n            if (that._isPageable()) {\n                that._updateCollapsedTotalForAction(action, items);\n            }\n        },\n\n        _updateCollapsedTotalForAction: function(action, items) {\n            var that = this;\n            var total = parseInt(that._collapsedTotal, 10);\n\n            if (!isNumber(that._collapsedTotal)) {\n                that._calculateCollapsedTotal();\n                return;\n            }\n\n            if (action === \"add\") {\n                total += items.length;\n            } else if (action === \"remove\") {\n                total -= items.length;\n            } else if (action !== \"itemchange\" && action !== \"sync\" && !that.options.serverPaging) {\n                total = that._calculateCollapsedTotal();\n            } else if (action === \"sync\") {\n                total = that._calculateCollapsedTotal();\n            }\n\n            that._collapsedTotal = total;\n        },\n\n        _setFilterTotal: function(filterTotal, setDefaultValue) {\n            var that = this;\n\n            DataSource.fn._setFilterTotal.call(that, filterTotal, setDefaultValue);\n\n        },\n\n        collapsedTotal: function() {\n            var that = this;\n\n            if (!isUndefined(that._collapsedTotal)) {\n                return that._collapsedTotal;\n            }\n\n            return that._calculateCollapsedTotal();\n        },\n\n        _calculateCollapsedTotal: function(filteredData) {\n            var that = this;\n            var data = that._dataWithoutCollapsedSubtrees(filteredData);//\n\n            if (data.length) {\n                that._collapsedTotal = data.length;\n            }\n\n            return that._collapsedTotal;\n        },\n\n        _dataWithoutCollapsedSubtrees: function(filteredData) {\n            return this._removeCollapsedSubtrees(filteredData || this._getData());\n        },\n\n        _removeCollapsedSubtrees: function(data) {\n            var that = this;\n            var view = that._createTreeView(data);\n            var result = view.removeCollapsedSubtreesFromRootNodes({\n                expanded: that._modelOptions().expanded,\n                childrenMap: that.filter() ? that._getFilteredChildrenMap() : that._getChildrenMap()\n            });\n\n            return result;\n        },\n\n        _processTreeQuery: function(data, options) {\n            var result = TreeQuery.process(data, extend(options, this._defaultTreeModelOptions(), {\n                processFromRootNodes: true\n            }));\n\n            return result;\n        },\n\n        _processDataItemsState: function(data, childrenMap) {\n            var dataLength = data.length;\n            var i;\n\n            for (i = 0; i < dataLength; i++) {\n                this._processDataItemState(data[i], childrenMap);\n            }\n        },\n\n        _processDataItemState: function(dataItem, childrenMap) {\n            var defaultParentId = this._defaultParentId();\n\n            if (dataItem.id === defaultParentId) {\n                return;\n            }\n\n            var children = childrenMap[dataItem.id] || [];\n            var hasLoadedChildren = !!(children && children.length);\n\n            if (!dataItem.loaded) {\n                return;\n            }\n\n            if (!dataItem.loaded()) {\n                dataItem.loaded(hasLoadedChildren || !dataItem.hasChildren);\n            }\n\n            if (dataItem.loaded() || dataItem.hasChildren !== true) {\n                dataItem.hasChildren = hasLoadedChildren;\n            }\n        },\n\n        _queueRequest: function(options, callback) {\n            // allow simultaneous requests (loading multiple items at the same time)\n            callback.call(this);\n        },\n\n        _modelLoaded: function(id) {\n            var model = this.get(id);\n            model.loaded(true);\n            model.hasChildren = this.childNodes(model).length > 0;\n        },\n\n        _modelError: function(id, e) {\n            this.get(id)._error = e;\n        },\n\n        success: function(data, requestParams) {\n            if (!requestParams || typeof requestParams.id == \"undefined\") {\n                this._data = this._observe([]);\n            }\n\n            DataSource.fn.success.call(this, data, requestParams);\n\t\t\tthis._total = this._data.length;\n        },\n\n        load: function(model) {\n            var method = \"_query\";\n            var remote = this.options.serverSorting || this.options.serverPaging || this.options.serverFiltering || this.options.serverGrouping || this.options.serverAggregates;\n            var defaultPromise = $.Deferred().resolve().promise();\n\n            if (model.loaded()) {\n                if (remote) {\n                    return defaultPromise;\n                }\n            } else if (model.hasChildren) {\n                method = \"read\";\n                this._removeChildData(model);\n            }\n\n            return this[method]({ id: model.id })\n                .done(this._modelLoaded.bind(this, model.id))\n                .fail(this._modelError.bind(this, model.id));\n        },\n\n        contains: function(root, child) {\n            var that = this;\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var rootId = root[idField];\n            var pageable = that._isPageable();\n\n            while (child) {\n                if (child[parentIdField] === rootId) {\n                    return true;\n                }\n\n                child = pageable ? that._parentNode(child) : that.parentNode(child);\n            }\n\n            return false;\n        },\n\n        _byParentId: function(id, defaultId) {\n            var result = [];\n            var view = this.view();\n            var current;\n\n            if (id === defaultId) {\n                return [];\n            }\n\n            for (var i = 0; i < view.length; i++) {\n                current = view.at(i);\n\n                if (current.parentId == id) {\n                    result.push(current);\n                }\n            }\n\n            return result;\n        },\n\n        _defaultParentId: function() {\n            return this.reader.model.fn.defaults[this.reader.model.parentIdField];\n        },\n\n        _modelOptions: function() {\n            var modelOptions = ((this.options.schema || {}).model || {});\n            return modelOptions;\n        },\n\n        _modelIdField: function() {\n            var modelOptions = this._modelOptions();\n            return modelOptions.id || \"id\";\n        },\n\n        _modelParentIdField: function() {\n            var modelOptions = this._modelOptions();\n            return modelOptions.parentId || PARENTIDFIELD;\n        },\n\n        childNodes: function(model) {\n            return this._byParentId(model.id, this._defaultParentId());\n        },\n\n        allChildNodes: function(model, result) {\n            var directChildren = this.data().filter(function(item) {\n                return item.parentId === model.id;\n            });\n\n            for (var i = 0; i < directChildren.length; i++) {\n                result.push(directChildren[i]);\n                this.allChildNodes(directChildren[i], result);\n            }\n        },\n\n        rootNodes: function() {\n            return this._byParentId(this._defaultParentId());\n        },\n\n        _rootNode: function(child) {\n            return this._parentNodes(child)[0];\n        },\n\n        _pageableRootNodes: function(options) {\n            options = options || {};\n            var that = this;\n            var defaultParentId = that._defaultParentId();\n            var parentIdField = that._modelParentIdField();\n            var result = [];\n            var nodesWithoutParentInView = that._nodesWithoutParentInView(options);\n            var node;\n            var root;\n\n            for (var i = 0; i < nodesWithoutParentInView.length; i++) {\n                node = nodesWithoutParentInView[i];\n\n                if (node[parentIdField] === defaultParentId) {\n                    result.push(node);\n                } else {\n                    root = that._rootNode(node);\n\n                    if (root && result.indexOf(root) === -1) {\n                        result.push(root);\n                    }\n                }\n            }\n\n            return result;\n        },\n\n        parentNode: function(model) {\n            return this.get(model.parentId);\n        },\n\n        _parentNode: function(child) {\n            var that = this;\n            var parentIdField = that._modelParentIdField();\n            var idsMap = that._initIdsMap(that._getData());\n            var parentId = child[parentIdField];\n            var parent = idsMap[parentId] || that._getById(parentId);\n\n            return parent;\n        },\n\n        _parentNodes: function(child) {\n            var that = this;\n            var parent = that._parentNode(child);\n            var parents = [];\n\n            while (parent) {\n                parents.unshift(parent);\n                parent = that._parentNode(parent);\n            }\n\n            return parents;\n        },\n\n        _parentNodesNotInView: function() {\n            var that = this;\n            var view = that.view();\n            var result = [];\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var parentInView;\n            var parents = [];\n            var directParent;\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n\n            for (var i = 0; i < view.length; i++) {\n                dataItem = view[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n                parentInView = that._parentInView(dataItemParentId);\n\n                if (!parentInView && dataItemParentId !== defaultParentId) {\n                    parents = that._parentNodes(dataItem);\n\n                    directParent = parents && parents.length ? parents[parents.length - 1] : that._getById(dataItemParentId);\n\n                    if (directParent && result.indexOf(directParent) === -1) {\n                        result.push(directParent);\n                    }\n                }\n            }\n\n            return result;\n        },\n\n        _nodesWithoutParentInView: function(options) {\n            options = options || {};\n            var that = this;\n            var view = that.view();\n            var childrenMap = options.childrenMap || that.childrenMap(that._getData());\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var dataItem;\n            var parentInView;\n            var children = [];\n            var result = [];\n\n            for (var i = 0; i < view.length; i++) {\n                dataItem = view[i];\n                children = childrenMap[dataItem[idField]];\n                parentInView = that._parentInView(dataItem[parentIdField]);\n\n                if (!parentInView) {\n                    result.push(dataItem);\n                }\n            }\n\n            return result;\n        },\n\n        _parentInView: function(parentId) {\n            var view = this.view();\n\n            for (var i = 0; i < view.length; i++) {\n                if (view[i].id === parentId) {\n                    return view[i];\n                }\n            }\n        },\n\n        level: function(model) {\n            var result = -1;\n\n            if (!(model instanceof TreeListModel)) {\n                model = this.get(model);\n            }\n\n            do {\n                model = this.parentNode(model);\n                result++;\n            } while (model);\n\n            return result;\n        },\n\n        _pageableModelLevel: function(model) {\n            var that = this;\n\n            if (!model || !that._isPageable()) {\n                return 0;\n            }\n\n            var parents = that._parentNodes(model);\n\n            return parents.length;\n        },\n\n        filter: function(value) {\n            var baseFilter = DataSource.fn.filter;\n\n            if (value === undefined) {\n                return baseFilter.call(this, value);\n            }\n\n            baseFilter.call(this, value);\n        },\n\n        _pageableQueryOptions: function(options) {\n            var dataMaps = this._getDataMaps();\n\n            options.childrenMap = dataMaps.children;\n            options.idsMap = dataMaps.ids;\n\n            return options;\n        },\n\n        _flatData: function(data, skip) {\n            skip = this._isPageable() ? true : skip;\n            return DataSource.fn._flatData.call(this, data, skip);\n        },\n\n        data: function(data) {\n            var that = this;\n            var result = DataSource.fn.data.call(that, data);\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n                that._calculateCollapsedTotal();\n            }\n\n            return result;\n        },\n\n        cancelChanges: function(model) {\n            var that = this;\n\n            DataSource.fn.cancelChanges.call(that, model);\n\n            that._restorePageSizeAfterAddChild();\n        },\n\n        _modelCanceled: function(model) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._removeFromDataMaps(model);\n            }\n        },\n\n        _changesCanceled: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n            }\n        },\n\n        _setAddChildPageSize: function() {\n            var that = this;\n            var queryOptions = {};\n\n            if (that._isPageable()) {\n                // increase the page size to make the new item visible in view\n                that._addChildPageSize = that.pageSize() + 1;\n\n                queryOptions = that._defaultPageableQueryOptions();\n                queryOptions.take = that._addChildPageSize;\n                queryOptions.pageSize = that._addChildPageSize;\n                that._query(queryOptions);\n            }\n        },\n\n        _restorePageSizeAfterAddChild: function() {\n            var that = this;\n            var queryOptions = {};\n\n            if (that._isPageable()) {\n                if (!isUndefined(that._addChildPageSize)) {\n                    queryOptions = that._defaultPageableQueryOptions();\n                    queryOptions.take = that._addChildPageSize - 1;\n                    queryOptions.pageSize = that._addChildPageSize - 1;\n                    that._query(queryOptions);\n                }\n            }\n\n            that._addChildPageSize = undefined;\n        },\n\n        sync: function() {\n            var that = this;\n\n            return DataSource.fn.sync.call(that)\n                .then(function() {\n                    that._restorePageSizeAfterAddChild();\n                });\n        },\n\n        _syncEnd: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n            }\n        }\n    });\n\n    TreeListDataSource.create = function(options) {\n        if (Array.isArray(options)) {\n            options = { data: options };\n        } else if (options instanceof ObservableArray) {\n            options = { data: options.toJSON() };\n        }\n\n        return options instanceof TreeListDataSource ? options : new TreeListDataSource(options);\n    };\n\n    function isCellVisible() {\n        return this.style.display !== \"none\";\n    }\n\n    function sortCells(cells) {\n        var indexAttr = kendo.attr(\"index\");\n        return cells.sort(function(a, b) {\n            a = $(a);\n            b = $(b);\n\n            var indexA = a.attr(indexAttr);\n            var indexB = b.attr(indexAttr);\n\n            if (indexA === undefined) {\n                indexA = $(a).index();\n            }\n            if (indexB === undefined) {\n                indexB = $(b).index();\n            }\n\n            indexA = parseInt(indexA, 10);\n            indexB = parseInt(indexB, 10);\n            return indexA > indexB ? 1 : (indexA < indexB ? -1 : 0);\n        });\n    }\n\n    function leafDataCells(container) {\n        var rows = container.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        var cells = $();\n        if (rows.length > 1) {\n            cells = rows.find(\"th[data-index]\")\n                .filter(filter);\n        }\n\n        cells = cells.add(rows.last().find(\"th\").filter(filter));\n\n        return sortCells(cells);\n    }\n\n    function createPlaceholders(options) {\n        var spans = [];\n        var className = options.className;\n\n        for (var i = 0, level = options.level; i < level; i++) {\n            spans.push(kendoDomElement(\"span\", { className: className }));\n        }\n\n        return spans;\n    }\n\n    function columnsWidth(cols) {\n        var colWidth, width = 0;\n\n        for (var idx = 0, length = cols.length; idx < length; idx++) {\n            colWidth = cols[idx].style.width;\n            if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                width += parseInt(colWidth, 10);\n            }\n        }\n\n        return width;\n    }\n\n    function syncTableHeight(table1, table2) {\n       table1 = table1[0];\n       table2 = table2[0];\n\n       if (table1.rows.length && table2.rows.length && table1.rows.length !== table2.rows.length) {\n           var lockedHeigth = table1.offsetHeight;\n           var tableHeigth = table2.offsetHeight;\n\n           var row;\n           var diff;\n           if (lockedHeigth > tableHeigth) {\n               row = table2.rows[table2.rows.length - 1];\n\n               if (filterRowRegExp.test(row.className)) {\n                   row = table2.rows[table2.rows.length - 2];\n               }\n\n               diff = lockedHeigth - tableHeigth;\n           } else {\n               row = table1.rows[table1.rows.length - 1];\n\n                if (filterRowRegExp.test(row.className)) {\n                    row = table1.rows[table1.rows.length - 2];\n                }\n\n               diff = tableHeigth - lockedHeigth;\n           }\n           row.style.height = row.offsetHeight + diff + \"px\";\n       }\n    }\n\n    var TreeListPager = ui.Pager.extend({\n        options: {\n            name: \"TreeListPager\"\n        },\n\n        totalPages: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource && dataSource._filter) {\n                return ui.Pager.fn.totalPages.call(that);\n            }\n\n            return Math.ceil((that._collapsedTotal() || 0) / (that.pageSize() || 1));\n        },\n\n        _createDataSource: function(options) {\n            this.dataSource = kendo.data.TreeListDataSource.create(options.dataSource);\n        },\n\n        _collapsedTotal: function() {\n            var dataSource = this.dataSource;\n            return dataSource ? (dataSource.collapsedTotal() || 0) : 0;\n        }\n    });\n\n    var Editor = kendo.Observable.extend({\n        init: function(element, options) {\n            kendo.Observable.fn.init.call(this);\n\n            options = this.options = extend(true, {}, this.options, options);\n\n            this.element = element;\n\n            this.bind(this.events, options);\n\n            this.model = this.options.model;\n\n            this.fields = this._fields(this.options.columns);\n\n            this._initContainer();\n\n            this.createEditable();\n        },\n\n        options: {\n            renderForm: false\n        },\n\n        events: [],\n\n        _initContainer: function() {\n            this.wrapper = this.element;\n        },\n\n        createEditable: function() {\n            var options = this.options;\n\n            if (options.renderForm) {\n                this.form = new ui.Form(this.wrapper.find(\".k-treelist-form\"), {\n                    items: this.fields,\n                    buttonsTemplate: \"\",\n                    formData: this.model,\n                    change: options.change\n                });\n\n                this.editable = this.form.editable;\n            } else {\n                this.editable = new ui.Editable(this.wrapper, {\n                    fields: this.fields,\n                    target: options.target,\n                    clearContainer: options.clearContainer,\n                    model: this.model,\n                    change: options.change\n                });\n            }\n        },\n\n        _isEditable: function(column) {\n            return isColumnEditable(column, this.model);\n        },\n\n        _fields: function(columns) {\n            var fields = [];\n            var idx, length, column;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (this._isEditable(column)) {\n                    fields.push({\n                        field: column.field,\n                        format: column.format,\n                        editor: column.editor,\n                        editorOptions: extend(true, { format: column.format }, column.editorOptions),\n                        label: column.title || column.field || \"\"\n                    });\n                }\n            }\n\n            return fields;\n        },\n\n        end: function() {\n            return this.editable.end();\n        },\n\n        close: function() {\n            this.destroy();\n        },\n\n        destroy: function() {\n            this.editable.destroy();\n            this.editable.element\n                .find(\"[\" + kendo.attr(\"container-for\") + \"]\")\n                .empty()\n                .end()\n                .removeAttr(kendo.attr(\"role\"));\n\n            this.model = this.wrapper = this.element = this.columns = this.editable = null;\n        }\n    });\n\n    var PopupEditor = Editor.extend({\n        init: function(element, options) {\n            Editor.fn.init.call(this, element, options);\n\n            this._attachHandlers();\n            kendo.cycleForm(this.wrapper);\n\n            this.open();\n        },\n\n        events: [\n            CANCEL,\n            SAVE\n        ],\n\n        options: {\n            window: {\n                modal: true,\n                resizable: false,\n                draggable: true,\n                title: \"Edit\",\n                visible: false\n            }\n        },\n\n        _initContainer: function() {\n            var options = this.options;\n            var formContent = [];\n\n            this.wrapper = $('<div class=\"k-popup-edit-form\"/>')\n                .attr(kendo.attr(\"uid\"), this.model.uid)\n                .append('<div class=\"k-edit-form-container\"/>');\n\n            if (options.template) {\n                this._appendTemplate(formContent);\n                this.fields = [];\n            } else {\n                this.options.renderForm = true;\n                formContent.push(kendoHtmlElement('<div class=\"k-treelist-form\"></div>'));\n            }\n            this._appendButtons(formContent);\n\n            new kendoDom.Tree(this.wrapper.children()[0]).render(formContent);\n\n            this.wrapper.appendTo(options.appendTo);\n\n            this.window = new ui.Window(this.wrapper, options.window);\n        },\n\n        _appendTemplate: function(form) {\n            var template = this.options.template;\n\n            if (typeof template === STRING) {\n                template = kendo.unescape(template);\n            }\n\n            template = kendo.template(template)(this.model);\n\n            form.push(kendoHtmlElement(template));\n        },\n\n        _appendButtons: function(form) {\n            form.push(kendoDomElement(\"div\", {\n                \"class\": \"k-edit-buttons\"\n            }, this.options.commandRenderer()));\n        },\n\n        _attachHandlers: function() {\n            var closeHandler = this._cancelProxy = this._cancel.bind(this);\n            this.wrapper.on(CLICK + NS, \".k-grid-cancel\", this._cancelProxy);\n\n            this._saveProxy = this._save.bind(this);\n            this.wrapper.on(CLICK + NS, \".k-grid-update\", this._saveProxy);\n\n            this.window.bind(\"close\", function(e) {\n                if (e.userTriggered) {\n                    closeHandler(e);\n                }\n            });\n        },\n\n        _detachHandlers: function() {\n            this._cancelProxy = null;\n            this._saveProxy = null;\n            this.wrapper.off(NS);\n        },\n\n        _cancel: function(e) {\n            this.trigger(CANCEL, e);\n        },\n\n        _save: function() {\n            this.trigger(SAVE);\n        },\n\n        open: function() {\n            this.window.center().open();\n        },\n\n        close: function() {\n            this.window.bind(\"deactivate\", this.destroy.bind(this)).close();\n        },\n\n        destroy: function() {\n            if (this.form) {\n                this.form.destroy();\n            }\n\n            this.window.destroy();\n            this.window = null;\n            this._detachHandlers();\n\n            Editor.fn.destroy.call(this);\n        }\n    });\n\n    var IncellEditor = Editor.extend({\n        destroy: function() {\n            var that = this;\n\n            that.editable.destroy();\n\n            that.editable.element\n                .off()\n                .empty()\n                .removeAttr(kendo.attr(\"role\"));\n\n            that.model = that.wrapper = that.element = that.columns = that.editable = null;\n        }\n    });\n\n    var TreeList = DataBoundWidget.extend({\n        init: function(element, options, events) {\n            DataBoundWidget.fn.init.call(this, element, options);\n\n            if (events) {\n                this._events = events;\n            }\n\n            isRtl = kendo.support.isRtl(element);\n            this._dataSource(this.options.dataSource);\n            this._aria();\n            this._columns();\n            this._layout();\n            this._navigatable();\n            this._selectable();\n            this._sortable();\n            this._resizable();\n            this._filterable();\n            this._filterRow();\n            this._attachEvents();\n            this._toolbar();\n            this._scrollable();\n            this._reorderable();\n            this._columnMenu();\n            this._minScreenSupport();\n            this._draggable();\n            this._pageable();\n\n            if (this.options.autoBind) {\n                this.dataSource.fetch();\n            }\n\n            if (this._hasLockedColumns) {\n                var widget = this;\n                this.wrapper.addClass(\"k-grid-lockedcolumns\");\n                this._resizeHandler = function() { widget.resize(); };\n                $(window).on(\"resize\" + NS, this._resizeHandler);\n            }\n\n            kendo.notify(this);\n        },\n\n        _draggable: function() {\n            var that = this;\n            var editable = this.options.editable;\n            var dataSource = that.dataSource;\n            var idField = dataSource._modelIdField();\n            var parentIdField = dataSource._modelParentIdField();\n            var pageable = that._isPageable();\n            var reorderable;\n\n            if (!editable || !editable.move) {\n                return;\n            }\n\n            reorderable = editable.move.reorderable;\n\n            this._dragging = new kendo.ui.HierarchicalDragAndDrop(this.wrapper, {\n                $angular: this.$angular,\n                autoScroll: true,\n                holdToDrag: touchDevice,\n                filter: \"tbody>tr\",\n                itemSelector: \"tr\",\n                allowedContainers: this.wrapper,\n                hintText: function(row) {\n                    var text = function() { return $(this).text(); };\n                    var separator = \"<span class='k-drag-separator'></span>\";\n                    return row.children(\"td\").map(text).toArray().join(separator);\n                },\n                contains: (function(source, destination) {\n                    var dest = this.dataItem(destination);\n                    var src = this.dataItem(source);\n\n                    return src == dest || this.dataSource.contains(src, dest);\n                }).bind(this),\n                itemFromTarget: function(target) {\n                    var tr = target.closest(\"tr\");\n                    var prevRow = tr.prev();\n                    var nextRow = tr.next();\n                    var first;\n                    var last;\n\n                    if (prevRow) {\n                        first = !that.sameLevel(prevRow, tr);\n                    }\n\n                    if (nextRow) {\n                        last = !that.sameLevel(nextRow, tr);\n                    }\n\n                    return {\n                        item: tr,\n                        content: tr,\n                        first: first,\n                        last: last\n                    };\n                },\n                dragstart: (function(source) {\n                    this.wrapper.addClass(\"k-treelist-dragging\");\n\n                    if (this.wrapper.find('.k-grid-content').length) {\n                        this.wrapper.find('.k-grid-content table, .k-grid-content-locked table').css(\"position\", \"relative\");\n                    }\n\n                    var model = this.dataItem(source);\n\n                    return this.trigger(DRAGSTART, { source: model });\n                }).bind(this),\n                drag: (function(e) {\n                    e.source = this.dataItem(e.source);\n\n                    this.trigger(DRAG, e);\n                }).bind(this),\n                drop: (function(e) {\n                    e.source = this.dataItem(e.source);\n                    e.destination = this.dataItem(e.destination);\n\n                    this.wrapper.removeClass(\"k-treelist-dragging\");\n\n                    if (this.wrapper.find('.k-grid-content').length) {\n                        this.wrapper.find('.k-grid-content table, .k-grid-content-locked table').css(\"position\", \"static\");\n                    }\n\n                    return this.trigger(DROP, e);\n                }).bind(this),\n                dragend: (function(e) {\n                    var dest = this.dataItem(e.destination);\n                    var src = this.dataItem(e.source);\n                    var originalSrcParentId = src[parentIdField];\n                    var originalSrcIndex = dataSource._indexInChildrenMap(src);\n                    var position = e.position;\n\n                    if (position == \"over\") {\n                        if (pageable) {\n                            dataSource._removeFromChildrenMap(src);\n                            src[parentIdField] = dest ? dest[idField] : null;\n\n                            dataSource._initChildrenMapForParent(dest);\n\n                            // src.set() below will not work as the parent id is already set\n                            src[parentIdField] = originalSrcParentId;\n                        }\n\n                        var isPrevented = src.set(\"parentId\", dest ? dest.id : null);\n\n                        if (pageable && isPrevented) {\n                            dataSource._removeFromChildrenMap(src);\n                            src[parentIdField] = originalSrcParentId;\n                            dataSource._removeFromChildrenMap(src);\n                            dataSource._insertInChildrenMap(src, originalSrcIndex);\n                        }\n\n\n                    } else {\n                        if (position == \"before\") {\n                            that.insertBefore(src, dest);\n                        } else if (position == \"after\") {\n                            that.insertAfter(src, dest);\n                        }\n                    }\n\n                    e.source = src;\n                    e.destination = dest;\n\n                    this.trigger(DRAGEND, e);\n                }).bind(this),\n                reorderable: reorderable,\n                dropHintContainer: function(item) {\n                    return item.children(\"td:visible\").eq(0);\n                },\n                dropPositionFrom: function(dropHint) {\n                    var contents;\n                    var length;\n                    var i;\n                    var dropHintElement;\n                    var isAfterText = false;\n\n                    if (dropHint.parent().find('.k-i-none').length) {\n                        return dropHint.prevAll(\".k-i-none\").length > 0 ? \"after\" : \"before\";\n                    } else {\n                        contents = dropHint.parent().contents();\n                        length = contents.length;\n                        dropHintElement = dropHint[0];\n\n                        for (i = 0; i < length; i++) {\n                            if (contents[i] === dropHintElement) {\n                                break;\n                            }\n\n                            if (contents[i].nodeType === 3) {\n                                isAfterText = true;\n                            }\n                        }\n\n                        return isAfterText ? \"after\" : \"before\";\n                    }\n                }\n            });\n        },\n\n        sameLevel: function() {\n           return arguments[0].find(\".\" + classNames.iconHidden).length === arguments[1].find(\".\" + classNames.iconHidden).length;\n        },\n\n        insertAfter: function(nodeData, referenceNode) {\n            this.insertAction(nodeData, referenceNode, 1);\n        },\n\n        insertBefore: function(nodeData, referenceNode) {\n            this.insertAction(nodeData, referenceNode, 0);\n        },\n\n        insertAction: function(nodeData, referenceNode, indexOffset) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var parentIdField = dataSource._modelParentIdField();\n            var referenceNodeIndex;\n            var nodeDataIndex = dataSource.indexOf(nodeData);\n            var pageable = that._isPageable();\n            var originalDestIndex = dataSource._indexInChildrenMap(referenceNode);\n            var destIndex;\n            var childrenMap = dataSource._getChildrenMap() || {};\n            var parentId = nodeData[parentIdField];\n\n            that._unbindDataSource();\n            that._unbindDataChange();\n\n            if (pageable) {\n                dataSource._removeFromChildrenMap(nodeData);\n            }\n\n            if (nodeData[parentIdField] != referenceNode[parentIdField]) {\n                 nodeData.set(\"parentId\", referenceNode && referenceNode.parentId ? referenceNode.parentId : null);\n            }\n\n            dataSource._data.splice(nodeDataIndex, 1);\n            referenceNodeIndex = dataSource.indexOf(referenceNode);\n            destIndex = referenceNodeIndex + indexOffset;\n\n            if (pageable) {\n                originalDestIndex += indexOffset;\n\n                if (childrenMap[parentId].length <= originalDestIndex) {\n                    originalDestIndex = childrenMap[parentId].length;\n                }\n                dataSource._insertInChildrenMap(nodeData, originalDestIndex);\n            }\n\n            dataSource._data.splice(destIndex, 0, nodeData);\n            dataSource._destroyed.pop();\n            that._bindDataChange();\n            that._bindDataSource();\n            that.refresh();\n        },\n\n        _bindDataChange: function() {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.bind(CHANGE, dataSource._changeHandler);\n                dataSource._data.trigger(CHANGE);\n            }\n        },\n\n        _unbindDataChange: function() {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.unbind(CHANGE, dataSource._changeHandler);\n            }\n        },\n\n        _bindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.bind(CHANGE, that._refreshHandler);\n            }\n        },\n\n        _unbindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.unbind(CHANGE, that._refreshHandler);\n            }\n        },\n\n        itemFor: function(model) {\n            if (typeof model == \"number\") {\n                model = this.dataSource.get(model);\n            }\n\n            return this.tbody.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n        },\n\n        _itemFor: function(model) {\n            var that = this;\n            var table = that.lockedContent ? that.lockedTable : that.table;\n\n            if (typeof model == \"number\") {\n                model = this.dataSource.get(model);\n            }\n\n            return table.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n        },\n\n        _scrollable: function() {\n            if (this.options.scrollable) {\n                var scrollables = this.thead.closest(\".k-grid-header-wrap\");\n                var lockedContent = $(this.lockedContent)\n                    .on(\"DOMMouseScroll\" + NS + \" mousewheel\" + NS, this._wheelScroll.bind(this));\n\n                this.content.on(\"scroll\" + NS, function() {\n                    kendo.scrollLeft(scrollables, this.scrollLeft);\n                    lockedContent.scrollTop(this.scrollTop);\n                });\n\n\n                var touchScroller = kendo.touchScroller(this.content);\n\n                if (touchScroller && touchScroller.movable) {\n                    this._touchScroller = touchScroller;\n\n                    touchScroller.movable.bind(\"change\", function(e) {\n                        kendo.scrollLeft(scrollables, -e.sender.x);\n                        if (lockedContent) {\n                            lockedContent.scrollTop(-e.sender.y);\n                        }\n                    });\n                }\n            }\n        },\n\n        _wheelScroll: function(e) {\n            if (e.ctrlKey) {\n                return;\n            }\n\n            var delta = kendo.wheelDeltaY(e);\n            var lockedDiv = $(e.currentTarget);\n\n            if (delta) {\n                if (lockedDiv[0].scrollHeight > lockedDiv[0].clientHeight &&\n                    (lockedDiv[0].scrollTop < lockedDiv[0].scrollHeight - lockedDiv[0].clientHeight && delta < 0 ||\n                    lockedDiv[0].scrollTop > 0 && delta > 0)) {\n                    e.preventDefault();\n                }\n                //In Firefox DOMMouseScroll event cannot be canceled\n                lockedDiv.one(\"wheel\" + NS, false);\n\n                this.content.scrollTop(this.content.scrollTop() + (-delta));\n            }\n        },\n\n        _progress: function() {\n            var messages = this.options.messages;\n\n            if (!this.tbody.find(\"tr\").length) {\n                this._showStatus(\n                    kendo.template(\n                        \"<span class='#= className #'></span> #: messages.loading #\"\n                    )({\n                        className: classNames.icon + \" \" + classNames.loading,\n                        messages: messages\n                    })\n                );\n            }\n        },\n\n        _error: function(e) {\n            if (!this.dataSource.rootNodes().length) {\n                this._render({ error: e });\n            }\n        },\n\n        refresh: function(e) {\n            var that = this;\n            e = e || {};\n\n            if (e.action == \"itemchange\" && this.editor) {\n                return;\n            }\n\n            if (this.trigger(DATABINDING)) {\n                return;\n            }\n            var current = $(this.current());\n            var isCurrentInHeader = false;\n            var currentIndex;\n\n            this._cancelEditor();\n\n            this._render();\n\n            this._adjustHeight();\n\n            if (this.options.navigatable) {\n                if (this._isActiveInTable() || this.editor) {\n                    isCurrentInHeader = current.is(\"th\");\n                    currentIndex = Math.max(this.cellIndex(current), 0);\n                }\n                this._restoreCurrent(currentIndex, isCurrentInHeader);\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.items(), true);\n            }\n\n            this.trigger(DATABOUND);\n        },\n\n        _angularFooters: function(command) {\n            var i, footer, aggregates;\n            var allAggregates = this.dataSource.aggregates();\n            var footerRows = this._footerItems();\n\n            for (i = 0; i < footerRows.length; i++) {\n                footer = footerRows.eq(i);\n                aggregates = allAggregates[footer.attr(\"data-parentId\")];\n\n                this._angularFooter(command, footer.find(\"td\").get(), aggregates);\n            }\n        },\n\n        _angularFooter: function(command, cells, aggregates) {\n            var columns = this.columns;\n            this.angular(command, function() {\n                return {\n                    elements: cells,\n                    data: map(columns, function(col) {\n                        return {\n                            column: col,\n                            aggregate: aggregates && aggregates[col.field]\n                        };\n                    })\n                };\n            });\n        },\n\n        items: function() {\n            if (this._hasLockedColumns) {\n                return this._items(this.tbody).add(this._items(this.lockedTable));\n            } else {\n                return this._items(this.tbody);\n            }\n        },\n\n        _items: function(container) {\n            return container.find(\"tr[data-uid]\").filter(function() {\n                return !$(this).hasClass(classNames.footerTemplate);\n            });\n        },\n\n        _footerItems: function() {\n            var container = this.tbody;\n            if (this._hasLockedColumns) {\n                container = container.add(this.lockedTable);\n            }\n\n            return container.find(\"tr\").filter(function() {\n                return $(this).hasClass(classNames.footerTemplate);\n            });\n        },\n\n        dataItems: function() {\n            var dataItems = kendo.ui.DataBoundWidget.fn.dataItems.call(this);\n            if (this._hasLockedColumns) {\n                var n = dataItems.length, tmp = new Array(2 * n);\n                for (var i = n; --i >= 0;) {\n                    tmp[i] = tmp[i + n] = dataItems[i];\n                }\n                dataItems = tmp;\n            }\n\n            return dataItems;\n        },\n\n        _showNoRecordsTemplate: function() {\n            var wrapper = '<div class=\"{0}\">{1}</div>';\n            var defaultTemplate = '<div class=\"k-grid-norecords-template\"{1}>{0}</div>';\n            var scrollableNoGridHeightStyles = (this.options.scrollable && !this.wrapper[0].style.height) ? ' style=\"margin:0 auto;position:static;\"' : '';\n            var template;\n\n            this._contentTree.render([]);\n            if (this._hasLockedColumns) {\n                this._lockedContentTree.render([]);\n            }\n\n            template = kendo.format(defaultTemplate, this.options.messages.noRows, scrollableNoGridHeightStyles);\n\n            $(kendo.template(kendo.format(wrapper, NORECORDSCLASS, template))({})).insertAfter(this.table);\n        },\n\n        _showStatus: function(message) {\n            var status = this.element.find(\".k-status\");\n            var content = $(this.content).add(this.lockedContent);\n\n            if (!status.length) {\n                status = $(\"<div class='k-status' role='alert' aria-live='polite' />\").appendTo(this.element);\n            }\n\n            this._contentTree.render([]);\n            if (this._hasLockedColumns) {\n                this._lockedContentTree.render([]);\n            }\n\n            content.hide();\n\n            status.html(message);\n        },\n\n        _hideStatus: function() {\n            this.element.find(\".k-status\").remove();\n            this._hideNoRecordsTempalte();\n\n            $(this.content).add(this.lockedContent).show();\n        },\n\n        _hideNoRecordsTempalte: function() {\n            this.element.find(\".\" + NORECORDSCLASS).remove();\n        },\n\n        _adjustHeight: function() {\n            var that = this;\n            var element = this.element;\n            var contentWrap = element.find(DOT + classNames.gridContentWrap);\n            var header = element.find(DOT + classNames.gridHeader);\n            var toolbar = element.find(DOT + classNames.gridToolbar);\n            var status = element.find(DOT + classNames.status);\n            var pagerHeight = that._isPageable() && that.pager && that.pager.element.is(\":visible\") ? outerHeight(that.pager.element) : 0;\n            var height;\n            var scrollbar = kendo.support.scrollbar();\n\n            element.css(HEIGHT, this.options.height);\n\n            // identical code found in grid & scheduler :(\n            var isHeightSet = function(el) {\n                var initialHeight, newHeight;\n                if (el[0].style.height) {\n                    return true;\n                } else {\n                    initialHeight = el.height();\n                }\n\n                el.height(\"auto\");\n                newHeight = el.height();\n                el.height(\"\");\n\n                return (initialHeight != newHeight);\n            };\n\n            if (isHeightSet(element)) {\n                height = element.height() - outerHeight(header) - outerHeight(toolbar) - outerHeight(status) - pagerHeight;\n\n                contentWrap.height(height);\n\n                if (this._hasLockedColumns) {\n                    scrollbar = this.table[0].offsetWidth > this.table.parent()[0].clientWidth ? scrollbar : 0;\n                    this.lockedContent.height(height - scrollbar);\n                }\n            }\n        },\n\n        _resize: function(size, force) {\n            this._applyLockedContainersWidth();\n            this._adjustHeight();\n\n            if (this.pager && this.pager.element) {\n                this.pager.resize(force);\n            }\n        },\n\n        _minScreenSupport: function() {\n            var any = this.hideMinScreenCols();\n\n            if (any) {\n                this.minScreenResizeHandler = this.hideMinScreenCols.bind(this);\n                $(window).on(\"resize\", this.minScreenResizeHandler);\n            }\n        },\n\n        _iterateMinScreenCols: function(cols, screenWidth) {\n            var any = false;\n\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                var minWidth = col.minScreenWidth;\n                if (minWidth !== undefined && minWidth !== null) {\n                    any = true;\n                    if (minWidth > screenWidth) {\n                        this.hideColumn(col);\n                    } else {\n                        this.showColumn(col);\n                    }\n                }\n                if (!col.hidden && col.columns) {\n                    any = this._iterateMinScreenCols(col.columns, screenWidth) || any;\n                }\n            }\n            return any;\n        },\n\n        hideMinScreenCols: function() {\n            var cols = this.columns,\n                screenWidth = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n\n            return this._iterateMinScreenCols(cols, screenWidth);\n        },\n\n        destroy: function() {\n            this._destroyColumnAttachments();\n\n            DataBoundWidget.fn.destroy.call(this);\n\n            var dataSource = this.dataSource;\n\n            dataSource.unbind(CHANGE, this._refreshHandler);\n            dataSource.unbind(ERROR, this._errorHandler);\n            dataSource.unbind(PROGRESS, this._progressHandler);\n\n            this._navigatableTables = null;\n            this._current = null;\n\n            if (this._resizeHandler) {\n                $(window).off(\"resize\" + NS, this._resizeHandler);\n            }\n\n            if (this._dragging) {\n                this._dragging.destroy();\n                this._dragging = null;\n            }\n\n            if (this.resizable) {\n                this.resizable.destroy();\n                this.resizable = null;\n            }\n\n            if (this.reorderable) {\n                this.reorderable.destroy();\n                this.reorderable = null;\n            }\n\n            if (this._draggableInstance && this._draggableInstance.element) {\n                this._draggableInstance.destroy();\n                this._draggableInstance = null;\n            }\n\n            if (this.selectable) {\n                this.selectable.destroy();\n            }\n\n            if (this._userEvents) {\n                this._userEvents.destroy();\n                this._userEvents = null;\n            }\n\n            if (this.minScreenResizeHandler) {\n                $(window).off(\"resize\", this.minScreenResizeHandler);\n            }\n\n            this._destroyEditor();\n\n            this.element.off(NS);\n            if (this.wrapper) {\n                this.wrapper.off(NS);\n            }\n\n            if (this._touchScroller) {\n                this._touchScroller.destroy();\n            }\n\n            this._destroyPager();\n\n            if (dataSource) {\n                dataSource._dataMaps = null;\n            }\n\n            this._autoExpandable = null;\n\n            this._refreshHandler = this._errorHandler = this._progressHandler = this._dataSourceFetchProxy = null;\n\n            this.thead =\n                this.content =\n                this.tbody =\n                this.table =\n                this.element =\n                this.lockedHeader =\n                this.lockedContent = null;\n\n            this._statusTree =\n                this._headerTree =\n                this._contentTree =\n                this._lockedHeaderColsTree =\n                this._lockedContentColsTree =\n                this._lockedHeaderTree =\n                this._lockedContentTree = null;\n\n            kendo.destroy(this.wrapper);\n        },\n\n        options: {\n            name: \"TreeList\",\n            columns: [],\n            autoBind: true,\n            scrollable: true,\n            selectable: false,\n            sortable: false,\n            toolbar: null,\n            height: null,\n            columnMenu: false,\n            messages: {\n                noRows: \"No records to display\",\n                loading: \"Loading...\",\n                requestFailed: \"Request failed.\",\n                retry: \"Retry\",\n                commands: {\n                    edit: \"Edit\",\n                    update: \"Update\",\n                    canceledit: \"Cancel\",\n                    create: \"Add new record\",\n                    createchild: \"Add child record\",\n                    destroy: \"Delete\",\n                    excel: \"Export to Excel\",\n                    pdf: \"Export to PDF\",\n                    search: \"Search...\"\n                }\n            },\n            excel: {\n                hierarchy: true\n            },\n            resizable: false,\n            search: false,\n            filterable: false,\n            editable: false,\n            reorderable: false,\n            pageable: false,\n            renderAllRows: true,\n            rowTemplate: \"\",\n            altRowTemplate: \"\"\n        },\n\n        events: [\n            CHANGE,\n            BEFORE_EDIT,\n            EDIT,\n            PAGE,\n            SAVE,\n            SAVE_CHANGES,\n            REMOVE,\n            EXPAND,\n            COLLAPSE,\n            DATABINDING,\n            DATABOUND,\n            CANCEL,\n            DRAGSTART,\n            DRAG,\n            DROP,\n            DRAGEND,\n            FILTERMENUINIT,\n            ITEM_CHANGE,\n            CELL_CLOSE,\n            FILTERMENUOPEN,\n            COLUMNHIDE,\n            COLUMNSHOW,\n            COLUMNREORDER,\n            COLUMNRESIZE,\n            COLUMNMENUINIT,\n            COLUMNMENUOPEN,\n            COLUMNLOCK,\n            COLUMNUNLOCK\n        ],\n\n        getOptions: function() {\n            var options = this.options;\n            options.dataSource = null;\n\n            var result = extend(true, {}, this.options);\n            result.columns = kendo.deepExtend([], this.columns);\n\n            var dataSource = this.dataSource;\n\n            var initialData = dataSource.options.data && dataSource._data;\n            dataSource.options.data = null;\n\n            result.dataSource = $.extend(true, {}, dataSource.options);\n\n            dataSource.options.data = initialData;\n\n            result.dataSource.data = initialData;\n            result.dataSource.page = dataSource.page();\n            result.dataSource.filter = $.extend(true, {}, dataSource.filter());\n            result.dataSource.pageSize = dataSource.pageSize();\n            result.dataSource.sort = dataSource.sort();\n            result.dataSource.group = dataSource.group();\n            result.dataSource.aggregate = dataSource.aggregate();\n\n            if (result.dataSource.transport) {\n                result.dataSource.transport.dataSource = null;\n            }\n\n            if (result.pageable && result.pageable.pageSize) {\n                result.pageable.pageSize = dataSource.pageSize();\n            }\n\n            result.$angular = undefined;\n\n            return result;\n        },\n\n        setOptions: function(options) {\n            var currentOptions = this.getOptions();\n            kendo.deepExtend(currentOptions, options);\n            if (!options.dataSource) {\n                currentOptions.dataSource = this.dataSource;\n            }\n            var wrapper = this.wrapper;\n            var events = this._events;\n            var element = this.element;\n\n            this.destroy();\n            this.options = null;\n            if (wrapper[0] !== element[0]) {\n                wrapper.before(element);\n                wrapper.remove();\n            }\n            element.empty();\n\n            this.init(element, currentOptions, events);\n            this._setEvents(currentOptions);\n        },\n\n        _destroyColumnAttachments: function() {\n            var that = this;\n\n            if (!that.thead) {\n                return;\n            }\n\n            this.angular(\"cleanup\", function() {\n                return { elements: that.thead.get() };\n            });\n\n            that.thead.add(that.lockedHeader).find(\"th\").each(function() {\n                var th = $(this),\n                    filterMenu = th.data(\"kendoFilterMenu\"),\n                    sortable = th.data(\"kendoColumnSorter\"),\n                    columnMenu = th.data(\"kendoColumnMenu\");\n\n                if (filterMenu) {\n                    filterMenu.destroy();\n                }\n\n                if (sortable) {\n                    sortable.destroy();\n                }\n\n                if (columnMenu) {\n                    columnMenu.destroy();\n                }\n            });\n        },\n\n        _toggle: function(model, expand) {\n            var that = this;\n            var defaultPromise = $.Deferred().resolve().promise();\n            var loaded = model.loaded();\n\n             if (that._isIncellEditable() && that.editor) {\n                // manually trigger change as the expand/collapse icons are not focusable\n                $(activeElement()).change();\n                that.closeCell();\n            }\n\n            // reset error state\n            if (model._error) {\n                model.expanded = false;\n                model._error = undefined;\n            }\n\n            // do not load items that are currently loading\n            if (!loaded && model.expanded) {\n                return defaultPromise;\n            }\n\n            // toggle expanded state\n            if (typeof expand == \"undefined\") {\n                expand = !model.expanded;\n            }\n\n            model.expanded = expand;\n\n            function afterModelLoaded() {\n                that._toggleData();\n                if (that._isPageable()) {\n                    that.refresh();\n                } else {\n                    that._render();\n                }\n                that._syncLockedContentHeight();\n            }\n\n            if (!loaded) {\n                defaultPromise = this.dataSource.load(model)\n                    .always((function() {\n                        afterModelLoaded();\n                    }));\n            }\n\n            afterModelLoaded();\n\n            return defaultPromise;\n        },\n\n        _toggleData: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._togglePageableData();\n            }\n        },\n\n        _togglePageableData: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n            var data = dataSource._getData();\n            var result;\n            var queryOptions = dataSource._defaultPageableQueryOptions();\n\n            that._renderProgress(true);\n\n            var childrenMap = dataSource._getChildrenMap() || dataSource.childrenMap(dataSource._getData());\n\n            dataSource._processDataItemsState(data, childrenMap);\n\n            result = dataSource._processPageableQuery(data, queryOptions);\n\n            queryOptions.childrenMap = result.childrenMap;\n            queryOptions.filteredChildrenMap = result.filteredChildrenMap;\n\n            dataSource._aggregateResult = dataSource._calculateAggregates(result.dataToAggregate, queryOptions);\n\n            dataSource.view(result.data);\n\n            if (!dataSource.filter()) {\n                dataSource._calculateCollapsedTotal();\n            }\n\n            that._refreshPager();\n\n            that._renderProgress(false);\n        },\n\n        _refreshPager: function() {\n            var pager = this.pager;\n\n            if (pager) {\n                pager.refresh();\n            }\n        },\n\n        expand: function(row) {\n            return this._toggle(this.dataItem(row), true);\n        },\n\n        collapse: function(row) {\n            return this._toggle(this.dataItem(row), false);\n        },\n\n        _toggleChildren: function(e) {\n            var icon = $(e.target);\n            var model = this.dataItem(icon);\n\n            if (!model) {\n                return;\n            }\n\n            var event = !model.expanded ? EXPAND : COLLAPSE;\n\n            if (!this.trigger(event, { model: model })) {\n                this._toggle(model);\n            }\n\n            e.preventDefault();\n        },\n\n        _navigatable: function() {\n            var that = this;\n\n            if (!that.options.navigatable) {\n                return;\n            }\n            var tables = that.table.add(that.lockedTable);\n\n            var headerTables = that.thead.parent().add($(\">table\", that.lockedHeader));\n            if (that.options.scrollable) {\n                //add the header table when the widget is scrollable\n                tables = tables.add(headerTables);\n                //data tables will recive first focus on TAB\n                headerTables.attr(TABINDEX, -1);\n            }\n\n            headerTables\n                .on(\"keydown\" + NS, that._openHeaderMenu.bind(that))\n                .find(\"a.k-link\").attr(\"tabIndex\", -1);\n\n            this._navigatableTables = tables;\n\n            tables\n                //handle click on tables, will attempt to focus the table\n                .on((kendo.support.touch ? \"touchstart\" + NS : \"mousedown\" + NS), NAVROW + \">:visible\", that._tableClick.bind(that))\n                .on(\"focus\" + NS, that._tableFocus.bind(that))\n                .on(\"focusout\" + NS, that._tableBlur.bind(that))\n                .on(\"keydown\" + NS, that._tableKeyDown.bind(that));\n        },\n\n        _openHeaderMenu: function(e) {\n            if (e.altKey && e.keyCode == keys.DOWN) {\n                this.current().find(\".k-grid-filter, .k-header-column-menu\").click();\n                e.stopImmediatePropagation();\n            }\n        },\n\n        cellIndex: function(td) {\n            var lockedColumnOffset = 0;\n\n            if (this.lockedTable && !$.contains(this.lockedTable[0], td[0])) {\n                lockedColumnOffset = leafColumns(lockedColumns(this.columns)).length;\n            }\n\n            return $(td).parent().children().index(td) + lockedColumnOffset;\n        },\n\n        _isActiveInTable: function() {\n            var active = kendo._activeElement();\n\n            if (!active) { return false; }\n\n            return this.table[0] === active ||\n                $.contains(this.table[0], active) ||\n                (this.lockedTable &&\n                    (this.lockedTable[0] === active || $.contains(this.lockedTable[0], active))\n                );\n        },\n\n        _restoreCurrent: function(currentIndex, isCurrentInHeader) {\n            var rowIndex;\n            var row;\n            var td;\n\n            if (currentIndex === undefined || currentIndex < 0) {\n                return;\n            }\n\n            if (this._current) {\n                this._current.removeClass(\"k-focus\");\n            }\n\n            if (isCurrentInHeader) {\n                this.current(this.thead.find(\"th\").eq(currentIndex));\n            } else {\n                rowIndex = 0;\n                currentIndex = 0;\n\n                row = $();\n\n                if (this.lockedTable) {\n                    row = this.lockedTable.find(\">tbody>tr:visible\").eq(rowIndex);\n                }\n                row = row.add(this.tbody.children().eq(rowIndex));\n\n                td = row.find(\">td:visible\")\n                    .eq(currentIndex);\n\n                this.current(td);\n            }\n\n            if (this._current) {\n                focusTable(this._current.closest(\"table\")[0], true);\n            }\n        },\n\n        current: function(newCurrent) {\n            var current = this._current;\n            newCurrent = $(newCurrent);\n\n            if (newCurrent.length && (!current || current[0] !== newCurrent[0])) {\n                this._updateCurrentAttr(current, newCurrent);\n\n                this._scrollCurrent();\n            }\n\n            if (newCurrent && newCurrent.length) {\n                this._lastCellIndex = newCurrent.parent().children(DATA_CELL).index(newCurrent);\n            }\n\n            return this._current;\n        },\n\n        _setCurrent: function(newCurrent) {\n            var that = this;\n            newCurrent = $(newCurrent);\n\n            if (newCurrent[0]) {\n                that._current = newCurrent;\n                that._updateCurrentAttr(that._current, newCurrent);\n                that._scrollCurrent();\n            }\n\n            return that._current;\n        },\n\n        _scrollCurrent: function() {\n            var current = this._current;\n            var scrollable = this.options.scrollable;\n\n            if (!current || !scrollable) {\n                return;\n            }\n\n            var row = current.parent();\n            var tableContainer = row.closest(\"table\").parent();\n\n            var isInLockedContainer = tableContainer.is(\".k-grid-content-locked,.k-grid-header-locked\");\n            var isInContent = tableContainer.is(\".k-grid-content-locked,.k-grid-content\");\n\n            var scrollableContainer = $(this.content)[0];\n\n            //adjust scroll vertically\n            if (isInContent) {\n                this._scrollTo(this._relatedRow(row)[0], scrollableContainer);\n            }\n\n            if (this.lockedContent) {\n                //sync locked and non-locked content scrollTop\n                this.lockedContent[0].scrollTop = scrollableContainer.scrollTop;\n            }\n\n            //adjust scroll horizontally, if not inside locked tables\n            if (!isInLockedContainer) {\n                this._scrollTo(current[0], scrollableContainer);\n            }\n        },\n\n        _findCurrentCell: function() {\n            var that = this;\n            var current = that.current();\n            var elements = $(that.table).add(that.header).add(that.lockedTable).add(that.lockedHeader);\n\n            if (current && elements.find(current).length > 0) {\n                return current;\n            } else {\n                return elements.find(DOT + classNames.focused);\n            }\n        },\n\n        _scrollTo: function(element, container) {\n            var elementToLowercase = element.tagName.toLowerCase();\n            var isHorizontal = elementToLowercase === \"td\" || elementToLowercase === \"th\";\n            var table = $(element).closest(\"table\")[0];\n            var elementOffsetDir = element[isHorizontal ? \"offsetWidth\" : \"offsetHeight\"];\n            var containerScroll = container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"];\n            var containerOffsetDir = container[isHorizontal ? \"clientWidth\" : \"clientHeight\"];\n            var elementOffset = $(element).css(\"position\") === \"relative\" && isRtl && isHorizontal ? Math.abs(table.offsetLeft - element.offsetLeft) : element[isHorizontal ? \"offsetLeft\" : \"offsetTop\"];\n            var bottomDistance = elementOffset + elementOffsetDir;\n            var result = 0;\n            var ieCorrection = 0;\n            var firefoxCorrection = 0;\n\n            if (isRtl && isHorizontal) {\n                if (browser.msie || browser.edge) {\n                    ieCorrection = table.offsetLeft;\n                } else if (browser.mozilla || (browser.webkit && (browser.version > 85))) {\n                    firefoxCorrection = table.offsetLeft - kendo.support.scrollbar();\n                }\n            }\n            containerScroll = Math.abs(containerScroll + ieCorrection - firefoxCorrection);\n            if (containerScroll > elementOffset) {\n                result = elementOffset;\n            } else if (bottomDistance > (containerScroll + containerOffsetDir)) {\n                if (elementOffsetDir <= containerOffsetDir) {\n                    result = (bottomDistance - containerOffsetDir);\n                } else {\n                    result = elementOffset;\n                }\n            } else {\n                result = containerScroll;\n            }\n            result = Math.abs(result + ieCorrection) + firefoxCorrection;\n            container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"] = result;\n        },\n\n        _aria: function() {\n            var id = this.element.attr(\"id\") || \"aria\";\n\n            if (id) {\n                this._elementId = id + \"_active_element\";\n            }\n        },\n\n        _currentDataIndex: function(table, current) {\n            var index = current.attr(\"data-index\");\n\n            if (!index) {\n                return undefined;\n            }\n\n            var lockedColumnsCount = lockedColumns(this.columns).length;\n            if (lockedColumnsCount && !table.closest(\"div\").hasClass(\"k-grid-content-locked\")[0]) {\n                return index - lockedColumnsCount;\n            }\n\n            return index;\n        },\n\n        _prevVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var cellSelector = DATA_CELL + \",\" + FILTER_CELL;\n\n            //current is in the header, but not at the last level of multi-level columns\n            if (index || current.hasClass(\"k-header\")) {\n                cells = parentColumnsCells(current);\n                return cells.eq(cells.length - 2);\n            }\n\n            index = Math.max(row.children(cellSelector).index(current), this._lastCellIndex || 0);\n\n            //if current is inside filter row\n            if (row.hasClass(\"k-filter-row\")) {\n                return leafDataCells(container).filter(isCellVisible).eq(index);\n            }\n\n            //move up to header container\n            if (rowIndex == -1) {\n                //is there filter row in the header container\n                row = container.find(\"tr.k-filter-row:visible\");\n                if (!row[0]) {\n                    return leafDataCells(container).filter(isCellVisible).eq(index);\n                }\n            } else {\n                row = rowIndex === 0 ? $() : rows.eq(rowIndex - 1);\n            }\n\n            cells = row.children(cellSelector);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _nextVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var cellSelector = DATA_CELL + \",\" + FILTER_CELL;\n\n            //current is in the header, but not at the last level of multi-level columns\n            //and we are not changing the table\n            if (rowIndex != -1 && index === undefined && current.hasClass(\"k-header\")) {\n                return childColumnsCells(current).eq(1);\n            }\n\n            index = index ? parseInt(index, 10) : row.children(cellSelector).index(current);\n            index = Math.max(index, this._lastCellIndex || 0);\n\n            //move down to data container\n            if (rowIndex == -1) {\n                row = rows.eq(0);\n            } else {\n                row = rows.eq(rowIndex + current[0].rowSpan);\n            }\n\n            var tmpIndex = index;\n            //in case of last level of multi-level columns the index should be updated depending on the hidden columns\n            if (this._currentDataIndex(container, current) !== undefined) {\n                var currentRowCells = row.children(\":not(.k-group-cell):not(.k-hierarchy-cell)\");\n                var hiddenColumns = currentRowCells.filter(\":hidden\");\n                for (var idx = 0, length = hiddenColumns.length; idx < length; idx++) {\n                    if (currentRowCells.index(hiddenColumns[idx]) < index) {\n                        tmpIndex--;\n                    }\n                }\n            }\n            index = tmpIndex;\n\n            cells = row.children(cellSelector);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _verticalContainer: function(container, up) {\n            var table = container.parent();\n            var length = this._navigatableTables.length;\n            var step = Math.floor(length / 2);\n            var index = inArray(table[0], this._navigatableTables);\n\n            if (up) {\n                step *= -1;\n            }\n            index += step;\n\n            if (index >= 0 || index < length) {\n                table = this._navigatableTables.eq(index);\n            }\n\n            return table.find(up ? \"thead\" : \"tbody\");\n        },\n\n        _updateCurrentAttr: function(current, next) {\n            var headerId = $(current).data(\"headerId\");\n\n            $(current)\n                .removeClass(classNames.focused)\n                .closest(\"table\")\n                .removeAttr(\"aria-activedescendant\");\n\n            if (headerId) {\n                headerId = headerId.replace(this._elementId, \"\");\n                $(current).attr(\"id\", headerId);\n            } else {\n                $(current).removeAttr(\"id\");\n            }\n\n            next\n                .data(\"headerId\", next.attr(\"id\"))\n                .attr(\"id\", this._elementId)\n                .addClass(classNames.focused)\n                .closest(\"table\")\n                .attr(\"aria-activedescendant\", this._elementId);\n\n            this._current = next;\n        },\n\n        _tableKeyDown: function(e) {\n            var handled = false;\n            var current = this.current();\n            var target = $(e.target);\n            var canHandle = !e.isDefaultPrevented() && !target.is(\":button,a,:input,a>.k-icon\");\n\n            current = current ? current : $(this.lockedTable).add(this.table).find(NAVROW + \" > td:visible\").first();\n\n            if (canHandle && e.keyCode == keys.UP) {\n                handled = this._moveUp(current, e.shiftKey);\n            }\n\n            if (canHandle && e.keyCode == keys.DOWN) {\n                handled = this._moveDown(current, e.shiftKey);\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.LEFT : keys.RIGHT)) {\n                if (e.altKey) {\n                    handled = this._handleExpand(current);\n                } else {\n                    handled = this._moveRight(current);\n                }\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.RIGHT : keys.LEFT)) {\n                if (e.altKey) {\n                    handled = this._handleCollapse(current);\n                } else {\n                    handled = this._moveLeft(current);\n                }\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEDOWN) {\n                handled = this._handlePageDown();\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEUP) {\n                handled = this._handlePageUp();\n            }\n\n            if (e.keyCode == keys.ENTER || e.keyCode == keys.F2) {\n                handled = this._handleEnterKey(current, e.currentTarget, target);\n            }\n\n            if (e.keyCode == keys.ESC) {\n                handled = this._handleEscKey(current, e.currentTarget);\n            }\n\n            if (canHandle && e.keyCode == keys.HOME) {\n                handled = this._handleHome(current, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == keys.END) {\n                handled = this._handleEnd(current, e.ctrlKey);\n            }\n\n            if (e.keyCode == keys.TAB) {\n                handled = this._handleTabKey(current, e.currentTarget, e.shiftKey);\n            }\n\n            if (handled) {\n                //prevent scrolling while pressing the keys\n                e.preventDefault();\n                //required in hierarchy\n                e.stopPropagation();\n            }\n        },\n\n        _handleExpand: function(current) {\n            var that = this;\n            var row = current.parent();\n            var model = that.dataItem(row);\n\n            if (current.hasClass(\"k-header\")) {\n                return false;\n            }\n\n            if (model && model.hasChildren && !model.expanded && !that.trigger(EXPAND, { model: model })) {\n                this.expand(row);\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleCollapse: function(current) {\n            var that = this;\n            var row = current.parent();\n            var model = that.dataItem(row);\n\n            if (current.hasClass(\"k-header\")) {\n                return false;\n            }\n\n            if (model && model.hasChildren && model.expanded && !that.trigger(COLLAPSE, { model: model })) {\n                that.collapse(row);\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleHome: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var prev;\n\n            if (ctrl) {\n                if (this.lockedTable) {\n                    prev = this.lockedTable.find(NAVROW + \" > td:visible\").first();\n                } else {\n                    prev = this.table.find(NAVROW + \" > td:visible\").first();\n                }\n            } else if (isInBody || isInLockedTable) {\n                if (isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                prev = row.children(NAVCELL).first();\n            }\n\n            if (prev && prev.length) {\n                this.current(prev);\n                return true;\n            }\n        },\n\n        _handleEnd: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var next;\n\n            if (ctrl) {\n                next = this.table.find(ITEMROW).last().children(NAVCELL).last();\n            } else if (isInBody || isInLockedTable) {\n                if (!isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                next = row.children(NAVCELL).last();\n            }\n\n            if (next && next.length) {\n                this.current(next);\n                return true;\n            }\n        },\n\n        _handlePageDown: function() {\n            var that = this;\n\n            if (!that._isPageable()) {\n                return false;\n            }\n\n            that.dataSource._restorePageSizeAfterAddChild();\n            that.dataSource.page(that.dataSource.page() + 1);\n\n            return true;\n        },\n\n        _handlePageUp: function() {\n            var that = this;\n\n            if (!that._isPageable()) {\n                return false;\n            }\n\n            that.dataSource._restorePageSizeAfterAddChild();\n            that.dataSource.page(that.dataSource.page() - 1);\n\n            return true;\n        },\n\n        _handleEscKey: function(current, currentTable) {\n            var active = kendo._activeElement();\n            var currentIndex;\n            var that = this;\n            var row;\n            var rowIndex;\n            var cellIndex;\n            var tbody;\n\n            if (!current || !current.parent().hasClass(\"k-grid-edit-row\")) {\n                if (current.has(active).length) {\n                    // return focus back to the table\n                    focusTable(currentTable, true);\n\n                    return true;\n                }\n                return false;\n            }\n\n            if (that._isIncellEditable()) {\n                row = current.parent();\n                cellIndex = current.index();\n                rowIndex = row.index();\n                tbody = row.closest(\"tbody\");\n\n                that.closeCell(true);\n\n                // refresh the current element as the DOM element reference can be changed after render()\n                // moving this to closeCell() causes flickering when clicking on a cell and then on another\n                // as 'k-focused' is shown for the closing cell and then added to the newly edited cell\n                that._setCurrent(tbody.children().eq(rowIndex).children().eq(cellIndex));\n            } else {\n                currentIndex = $(current).parent().index();\n                if (active) {\n                    active.blur();\n                }\n                this.cancelRow();\n                if (currentIndex >= 0) {\n                    this.current(this.items().eq(currentIndex).children(NAVCELL).first());\n                }\n            }\n\n            focusTable(currentTable, true);\n\n            return true;\n        },\n\n        _handleEnterKey: function(current, currentTable, target) {\n            var editable = this.options.editable;\n            var container = target.closest(\"[role=gridcell]\");\n            var focusable;\n\n            if (!target.is(\"table\") && !$.contains(current[0], target[0])) {\n                current = container;\n            }\n\n            if (current.is(\"th\")) {\n                // sort the column, if possible\n                current.find(\".k-link\").click();\n                return true;\n            }\n\n            focusable = current.find(\":kendoFocusable\").first();\n            if (focusable[0] && current.hasClass(\"k-focus\")) {\n                focusable.trigger(\"focus\");\n\n                return true;\n            }\n\n            if (editable && !target.is(\":button,.k-button,textarea\")) {\n                if (!container[0]) {\n                    container = current;\n                }\n\n                this._handleEditing(container, false, currentTable);\n\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleTabKey: function(current, currentTable, shiftKey) {\n            var that = this;\n            var incellEditing = that.options.editable && that._isIncellEditable();\n            var cell;\n\n            if (!incellEditing || current.is(\"th\")) {\n                return false;\n            }\n\n            cell = $(activeElement()).closest(DOT + classNames.editCell);\n\n            if (cell[0] && cell[0] !== current[0]) {\n                current = cell;\n            }\n\n            cell = that._tabNext(current, currentTable, shiftKey);\n\n            if (cell.length) {\n                that._handleEditing(current, cell, cell.closest(TABLE));\n                return true;\n            } else {\n                that._preventPageSizeRestore = false;\n            }\n\n            return false;\n        },\n\n        _tabNext: function(current, currentTable, back) {\n            var that = this;\n            var switchRow = true;\n            var next = back ? current.prevAll(DATA_CELL).first() : current.nextAll(\":visible\").first();\n\n            if (!next.length) {\n                next = current.parent();\n                if (that.lockedTable) {\n                    switchRow = (back && currentTable == that.lockedTable[0]) || (!back && currentTable == that.table[0]);\n                    next = that._relatedRow(next);\n                }\n\n                if (switchRow) {\n                    next = next[back ? \"prevAll\" : \"nextAll\"](\"tr:not(.k-grouping-row):not(.k-detail-row):visible\").first();\n                }\n\n                if (back) {\n                    next = next.children(DATA_CELL).last();\n                } else {\n                    next = next.children(DATA_CELL).first();\n                }\n\n\n                that.dataSource._restorePageSizeAfterAddChild();\n            }\n\n            return next;\n        },\n\n        _handleEditing: function(current, next, table) {\n            var that = this,\n                active = $(kendo._activeElement()),\n                isIE = browser.msie,\n                editContainer,\n                focusable,\n                isEdited;\n            var editable = that.options.editable && that.options.editable.update !== false;\n            var incellEditing = that._isIncellEditable();\n            var nextFocusableCellRowIndex = $(next).parents(\"tr\").index();\n            var nextFocusableCellIndex = $(next).index();\n            var currentFocusedCellRowIndex = $(current).parents(\"tr\").index();\n            var currentFocusedCellIndex = current.index();\n            var editedCell;\n\n            table = $(table);\n\n            if (incellEditing) {\n                isEdited = current.hasClass(classNames.editCell);\n            } else {\n                isEdited = current.parent().hasClass(\"k-grid-edit-row\");\n            }\n\n            if (that.editor) {\n                editContainer = that.editor.wrapper;\n                if (editContainer && $.contains(editContainer[0], active[0])) {\n                    if (browser.opera) {\n                        active.trigger(\"blur\").change().triggerHandler(\"blur\");\n                    } else {\n                        active.trigger(\"blur\");\n                        if (isIE) {\n                            //IE10 with jQuery 1.9.x does not trigger blur handler\n                            //numeric textbox does trigger change\n                            active.trigger(\"blur\");\n                        }\n                    }\n                }\n\n                if (!that.editor) {\n                    focusTable(table);\n                    return;\n                }\n\n                if (that.editor.end()) {\n                    if (incellEditing) {\n                        that._preventPageSizeRestore = true;\n                        that.closeCell();\n                        that._preventPageSizeRestore = false;\n\n                        if ($(that.table).add(that.lockedTable).find(DOT + classNames.editCell).length === 0) {\n                            that.current(table.find(\"tbody\").children().eq(currentFocusedCellRowIndex).children().eq(currentFocusedCellIndex));\n                        }\n                    } else {\n                        that.saveRow();\n                        isEdited = true;\n                    }\n                } else {\n                    if (incellEditing) {\n                        that.current(editContainer);\n                    } else {\n                        that.current(editContainer.children().filter(NAVCELL).first());\n                    }\n\n                    focusable = editContainer.find(\":kendoFocusable\").first()[0];\n                    if (focusable) {\n                        focusable.focus();\n                    }\n                    return;\n                }\n            }\n\n            // the next cell to focus might be re-rendered, so update the reference to it if it is an element\n            next = $(next).length && table.find(next).length === 0 ? table.find(\"tbody\").children().eq(nextFocusableCellRowIndex).children().eq(nextFocusableCellIndex) : next;\n\n            if (next) {\n                that.current(next);\n            }\n\n            focusTable(table, true);\n\n            if (!editable) {\n                return;\n            }\n\n            if ((!isEdited && !next) || next) {\n                var currentIndex = that.current().index();\n\n                if (incellEditing) {\n                    that.editCell(that.current());\n\n                    editedCell = $(that.table).add(that.lockedTable).find(DOT + classNames.editCell)[0];\n\n                    if (editedCell) {\n                        that._current = $(editedCell);\n                    } else {\n                        that.current(that._findCurrentCell());\n                    }\n                } else {\n                    that.editRow(that.current().parent());\n                    that.current(that.editor.wrapper.children().eq(currentIndex));\n                    that.current().removeClass(\"k-focus\");\n                }\n            } else {\n                that.dataSource._restorePageSizeAfterAddChild();\n            }\n        },\n\n        _moveRight: function(current) {\n            var next = current.nextAll(NAVCELL).first();\n            var row = current.parent();\n            var rowIndex = row.index();\n\n            if (current.hasClass(\"k-header\") || row.is('.k-filter-row')) {\n                next = current.nextAll(NAVHEADER).first();\n                if (!next[0] && this.lockedTable && current.closest(\"table\")[0] === this.lockedHeader.find(\"table\")[0]) {\n                    next = this.thead.find(\"tr\").eq(rowIndex).find(NAVHEADER).first();\n                }\n            }\n\n            if (!next[0] && this.lockedTable && current.closest(\"table\")[0] === this.lockedTable[0]) {\n               next = this._relatedRow(row).children(NAVCELL).first();\n            }\n\n            if (next[0] && next[0] !== current[0]) {\n                focusTable(next.closest(\"table\"), true);\n            }\n\n            this.current(next);\n\n            return true;\n        },\n\n        _moveLeft: function(current) {\n            var prev = current.prevAll(NAVCELL).first();\n            var row = current.parent();\n            var rowIndex = row.index();\n\n            if (current.hasClass(\"k-header\") || row.is('.k-filter-row')) {\n                prev = current.prevAll(NAVHEADER).first();\n                if (!prev[0] && this.lockedTable && current.closest(\"table\")[0] === this.thead.parent()[0]) {\n                    prev = this.lockedHeader.find(\">table>thead>tr\").eq(rowIndex).children(NAVHEADER).last();\n                }\n            }\n\n            if (!prev[0] && this.lockedTable && current.closest(\"table\")[0] === this.table[0]) {\n               prev = this._relatedRow(row).children(NAVCELL).last();\n            }\n\n            if (prev[0] && prev[0] !== current[0]) {\n                focusTable(prev.closest(\"table\"), true);\n            }\n\n            this.current(prev);\n\n            return true;\n        },\n\n        _moveUp: function(current, shiftKey) {\n            var container = current.parent().parent();\n            var prev;\n\n            if (shiftKey) {\n               prev = current.parent();\n               prev = prev.prevAll(ITEMROW).first();\n               prev = current.parent().is(ITEMROW) ? prev.children().eq(current.index()) : prev.children(DATA_CELL).last();\n            } else {\n               prev = this._prevVerticalCell(container, current);\n               if (!prev[0]) {\n                  this._lastCellIndex = 0;\n                  container = this._verticalContainer(container, true);\n\n                  prev = this._prevVerticalCell(container, current);\n\n                  if (prev[0]) {\n                      focusTable(container.parent(), true);\n                  }\n               }\n            }\n\n            var tmp = this._lastCellIndex || 0;\n            this.current(prev);\n            this._lastCellIndex = tmp;\n\n            return true;\n        },\n\n        _moveDown: function(current, shiftKey) {\n            var container = current.parent().parent();\n            var next;\n\n            if (shiftKey) {\n                next = current.parent();\n                next = next.nextAll(ITEMROW).first();\n                next = current.parent().is(ITEMROW) ? next.children().eq(current.index()) : next.children(DATA_CELL).first();\n            } else {\n                next = this._nextVerticalCell(container, current);\n                if (!next[0]) {\n                    this._lastCellIndex = 0;\n                    container = this._verticalContainer(container);\n\n                    next = this._nextVerticalCell(container, current);\n                    if (next[0]) {\n                        focusTable(container.parent(), true);\n                    }\n                }\n            }\n            var tmp = this._lastCellIndex || 0;\n            this.current(next);\n            this._lastCellIndex = tmp;\n            return true;\n        },\n\n        _tableClick: function(e) {\n            var currentTarget = $(e.currentTarget),\n                isHeader = currentTarget.is(\"th\"),\n                table = this.table.add(this.lockedTable),\n                headerTable = this.thead.parent().add($(\">table\", this.lockedHeader)),\n                isInput = isInputElement(e.target),\n                currentTable = currentTarget.closest(\"table\")[0];\n\n            if (kendo.support.touch) {\n                return;\n            }\n\n            if (currentTable !== table[0] && currentTable !== table[1] && currentTable !== headerTable[0] && currentTable !== headerTable[1]) {\n                return;\n            }\n\n            if (this.options.navigatable) {\n                this.current(currentTarget);\n            }\n\n            if (isHeader || !isInput) {\n                setTimeout(function() {\n                   if (!isInputElement(kendo._activeElement()) || !$.contains(currentTable, kendo._activeElement())) {\n                       focusTable(currentTable, true);\n                   }\n                });\n            }\n\n            if (isHeader) {\n                e.preventDefault(); //if any problem occurs, call preventDefault only for the clicked header links\n            }\n        },\n\n        _setTabIndex: function(table) {\n            this._navigatableTables.attr(TABINDEX, -1);\n\n            table.attr(TABINDEX, 0);\n        },\n\n        _tableFocus: function(e) {\n            var current = this.current();\n            var table = $(e.currentTarget);\n\n            if (current && current.is(\":visible\")) {\n                current.addClass(classNames.focused);\n            } else {\n                this.current(table.find(NAVROW + \" > td:visible\").first());\n            }\n\n            this._setTabIndex(table);\n        },\n\n        _tableBlur: function() {\n            var current = this.current();\n\n            if (current) {\n                current.removeClass(classNames.focused);\n            }\n        },\n\n        _attachEvents: function() {\n            var that = this;\n            var retryButton = DOT + classNames.retry;\n\n            that._userEvents = new kendo.UserEvents(that.element, {\n                press: that._onPress.bind(that),\n                allowSelection: true\n            });\n\n            this.element\n                .on(CLICK + NS, retryButton, this._dataSourceFetchProxy)\n                .on(CLICK + NS, \".k-button[data-command]\", this._commandClick.bind(this))\n                .on(INPUT + NS, \".k-grid-search input\", this._search.bind(this));\n\n            this._attachCellEditingEventHandlers();\n        },\n\n        _onPress: function(e) {\n            var that = this;\n            var icons = DOT + classNames.iconCollapse +\n                \", .\" + classNames.iconExpand +\n                \", .\" + classNames.refresh;\n\n            if ($(e.event.target).is(icons)) {\n                that._toggleChildren.call(that, e.event);\n            }\n        },\n\n        _attachCellEditingEventHandlers: function() {\n            var that = this;\n            var editable = that.options.editable;\n            var selectable = that.selectable && that.selectable.options.multiple;\n            var closeCell = function(e) {\n                var target = activeElement();\n                var editor = that.editor || {};\n                var cell = editor.element;\n\n                if (cell && !$.contains(cell[0], target) && cell[0] !== target && !$(target).closest(\".k-animation-container\").length) {\n                    if (editor.end()) {\n                        if (!e.relatedTarget && that._isPageable() && !isUndefined(that.dataSource._addChildPageSize)) {\n                            that._preventPageSizeRestore = false;\n                        }\n\n                        that.closeCell();\n                    }\n                }\n\n                that._preventPageSizeRestore = false;\n            };\n\n            if (that._isIncellEditable() && editable.update !== false) {\n                that.wrapper\n                    .on(CLICK + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                        var td = $(this),\n                            isLockedCell = that.lockedTable && td.closest(\"table\")[0] === that.lockedTable[0];\n\n                        if (td.hasClass(classNames.editCell) ||\n                            td.has(\"a.k-grid-delete\").length ||\n                            td.has(\"button.k-grid-delete\").length ||\n                            (td.closest(\"tbody\")[0] !== that.tbody[0] && !isLockedCell) ||\n                            $(e.target).is(\":input\") ||\n                            $(e.target).hasClass(classNames.iconExpand) ||\n                            $(e.target).hasClass(classNames.iconCollapse)) {\n\n                            if (!that.editor) {\n                                that.dataSource._restorePageSizeAfterAddChild();\n                            }\n\n                            that._preventPageSizeRestore = false;\n\n                            return;\n                        }\n\n                        if (that.editor) {\n                            if (that.editor.end()) {\n                                if (selectable) {\n                                    $(activeElement()).trigger(\"blur\");\n                                }\n                                that.closeCell();\n                                that.editCell(td);\n                            }\n                        } else {\n                            that.editCell(td);\n                        }\n                    })\n                    .on(\"mousedown\" + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                        // cache the result on \"mousedown\", which is fired before \"focusout\" and \"click\"\n                        if (that.editor && that._isPageable() && !isUndefined(that.dataSource._addChildPageSize)) {\n                            that._preventPageSizeRestore = $(e.target).parents(DOT + classNames.editRow).length > 0;\n                        } else {\n                            that._preventPageSizeRestore = false;\n                        }\n                    })\n                    .on(\"focusin\" + NS, function() {\n                        // fix focus issue in IE\n                        if (!$.contains(this, activeElement())) {\n                            clearTimeout(that._closeCellTimeout);\n                            that._closeCellTimeout = null;\n                        }\n                    })\n                    .on(\"focusout\" + NS, function(e) {\n                        that._closeCellTimeout = setTimeout(function() {\n                            closeCell(e);\n                        }, 1);\n                    });\n            }\n        },\n\n        _commandByName: function(name) {\n            var columns = this.columns;\n            var toolbar = Array.isArray(this.options.toolbar) ? this.options.toolbar : [];\n            var i, j, commands, currentName;\n\n            name = name.toLowerCase();\n\n            if (defaultCommands[name]) {\n                return defaultCommands[name];\n            }\n\n            // command not found in defaultCommands, must be custom\n            for (i = 0; i < columns.length; i++) {\n                commands = columns[i].command;\n                if (commands) {\n                    for (j = 0; j < commands.length; j++) {\n                        currentName = commands[j].name;\n\n                        if (!currentName) {\n                            continue;\n                        }\n\n                        if (currentName.toLowerCase() == name) {\n                            return commands[j];\n                        }\n                    }\n                }\n            }\n\n            // custom command in toolbar\n            for (i = 0; i < toolbar.length; i++) {\n                currentName = toolbar[i].name;\n\n                if (!currentName) {\n                    continue;\n                }\n\n                if (currentName.toLowerCase() == name) {\n                    return toolbar[i];\n                }\n            }\n        },\n\n        _commandClick: function(e) {\n            var button = $(e.currentTarget);\n            var commandName = button.attr(\"data-command\");\n            var command = this._commandByName(commandName);\n            var row = button.parentsUntil(this.wrapper, \"tr\");\n\n            row = row.length ? row : undefined;\n\n            if (command) {\n                if (command.methodName) {\n                    this[command.methodName](row);\n                } else if (command.click) {\n                    command.click.call(this, e);\n                }\n\n                e.preventDefault();\n            }\n        },\n\n        _search: function(e) {\n            var that = this;\n            var input = e.currentTarget;\n            clearTimeout(that._searchTimeOut);\n            that._searchTimeOut = setTimeout(function() {\n                that._searchTimeOut = null;\n                var options = that.options;\n                var searchFields = options.search ? options.search.fields : null;\n                var expression = { filters: [], logic: \"or\" };\n                var value = input.value;\n\n                if (!searchFields) {\n                    searchFields = getColumnsFields(options.columns);\n                }\n\n                if (value) {\n                    for (var i = 0; i < searchFields.length; i++) {\n                        expression.filters.push({ field: searchFields[i], operator: \"contains\", value: value });\n                    }\n                } else {\n                    expression = {};\n                }\n\n                that.dataSource.filter(expression);\n\n            }, 300);\n        },\n\n        _ensureExpandableColumn: function() {\n            if (this._autoExpandable) {\n                delete this._autoExpandable.expandable;\n            }\n\n            var visibleColumns = grep(this.columns, not(is(\"hidden\")));\n            visibleColumns = grep(visibleColumns, not(is(\"command\")));\n            visibleColumns = grep(visibleColumns, not(is(\"selectable\")));\n            var expandableColumns = grep(visibleColumns, is(\"expandable\"));\n\n            if (this.columns.length && !expandableColumns.length) {\n                this._autoExpandable = visibleColumns[0];\n                visibleColumns[0].expandable = true;\n            }\n        },\n\n        _columns: function() {\n            var that = this;\n            var columns = this.options.columns || [];\n\n            this.columns = map(columns, function(column) {\n                column = (typeof column === \"string\") ? { field: column } : column;\n\n                return extend({ encoded: true }, column);\n            });\n\n            var lockedCols = lockedColumns(columns);\n            if (lockedCols.length > 0) {\n                if (this.options.rowTemplate || this.options.altRowTemplate) {\n                    throw new Error(\"Having both row template and locked columns is not supported\");\n                }\n                this._hasLockedColumns = true;\n                this.columns = lockedCols.concat(nonLockedColumns(this.columns));\n            }\n\n            this.columns = normalizeColumns(this.columns);\n\n            this._ensureExpandableColumn();\n\n            this._columnTemplates();\n            this._columnAttributes();\n\n            if ($.grep(leafColumns(that.columns), function(col) {\n                if (col.selectable) {\n                    that._includeChildren = col.includeChildren;\n                }\n                return col.selectable;\n            }).length) {\n                that._checkBoxSelection = true;\n                that.element.on(CLICK + NS, \"tbody > tr \" + CHECKBOXINPUT, that._checkboxClick.bind(that));\n                that.element.on(CLICK + NS, \"thead > tr \" + CHECKBOXINPUT, that._headerCheckboxClick.bind(that));\n            }\n        },\n\n        _columnTemplates: function() {\n            var idx, length, column;\n            var columns = leafColumns(this.columns);\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n                if (column.template) {\n                    column.template = kendo.template(column.template);\n                }\n\n                if (this._isIncellEditable()) {\n                    column.dirtyCellTemplate = this._createDirtyColumnTemplate(column);\n                    column.dirtyIndicatorTemplate = this._createIndicatorTemplate(column);\n                }\n\n                if (column.headerTemplate) {\n                    column.headerTemplate = kendo.template(column.headerTemplate);\n                }\n\n                if (column.footerTemplate) {\n                    column.footerTemplate = kendo.template(column.footerTemplate);\n                }\n            }\n        },\n\n        _columnAttributes: function() {\n            // column style attribute is string, kendo.dom expects object\n            var idx, length;\n            var columns = this.columns;\n\n            function convertStyle(attr) {\n                var properties, i, declaration;\n\n                if (attr && attr.style && attr.style.split) {\n                    properties = attr.style.split(\";\");\n                    attr.style = {};\n\n                    for (i = 0; i < properties.length; i++) {\n                        declaration = properties[i].split(\":\");\n\n                        var name = kendo.trim(declaration[0]);\n\n                        if (name) {\n                            attr.style[$.camelCase(name)] = kendo.trim(declaration[1]);\n                        }\n                    }\n                }\n            }\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                convertStyle(columns[idx].attributes);\n                convertStyle(columns[idx].headerAttributes);\n            }\n        },\n\n        _clearSortClasses: function() {\n            var that = this;\n\n            if (that.content) {\n                that.content.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").removeClass(\"k-sorted\");\n            }\n\n            if (that.lockedContent) {\n                that.lockedContent.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").removeClass(\"k-sorted\");\n            }\n        },\n\n        _layout: function() {\n            var columns = this.columns;\n            var element = this.element;\n            var layout = \"\";\n\n            this.wrapper = element.addClass(classNames.wrapper);\n\n            layout = \"<div class='#= gridHeader #'>\";\n\n            if (this._hasLockedColumns) {\n                layout += \"<div class='k-grid-header-locked'>\" +\n                                \"<table role='grid'>\" +\n                                    \"<colgroup></colgroup>\" +\n                                    \"<thead role='rowgroup'></thead>\" +\n                                \"</table>\" +\n                            \"</div>\";\n            }\n\n            layout += \"<div class='#= gridHeaderWrap #'>\" +\n                            \"<table role='grid'>\" +\n                                \"<colgroup></colgroup>\" +\n                                \"<thead role='rowgroup'></thead>\" +\n                            \"</table>\" +\n                        \"</div>\" +\n                        \"</div>\";\n\n            if (this._hasLockedColumns) {\n                layout += \"<div class='k-grid-content-locked'>\" +\n                                \"<table role='treegrid' tabindex='0'>\" +\n                                    \"<colgroup></colgroup>\" +\n                                    \"<tbody></tbody>\" +\n                                \"</table>\" +\n                            \"</div>\";\n            }\n\n            layout += \"<div class='#= gridContentWrap # k-auto-scrollable'>\" +\n                            \"<table role='treegrid' tabindex='0'>\" +\n                                \"<colgroup></colgroup>\" +\n                                \"<tbody></tbody>\" +\n                            \"</table>\" +\n                        \"</div>\";\n\n            if (!this.options.scrollable) {\n                layout =\n                    \"<table role='treegrid' tabindex='0'>\" +\n                        \"<colgroup></colgroup>\" +\n                        \"<thead class='#= gridHeader #' role='rowgroup'></thead>\" +\n                        \"<tbody></tbody>\" +\n                    \"</table>\";\n            }\n\n            if (this.options.toolbar) {\n                layout = \"<div class='#= toolbar # #= gridToolbar #'></div>\" + layout;\n            }\n\n            element.append(\n                kendo.template(layout)(classNames) +\n                \"<div class='k-status' role='alert' aria-live='polite'></div>\"\n            );\n\n            this.toolbar = element.find(DOT + classNames.gridToolbar);\n\n            var header = element.find(DOT + classNames.gridHeader).find(\"thead\").addBack().filter(\"thead\");\n            this.thead = header.last();\n\n            if (this.options.scrollable) {\n                var rtl = kendo.support.isRtl(element);\n\n                element.find(\"div.\" + classNames.gridHeader)\n                    .css(rtl ? \"padding-left\" : \"padding-right\", kendo.support.scrollbar());\n            }\n\n\n            var content = element.find(DOT + classNames.gridContentWrap);\n            if (!content.length) {\n                content = element;\n            } else {\n                this.content = content;\n            }\n\n            this.table = content.find(\">table\");\n            this.tbody = this.table.find(\">tbody\");\n\n            if (this._hasLockedColumns) {\n                this.lockedHeader = header.first().closest(\".k-grid-header-locked\");\n                this.lockedContent = element.find(\".k-grid-content-locked\");\n                this.lockedTable = this.lockedContent.children();\n            }\n\n            this._initVirtualTrees();\n\n            this._renderCols();\n            this._renderHeader();\n\n            this.angular(\"compile\", function() {\n                return {\n                    elements: header.find(\"th.k-header\").get(),\n                    data: map(columns, function(col) { return { column: col }; })\n                };\n            });\n        },\n\n        _initVirtualTrees: function() {\n            this._headerColsTree = new kendoDom.Tree(this.thead.prev()[0]);\n            this._contentColsTree = new kendoDom.Tree(this.tbody.prev()[0]);\n            this._headerTree = new kendoDom.Tree(this.thead[0]);\n            this._contentTree = new kendoDom.Tree(this.tbody[0]);\n            this._statusTree = new kendoDom.Tree(this.element.children(\".k-status\")[0]);\n\n            if (this.lockedHeader) {\n                this._lockedHeaderColsTree = new kendoDom.Tree(this.lockedHeader.find(\"colgroup\")[0]);\n                this._lockedContentColsTree = new kendoDom.Tree(this.lockedTable.find(\">colgroup\")[0]);\n                this._lockedHeaderTree = new kendoDom.Tree(this.lockedHeader.find(\"thead\")[0]);\n                this._lockedContentTree = new kendoDom.Tree(this.lockedTable.find(\">tbody\")[0]);\n            }\n        },\n\n        _toolbar: function() {\n            var options = this.options.toolbar;\n            var toolbar = this.toolbar;\n\n            if (!options) {\n                return;\n            }\n\n            if (Array.isArray(options)) {\n                var buttons = this._buildCommands(options);\n                new kendoDom.Tree(toolbar[0]).render(buttons);\n            } else {\n                toolbar.append(kendo.template(options)({}));\n            }\n\n            this.angular(\"compile\", function() {\n                return { elements: toolbar.get() };\n            });\n        },\n\n        _lockedColumns: function() {\n            return grep(this.columns, is(\"locked\"));\n        },\n\n        _nonLockedColumns: function() {\n            return grep(this.columns, not(is(\"locked\")));\n        },\n\n        _templateColumns: function() {\n            return grep(this.columns, is(\"template\"));\n        },\n\n        _flushCache: function() {\n            if (this.options.$angular && this._templateColumns().length) {\n                this._contentTree.render([]);\n                if (this._hasLockedColumns) {\n                    this._lockedContentTree.render([]);\n                }\n            }\n        },\n\n        _render: function(options) {\n            var that = this;\n            options = options || {};\n            options = that._renderOptions(options);\n            var messages = this.options.messages;\n            var pageable = that._isPageable();\n            var dataSource = that.dataSource;\n\n            var maps = { children: (options.filteredChildrenMap || options.childrenMap), ids: options.idsMap };\n            var dataMaps = pageable ? (maps && maps.children && maps.ids ? maps : dataSource._initDataMaps(dataSource._getData())) : {};\n            var childrenMap = dataMaps.children;\n            var idsMap = dataMaps.ids;\n            options.childrenMap = childrenMap;\n            options.idsMap = idsMap;\n\n            var data = that._dataToRender(options);\n            var level = that._renderedModelLevel(data[0], options);\n            var uidAttr = kendo.attr(\"uid\");\n            var hasFooterTemplate;\n            var selected = this.select().removeClass(\"k-selected\").map(function(_, row) {\n                return $(row).attr(uidAttr);\n            });\n            var viewChildrenMap;\n\n            this._absoluteIndex = 0;\n\n            this._angularItems(\"cleanup\");\n            this._angularFooters(\"cleanup\");\n            this._flushCache();\n\n            that._clearRenderMap();\n\n            if (options.error) {\n                // root-level error message\n                this._showStatus(kendo.template(\n                    \"#: messages.requestFailed # \" +\n                    \"<button class='#= buttonClass # k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>#: messages.retry #</span></button>\"\n                )({\n                    buttonClass: [classNames.button, classNames.retry].join(\" \"),\n                    messages: messages\n                }));\n            } else if (!data.length) {\n                // no rows message\n                this._hideStatus();\n                this._showNoRecordsTemplate();\n            } else {\n                if (pageable) {\n                    viewChildrenMap = that._viewChildrenMap(options);\n                }\n\n                // render rows\n                this._hideStatus();\n\n                hasFooterTemplate = this._hasFooterTemplate();\n\n                this._contentTree.render(this._trs({\n                    columns: leafColumns(nonLockedColumns(this.columns)),\n                    editedColumn: options.editedColumn,\n                    editedColumnIndex: options.editedColumnIndex,\n                    aggregates: options.aggregates,\n                    selected: selected,\n                    data: data,\n                    childrenMap: childrenMap,\n                    viewChildrenMap: viewChildrenMap,\n                    hasFooterTemplate: hasFooterTemplate,\n                    visible: true,\n                    level: 0\n                }));\n\n                if (this._hasLockedColumns) {\n                    this._absoluteIndex = 0;\n                    this._lockedContentTree.render(this._trs({\n                        columns: leafColumns(lockedColumns(this.columns)),\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        aggregates: options.aggregates,\n                        selected: selected,\n                        data: data,\n                        childrenMap: childrenMap,\n                        viewChildrenMap: viewChildrenMap,\n                        hasFooterTemplate: hasFooterTemplate,\n                        visible: true,\n                        level: level\n                    }));\n                }\n            }\n\n            if (this._touchScroller) {\n                this._touchScroller.contentResized();\n            }\n\n            this._muteAngularRebind(function() {\n                this._angularItems(\"compile\");\n                this._angularFooters(\"compile\");\n            });\n\n            this.items().filter(function() {\n                return $.inArray($(this).attr(uidAttr), selected) >= 0;\n            })\n            .addClass(\"k-selected\");\n\n            this._syncLockedContentHeight();\n\n            that._togglePagerVisibility();\n\n            that._setExpanderElement();\n        },\n\n        _setExpanderElement: function() {\n            var that = this,\n                hiddenDivClass = 'k-grid-content-expander',\n                hiddenDiv = '<div class=\"' + hiddenDivClass + '\"></div>',\n                expander;\n\n            if (that.options.scrollable && that.wrapper.is(\":visible\")) {\n                expander = that.table.parent().children('.' + hiddenDivClass);\n                if (!that.dataSource || !that.dataSource.view().length) {\n                    if (!expander[0]) {\n                        expander = $(hiddenDiv).appendTo(that.table.parent());\n                    }\n                    if (that.thead) {\n                        expander.width(that.thead.width());\n                    }\n                } else if (expander[0]) {\n                    expander.remove();\n                }\n            }\n        },\n\n        _renderProgress: function(toggle) {\n            kendo.ui.progress(this.wrapper, toggle);\n        },\n\n        _renderOptions: function(options) {\n            options = options || {};\n            var that = this;\n            var dataMaps = that.dataSource._getDataMaps();\n            var filter = that.dataSource.filter();\n\n            if (that._isPageable()) {\n                options.childrenMap = dataMaps.children;\n                options.idsMap = dataMaps.ids;\n\n                if (filter) {\n                    options.filteredChildrenMap = dataMaps.filteredChildren;\n                }\n            }\n\n            return options;\n        },\n\n        _renderedModelLevel: function(model, options) {\n            return !this._isPageable() ? 0 : this.dataSource._pageableModelLevel(model, options);\n        },\n\n        _viewChildrenMap: function(options) {\n            options = options || {};\n            var that = this;\n            var dataSource = that.dataSource;\n            var viewChildrenMap = dataSource.childrenMap(dataSource.view());\n            var idField = dataSource._modelIdField();\n            var parentsNotInView = dataSource._parentNodesNotInView();\n            var parentNotInView;\n            var parentNotInViewId;\n            var parents;\n            var parent;\n            var parentId;\n            var child;\n            var childId;\n            var parentsCopy;\n\n            that._clearRenderMap();\n\n            for (var i = 0; i < parentsNotInView.length; i++) {\n                parentNotInView = parentsNotInView[i];\n                parentNotInViewId = parentNotInView[idField];\n\n                that._markNodeAsNonRenderable(parentNotInViewId);\n\n                viewChildrenMap[parentNotInViewId] = viewChildrenMap[parentNotInViewId] || [];\n\n                parents = dataSource._parentNodes(parentNotInView);\n\n                // copy the items to avoid mutating the original collection\n                parentsCopy = parents.slice();\n                parentsCopy.push(parentNotInView);\n\n                for (var parentIndex = 0; parentIndex < parentsCopy.length - 1; parentIndex++) {\n                    parent = parentsCopy[parentIndex];\n                    parentId = parent[idField];\n                    that._markNodeAsNonRenderable(parentId);\n                    viewChildrenMap[parentId] = viewChildrenMap[parentId] || [];\n\n                    child = parentsCopy[parentIndex + 1];\n                    childId = child[idField];\n                    that._markNodeAsNonRenderable(childId);\n                    viewChildrenMap[childId] = viewChildrenMap[childId] || [];\n\n                    if (viewChildrenMap[parentId].indexOf(child) === -1) {\n                        viewChildrenMap[parentId].unshift(child);\n                    }\n                }\n            }\n\n            return viewChildrenMap;\n        },\n\n        _clearRenderMap: function() {\n            this._skipRenderingMap = {};\n        },\n\n        _dataToRender: function(options) {\n            var that = this;\n\n            if (that._isPageable()) {\n                return that.dataSource._pageableRootNodes(options);\n            }\n\n            return that.dataSource.rootNodes();\n        },\n\n        _markNodeAsNonRenderable: function(nodeId) {\n            this._skipRenderingMap[nodeId] = true;\n        },\n\n        _adjustRowsHeight: function(table1, table2) {\n            if (!this._hasLockedColumns) {\n                return;\n            }\n\n            var rows = table1[0].rows;\n            var length = rows.length;\n            var idx;\n            var rows2 = table2[0].rows;\n            var containers = table1.add(table2);\n            var containersLength = containers.length;\n            var heights = [];\n\n            for (idx = 0; idx < length; idx++) {\n                if (!rows2[idx]) {\n                    break;\n                }\n\n                if (rows[idx].style.height) {\n                    rows[idx].style.height = rows2[idx].style.height = \"\";\n                }\n            }\n\n            for (idx = 0; idx < length; idx++) {\n                if (!rows2[idx]) {\n                    break;\n                }\n\n                var offsetHeight1 = rows[idx].offsetHeight;\n                var offsetHeight2 = rows2[idx].offsetHeight;\n                var height = 0;\n\n                if (offsetHeight1 > offsetHeight2) {\n                    height = offsetHeight1;\n                } else if (offsetHeight1 < offsetHeight2) {\n                    height = offsetHeight2;\n                }\n\n                heights.push(height);\n            }\n\n            for (idx = 0; idx < containersLength; idx++) {\n                containers[idx].style.display = \"none\";\n            }\n\n            for (idx = 0; idx < length; idx++) {\n                if (heights[idx]) {\n                    //add one to resolve row misalignment in IE\n                    rows[idx].style.height = rows2[idx].style.height = (heights[idx] + 1) + \"px\";\n                }\n            }\n\n            for (idx = 0; idx < containersLength; idx++) {\n                containers[idx].style.display = \"\";\n            }\n        },\n\n        _ths: function(columns, rowSpan) {\n            var ths = [];\n            var column, title, children, cellClasses, attr, headerContent;\n            var index;\n            var leafs;\n\n            for (var i = 0, length = columns.length; i < length; i++) {\n                column = columns[i];\n                children = [];\n                cellClasses = [classNames.header];\n\n                if (column.selectable) {\n                    leafs = leafColumns(columns);\n                    index = inArray(column, leafs);\n                    attr = {\n                        scope: \"col\",\n                        role: \"columnheader\",\n                        className: cellClasses.join(\" \")\n                    };\n\n                    if (column.headerTemplate) {\n                        title = column.headerTemplate({});\n                    }\n\n                    title = column.headerTemplate ? title : kendo.template(SELECTCOLUMNHEADERTMPL)({});\n\n\n                    if (rowSpan && !column.colSpan) {\n                        attr.rowSpan = rowSpan;\n                    }\n\n                    if (index > -1) {\n                        attr[kendo.attr(\"index\")] = index;\n                    }\n\n                    children.push(kendoHtmlElement(title));\n\n                    ths.push(kendoDomElement(\"th\", $.extend(true, {}, attr, column.headerAttributes), children));\n                    continue;\n                }\n\n                if (column.headerTemplate) {\n                    title = column.headerTemplate({});\n                } else {\n                    title = column.title || column.field || \"\";\n                }\n\n                if (column.headerTemplate) {\n                    headerContent = kendoHtmlElement(title);\n                } else {\n                    headerContent = kendoTextElement(title);\n                }\n\n                if (this.options.sortable) {\n                    children.push(kendoDomElement(\"span\", { className: classNames.headerCellInner }, [\n                        kendoDomElement(\"span\", { className: classNames.link }, [\n                            kendoDomElement(\"span\", { className: classNames.columnTitle }, [\n                                headerContent\n                            ])\n                        ])\n                    ]));\n                } else {\n                    children.push(headerContent);\n                }\n\n                attr = {\n                    \"data-field\": column.field,\n                    \"data-title\": column.title,\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {},\n                    className: cellClasses.join(\" \"),\n                    \"role\": \"columnheader\"\n                };\n\n                if (!column.columns) {\n                    attr.rowSpan = rowSpan ? rowSpan : 1;\n                }\n\n                if (column.headerAttributes) {\n                    if (column.headerAttributes.colSpan === 1) {\n                        delete column.headerAttributes.colSpan;\n                    }\n                    if (column.headerAttributes[\"class\"]) {\n                        attr.className += \" \" + column.headerAttributes[\"class\"];\n                        delete column.headerAttributes[\"class\"];\n                    }\n                }\n\n                if (column[\"data-index\"] > -1) {\n                    attr[\"data-index\"] = column[\"data-index\"];\n                }\n\n                attr = extend(true, {}, attr, column.headerAttributes);\n\n                ths.push(kendoDomElement(\"th\", attr, children));\n            }\n\n            return ths;\n        },\n\n        _cols: function(columns) {\n            var cols = [];\n            var width, attr;\n\n            for (var i = 0; i < columns.length; i++) {\n                if (columns[i].hidden === true) {\n                    continue;\n                }\n\n                width = columns[i].width;\n                attr = {};\n\n                if (width && parseInt(width, 10) !== 0) {\n                    attr.style = {\n                        width: typeof width === \"string\" ? width : width + \"px\"\n                    };\n                }\n\n                cols.push(kendoDomElement(\"col\", attr));\n            }\n\n            return cols;\n        },\n\n        _clearColsCache: function() {\n            this._headerColsTree.render([]);\n            if (this.options.scrollable) {\n                this._contentColsTree.render([]);\n            }\n            if (this._hasLockedColumns) {\n                this._lockedHeaderColsTree.render([]);\n                this._lockedContentColsTree.render([]);\n            }\n        },\n\n        _renderCols: function() {\n            var columns = nonLockedColumns(this.columns);\n            this._headerColsTree.render(this._cols(leafColumns(columns)));\n\n            if (this.options.scrollable) {\n                this._contentColsTree.render(this._cols(leafColumns(columns)));\n            }\n\n            if (this._hasLockedColumns) {\n                columns = lockedColumns(this.columns);\n                this._lockedHeaderColsTree.render(this._cols(leafColumns(columns)));\n                this._lockedContentColsTree.render(this._cols(leafColumns(columns)));\n            }\n        },\n\n        _retrieveFirstColumn: function(columns, rows) {\n            var result = $();\n\n            if (rows.length && columns[0]) {\n                var column = columns[0];\n\n                while (column.columns && column.columns.length) {\n                    column = column.columns[0];\n                    rows = rows.filter(\":not(:first)\");\n                }\n\n                result = result.add(rows);\n            }\n\n            return result;\n        },\n\n        _updateFirstColumnClass: function() {\n            var that = this;\n            var columns = that.columns || [];\n            var tr = that.thead.find(\">tr:not(:first, .k-filter-row)\");\n            var rows;\n\n            columns = nonLockedColumns(columns);\n\n            rows = that._retrieveFirstColumn(columns, tr);\n\n            if (that.lockedHeader) {\n                tr = that.lockedHeader.find(\"thead>tr:not(.k-filter-row):not(:first)\");\n                columns = lockedColumns(that.columns);\n\n                rows = rows.add(that._retrieveFirstColumn(columns, tr));\n            }\n\n            rows.each(function() {\n                var ths = $(this).find(\"th\");\n                ths.removeClass(\"k-first\");\n                ths.eq(0).addClass(\"k-first\");\n            });\n        },\n\n        _updateRowSpans: function(rows) {\n            for (var i = rows.length - 1; i >= 0; i--) {\n                var included = visibleChildColumns(rows[i].cells).length > 0;\n\n                if (included) {\n                    rows[i].rowSpan = rows.length - i;\n                }\n            }\n        },\n\n        _setColumnDataIndexes: function(columns) {\n            for (var i = 0; i < columns.length; i++) {\n               columns[i][\"data-index\"] = i;\n            }\n        },\n\n        _updateColumnCellIndex: function() {\n            var header;\n            var offset = 0;\n\n            if (this.lockedHeader) {\n                header = this.lockedHeader.find(\"thead\");\n                offset = updateCellIndex(header, lockedColumns(this.columns));\n            }\n            updateCellIndex(this.thead, nonLockedColumns(this.columns), offset);\n        },\n\n        _setParentsVisibility: function(column, visible) {\n            var columns = this.columns;\n            var idx;\n            var parents = [];\n            var parent;\n\n            var predicate = visible ?\n                function(p) { return visibleColumns(p.columns).length && p.hidden; } :\n                function(p) { return !visibleColumns(p.columns).length && !p.hidden; };\n\n\n            if (columnParents(column, columns, parents) && parents.length) {\n                for (idx = parents.length - 1; idx >= 0; idx--) {\n                    parent = parents[idx];\n\n                    if (predicate(parent)) {\n                        parent.hidden = !visible;\n                    }\n                }\n            }\n        },\n\n        _prepareColumns: function(rows, columns, parentCell, parentRow, parentColumn) {\n            var row = parentRow || rows[rows.length - 1];\n\n            var childRow = rows[row.index + 1];\n            var totalColSpan = 0;\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                var cell = $.extend({}, columns[idx], { headerAttributes: columns[idx].headerAttributes || {} } );\n                row.cells.push(cell);\n\n                if (columns[idx].columns && columns[idx].columns.length) {\n                    if (!childRow) {\n                        childRow = { rowSpan: 0, cells: [], index: rows.length };\n                        rows.push(childRow);\n                    }\n                    if (columns[idx].columns.length) {\n                        cell.headerAttributes.colSpan = visibleChildColumns(columns[idx].columns).length || 1;\n                        cell.headerAttributes[\"data-colspan\"] = leafColumns(columns[idx].columns).length;\n                    }\n                    this._prepareColumns(rows, columns[idx].columns, cell, childRow, columns[idx]);\n                    if (!cell.hidden) {\n                        totalColSpan += cell.headerAttributes.colSpan - 1;\n                    }\n                    row.rowSpan = rows.length - row.index;\n                }\n                columns[idx].rowIndex = row.index;\n                if (parentColumn) {\n                    columns[idx].parentColumn = parentColumn;\n                }\n                columns[idx].cellIndex = row.cells.length - 1;\n            }\n            if (parentCell) {\n                parentCell.headerAttributes.colSpan += totalColSpan;\n            }\n        },\n\n        _renderHeaderTree: function(tree, columns, hasMultiColumnHeaders) {\n            var idx;\n            var rows = [];\n            var rowsToRender = [];\n            var filterThs = [];\n\n            if (hasMultiColumnHeaders) {\n                rows = [{ rowSpan: 1, cells: [], index: 0 }];\n                this._prepareColumns(rows, columns);\n                this._updateRowSpans(rows);\n                for (idx = 0; idx < rows.length; idx++) {\n                    rowsToRender.push(kendoDomElement(\"tr\", { \"role\": \"row\" }, this._ths(rows[idx].cells, rows[idx].rowSpan)));\n                }\n            } else {\n                rowsToRender.push(kendoDomElement(\"tr\", { \"role\": \"row\" }, this._ths(columns)));\n            }\n\n            if (this._hasFilterRow()) {\n                this._filterThs(columns, filterThs);\n                rowsToRender.push(kendoDomElement(\"tr\", { \"class\": \"k-filter-row\" }, filterThs));\n            }\n\n            tree.render(rowsToRender);\n        },\n\n        _renderHeader: function() {\n            var columns = nonLockedColumns(this.columns);\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n            this._setColumnDataIndexes(leafColumns(this.columns));\n            this._renderHeaderTree(this._headerTree, columns, hasMultiColumnHeaders);\n\n            if (this._hasLockedColumns) {\n                columns = lockedColumns(this.columns);\n                this._renderHeaderTree(this._lockedHeaderTree, columns, hasMultiColumnHeaders);\n\n                this._applyLockedContainersWidth();\n                this._syncLockedHeaderHeight();\n            }\n            this._updateFirstColumnClass();\n        },\n\n        _filterThs: function(columns, ths) {\n            var column;\n            var attr;\n            var uidAttr = kendo.attr('uid');\n\n            for (var i = 0, length = columns.length; i < length; i++) {\n                column = columns[i];\n\n                if (column.columns) {\n                    this._filterThs(column.columns, ths);\n                }\n\n                if (column.columns && column.columns.length) {\n                    continue;\n                }\n\n                attr = {\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n                };\n                attr[uidAttr] = column.headerAttributes.id;\n                ths.push(kendoDomElement(\"th\", attr));\n            }\n        },\n\n        _updateFilterThs: function(before, column, refColumn) {\n            var columns = leafColumns([column]);\n            var filterRowThs = $(this.lockedHeader).add(this.thead).find(\"tr.k-filter-row th\");\n            var refIndex;\n            var currIndex;\n            var uidAttr = kendo.attr('uid');\n\n            function thIndex(ths, uid) {\n                for (var i = 0; i < ths.length; i++) {\n                    if (ths.eq(i).attr(uidAttr) === uid) {\n                        return i;\n                    }\n                }\n            }\n\n            for (var i = columns.length - 1; i >= 0; i--) {\n                column = columns[i];\n                currIndex = thIndex(filterRowThs, column.headerAttributes.id);\n                refIndex = thIndex(filterRowThs, refColumn.headerAttributes.id);\n                filterRowThs.eq(currIndex)[before ? \"insertBefore\" : \"insertAfter\"](filterRowThs.eq(refIndex));\n            }\n        },\n\n        _applyLockedContainersWidth: function() {\n            if (!this._hasLockedColumns) {\n                return;\n            }\n\n            var lockedWidth = columnsWidth(this.lockedHeader.find(\">table>colgroup>col\"));\n\n            var headerTable = this.thead.parent();\n            var nonLockedWidth = columnsWidth(headerTable.find(\">colgroup>col\"));\n\n            var wrapperWidth = this.wrapper[0].clientWidth;\n            var scrollbar = kendo.support.scrollbar();\n\n            if (lockedWidth >= wrapperWidth) {\n                lockedWidth = wrapperWidth - 3 * scrollbar;\n            }\n\n            this.lockedHeader\n                .add(this.lockedContent)\n                .width(lockedWidth);\n\n            headerTable.add(this.table).width(nonLockedWidth);\n\n            var width = wrapperWidth - lockedWidth;\n            this.content.width(width - 1);\n            headerTable.parent().width(width - scrollbar - 2);\n        },\n\n        _trs: function(options) {\n            var that = this;\n            var model, attr, className, hasChildren, childNodes, i, length;\n            var modelId;\n            var rows = [];\n            var level = options.level;\n            var data = options.data;\n            var dataSource = this.dataSource;\n            var aggregates = dataSource.aggregates() || {};\n            var idField = dataSource._modelIdField();\n            var parentIdField = dataSource._modelParentIdField();\n            var columns = options.columns;\n            var pageable = that._isPageable();\n            var childrenMap = options.childrenMap || dataSource.childrenMap(dataSource._getData());\n\n            for (i = 0, length = data.length; i < length; i++) {\n                className = [];\n\n                model = data[i];\n                modelId = model[idField];\n\n                childNodes = pageable ? childrenMap[modelId] : (model.loaded() ? dataSource.childNodes(model) : []);\n                hasChildren = childNodes && childNodes.length;\n\n                attr = { \"role\": \"row\" };\n\n                attr[kendo.attr(\"uid\")] = model.uid;\n\n                if (hasChildren) {\n                    attr[\"aria-expanded\"] = !!model.expanded;\n                }\n\n                if (options.visible) {\n                    if (!pageable || (pageable && !that._skipRenderingMap[modelId])) {\n                        if (this._absoluteIndex % 2 !== 0) {\n                            className.push(classNames.alt);\n                        }\n\n                        this._absoluteIndex++;\n                    }\n                } else {\n                    attr.style = { display: \"none\" };\n                }\n\n                if ($.inArray(model.uid, options.selected) >= 0) {\n                    className.push(classNames.selected);\n                }\n\n                if (hasChildren) {\n                    className.push(classNames.group);\n                }\n\n                if (model._edit) {\n                    className.push(\"k-grid-edit-row\");\n                }\n\n                attr.className = className.join(\" \");\n\n                if (!that._skipRenderingMap[modelId]) {\n                    var row;\n                    var rowOptions = {\n                        model: model,\n                        attr: attr,\n                        level: pageable ? that._renderedModelLevel(model, options) : level,\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        hasChildren: hasChildren,\n                        visible: options.visible,\n                        isAlt: this._absoluteIndex % 2 === 0\n                    };\n\n                    if (that.options.rowTemplate) {\n                        row = this. _trFromTemplate(rowOptions);\n                    } else {\n                        row = this._tds(rowOptions, columns, this._td.bind(this));\n                    }\n\n                    rows.push(row);\n                }\n\n\n                if (hasChildren && (that.options.renderAllRows || !!model.expanded)) {\n                    if (pageable) {\n                        // render the child nodes in the paged view only\n                        childNodes = (options.viewChildrenMap || {})[modelId] || [];\n                    }\n\n                    if (childNodes.length === 0) {\n                        continue;\n                    }\n\n                    rows = rows.concat(this._trs({\n                        columns: columns,\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        aggregates: aggregates,\n                        selected: options.selected,\n                        visible: pageable ? options.visible : (options.visible && !!model.expanded),\n                        data: childNodes,\n                        childrenMap: options.childrenMap || childrenMap,\n                        hasFooterTemplate: options.hasFooterTemplate,\n                        viewChildrenMap: options.viewChildrenMap,\n                        level: level + 1\n                    }));\n                }\n            }\n\n            if (options.hasFooterTemplate && model) {\n                attr = {\n                    className: classNames.footerTemplate,\n                    \"data-parentId\": model[parentIdField]\n                };\n\n                if (!options.visible) {\n                    attr.style = { display: \"none\" };\n                }\n\n                rows.push(this._tds({\n                    model: aggregates[model[parentIdField]],\n                    attr: attr,\n                    level: level,\n                    editedColumn: options.editedColumn,\n                    editedColumnIndex: options.editedColumnIndex\n                }, columns, this._footerId));\n            }\n\n            return rows;\n        },\n\n        _trFromTemplate: function(options) {\n            var rowTemplate = this.options.rowTemplate;\n            var altRowTemplate = this.options.altRowTemplate;\n            var row;\n            var template;\n\n            altRowTemplate = altRowTemplate ? altRowTemplate : rowTemplate;\n\n            if (!kendo.isFunction(rowTemplate)) {\n                rowTemplate = kendo.template(rowTemplate);\n            }\n\n            if (!kendo.isFunction(altRowTemplate)) {\n                altRowTemplate = kendo.template(altRowTemplate);\n            }\n\n            if (this._absoluteIndex % 2 !== 0) {\n                template = rowTemplate(options);\n            } else {\n                template = altRowTemplate(options);\n            }\n\n            if (!$(template).length) {\n                return kendoTextElement(template);\n            }\n\n            row = this.parseRowTemplate($(template)[0], options);\n\n            return row;\n        },\n\n        parseRowTemplate: function(element, options) {\n            var nodeName = element.nodeName.toLocaleLowerCase();\n            var childNodes = element.childNodes;\n            var children = [];\n            var currElement;\n            var attributes;\n\n            attributes = this.parseAttributes(element);\n\n            for (var i = 0; i < childNodes.length; i++) {\n                if (!/\\S/.test(childNodes[i].nodeValue)) {\n                   continue;\n                }\n                if (childNodes[i].nodeName.toLocaleLowerCase() === \"td\") {\n                    children.push(this._createCellElement(childNodes[i]));\n                }\n            }\n\n            if (options && !options.visible) {\n               attributes.style = attributes.style || {};\n               attributes.style = $.extend(true, attributes.style, { display: \"none\" });\n            }\n\n            if (this._isTextNode(nodeName)) {\n                currElement = kendoTextElement(element.nodeValue);\n            } else {\n                currElement = kendoDomElement(nodeName, attributes, children);\n            }\n\n            return currElement;\n        },\n\n        _createCellElement: function(element) {\n            var attributes = this.parseAttributes(element);\n            var spaceElements = $(element).find('.' + classNames.iconHidden).remove();\n            var iconElement = $(element).find('.' + classNames.iconExpand + ',.' + classNames.iconCollapse).remove()[0];\n            var children = [];\n\n            for (var i = 0; i < spaceElements.length; i++) {\n                children.push(kendoDomElement(\"span\", this.parseAttributes(spaceElements[i])));\n            }\n\n            if (iconElement) {\n                children.push(kendoDomElement(\"span\", this.parseAttributes(iconElement)));\n            }\n            children.push(kendoHtmlElement($(element).html()));\n\n            return kendoDomElement(\"td\", attributes, children);\n        },\n\n        parseAttributes: function(element) {\n            if (this._isTextNode(element.nodeName)) {\n                return null;\n            }\n\n            element = $(element)[0];\n            var attributes = element.attributes;\n            var length = attributes.length;\n            var result = {};\n\n            for (var i = 0; i < length; i++) {\n                result[attributes[i].name] = attributes[i].value;\n            }\n\n            return result;\n        },\n\n        _isTextNode: function(nodeName) {\n            return nodeName.indexOf('text') >= 0;\n        },\n\n        _footerId: function(options) {\n            var content = [];\n            var column = options.column;\n            var template = options.column.footerTemplate || $.noop;\n            var aggregates = options.model[column.field] || {};\n            var attr = {\n                \"role\": \"gridcell\",\n                \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n            };\n\n            if (column.expandable) {\n                content = content.concat(createPlaceholders({\n\n                    level: options.level + 1,\n                    className: classNames.iconPlaceHolder\n                }));\n            }\n\n            if (column.attributes) {\n                extend(true, attr, column.attributes, {\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n                });\n            }\n\n            content.push(kendoHtmlElement(template(aggregates) || \"\"));\n\n            return kendoDomElement(\"td\", attr, content);\n        },\n\n        _hasFooterTemplate: function() {\n            return !!grep(leafColumns(this.columns), function(c) {\n                return c.footerTemplate;\n            }).length;\n        },\n\n        _tds: function(options, columns, renderer) {\n            var children = [];\n            var column;\n            var editedColumnField = (options.editedColumn || {}).field;\n            var incellEditing = this._isIncellEditable();\n            var length = columns.length;\n\n            for (var i = 0; i < length; i++) {\n                column = columns[i];\n\n                var col = renderer({\n                    model: options.model,\n                    column: column,\n                    editColumn: !incellEditing || (incellEditing && column.field === editedColumnField && options.editedColumnIndex === i),\n                    level: options.level\n                });\n\n                children.push(col);\n            }\n\n            return kendoDomElement(\"tr\", options.attr, children);\n        },\n\n        _td: function(options) {\n            var children = [];\n            var model = options.model;\n            var column = options.column;\n            var iconClass;\n            var attr = {\n                \"role\": \"gridcell\",\n                \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n            };\n            var incellEditing = this._isIncellEditable();\n            var columnHasEditCommand = false;\n\n            if (column.attributes) {\n                extend(true, attr, column.attributes);\n            }\n\n            if (!!column.headerAttributes && !!column.headerAttributes.id) {\n                attr[\"aria-describedby\"] = column.headerAttributes.id;\n            }\n\n            if (model._edit && column.field && options.editColumn && (incellEditing || (!incellEditing && isColumnEditable(column, model)))) {\n                attr[kendo.attr(\"container-for\")] = column.field;\n\n                if (incellEditing) {\n                    if (attr.className && attr.className.indexOf(classNames.editCell) !== -1) {\n                        attr.className += \" \" + classNames.editCell;\n                    } else if (!attr.className) {\n                        attr.className = classNames.editCell;\n                    }\n                }\n            } else {\n                if (column.expandable) {\n                    children = createPlaceholders({ level: options.level, className: classNames.iconPlaceHolder });\n                    iconClass = [classNames.icon];\n\n                    if (model.hasChildren) {\n                        iconClass.push(model.expanded ? classNames.iconCollapse : classNames.iconExpand);\n                    } else {\n                        iconClass.push(classNames.iconHidden);\n                    }\n\n                    if (model._error) {\n                        iconClass.push(classNames.refresh);\n                    } else if (!model.loaded() && model.expanded) {\n                        iconClass.push(classNames.loading);\n                        attr[\"aria-busy\"] = true;\n                    }\n\n                    children.push(kendoDomElement(\"span\", { className: iconClass.join(\" \") }));\n\n                    attr.style[\"white-space\"] = \"nowrap\";\n                }\n\n                if (isDirtyColumn(column, model)) {\n                    if (attr.className) {\n                        attr.className += classNames.dirtyCell;\n                    } else if (!attr.className) {\n                        attr.className = classNames.dirtyCell;\n                    }\n                }\n\n                if (column.command) {\n                    if (attr.className && attr.className.indexOf(\"k-command-cell\") !== -1 ) {\n                        attr.className += \" k-command-cell\";\n                    } else if (!attr.className) {\n                        attr.className = \"k-command-cell\";\n                    }\n\n                    columnHasEditCommand = grep(column.command, function(command) {\n                        return command === EDIT || command.name === EDIT;\n                    }).length > 0;\n\n                    if (model._edit && !this._isIncellEditable() && columnHasEditCommand) {\n                        children = this._buildCommands([\"update\", \"canceledit\"]);\n                    } else {\n                        children = this._buildCommands(column.command);\n                    }\n                } else {\n                    children.push(this._cellContent(column, model));\n                }\n\n                attr.className = [attr[\"class\"], attr.className].join(\" \").trim();\n            }\n\n            return kendoDomElement(\"td\", attr, children);\n        },\n\n        _cellContent: function(column, model) {\n            var that = this;\n            var value;\n            var incellEditing = that._isIncellEditable();\n            var dirtyIndicator;\n\n            if (column.selectable) {\n                return kendoHtmlElement(SELECTCOLUMNTMPL);\n            }\n\n            if (column.template) {\n                value = that._evalColumnTemplate(column, model);\n            } else if (column.field) {\n                value = model.get(column.field);\n                dirtyIndicator = incellEditing ? column.dirtyIndicatorTemplate(model) : \"\";\n                if (value !== null && !isUndefined(value)) {\n                    if (column.format) {\n                        value = kendo.format(column.format, value);\n                    }\n\n                    value = dirtyIndicator + value;\n                } else {\n                    value = dirtyIndicator;\n                }\n            } else if (value === null || isUndefined(value)) {\n                value = \"\";\n            }\n\n            if (column.template || !column.encoded) {\n                return kendoHtmlElement(value);\n            } else {\n                if (incellEditing) {\n                    return kendoHtmlElement(value);\n                } else {\n                    return kendoTextElement(value);\n                }\n            }\n        },\n\n        _evalColumnTemplate: function(column, model) {\n            if (this._isIncellEditable()) {\n                return column.dirtyCellTemplate(model);\n            } else {\n                return column.template(model);\n            }\n        },\n\n        _createDirtyColumnTemplate: function(column) {\n            var that = this;\n            var templateSettings = that._customTemplateSettings();\n            var columnTemplateAlias = \"#=this.columnTemplate(\" + templateSettings.paramName + \")#\";\n\n            var templateString = that._dirtyIndicatorTemplate(column.field) + columnTemplateAlias;\n            var templateFunction = kendoTemplate(templateString, templateSettings).bind({ columnTemplate: column.template });\n\n            return templateFunction;\n        },\n\n        _createIndicatorTemplate: function(column) {\n            var dirtyIndicatorTemplate = this._dirtyIndicatorTemplate(column.field);\n\n            return kendoTemplate(dirtyIndicatorTemplate);\n        },\n\n        _dirtyIndicatorTemplate: function(field) {\n            var that = this;\n            var dirtyField;\n            var templateSettings = that._customTemplateSettings();\n            var paramName = templateSettings.paramName;\n\n            if (field && paramName) {\n                dirtyField = field.charAt(0) === \"[\" ? kendo.expr(field, paramName + \".dirtyFields\") : paramName + \".dirtyFields['\" + field + \"']\";\n\n                return \"#= \" + paramName + \" && \" + paramName + \".dirty && \" + paramName + \".dirtyFields && \" + dirtyField +\n                        \" ? '<span class=\\\"k-dirty\\\"></span>' : '' #\";\n            }\n\n            return \"\";\n        },\n\n        _customTemplateSettings: function() {\n            return extend({}, kendo.Template, this.options.templateSettings);\n        },\n\n        _buildCommands: function(commands) {\n            var i, result = [];\n\n            for (i = 0; i < commands.length; i++) {\n                result.push(this._handleCommand(commands[i]));\n            }\n\n            return result;\n        },\n\n        _handleCommand: function(command) {\n            var name = (command.name || command).toLowerCase();\n            var text = this.options.messages.commands[name];\n            var icon = [];\n\n            command = extend({}, defaultCommands[name], { text: text }, command);\n\n            if (command.imageClass) {\n                icon.push(kendoDomElement(\"span\", {\n                    className: [ \"k-icon\", \"k-button-icon\", command.imageClass ].join(\" \")\n                }));\n            }\n\n            if (command.template) {\n                return kendoHtmlElement(kendo.template(command.template)({ message: command.text || this.options.messages.commands.search }));\n            } else {\n                return this._button(command, name, icon);\n            }\n        },\n\n        _button: function(command, name, icon) {\n            if (command.className && command.className.indexOf(\"k-primary\") > -1) {\n                command.className = command.className.replace(\"k-primary\", \"k-button-solid-primary\");\n            }\n\n            if (!command.className || command.className.indexOf(\"k-button-solid-primary\") === -1) {\n                command.className += \" k-button-solid-base\";\n            }\n\n            var button = kendoDomElement(\n                \"button\", {\n                    \"type\": \"button\",\n                    \"data-command\": name,\n                    className: [ \"k-button k-button-md k-rounded-md k-button-solid\", command.className ].join(\" \")\n                }, icon.concat([ kendoDomElement(\"span\", {\n                    type: \"span\",\n                    className: \"k-button-text\"\n                }, [ kendoTextElement(command.text || command.name) ]) ])\n            );\n\n            return button;\n        },\n\n        _positionResizeHandle: function(e) {\n            var th = $(e.currentTarget);\n            var resizeHandle = this.resizeHandle;\n            var position = th.position();\n            var left;\n            var rtlCorrection = 0;\n            var headerWrap;\n            var ieCorrection;\n            var webkitCorrection;\n            var firefoxCorrection;\n            var leftMargin;\n            var invisibleSpace;\n            var leftBorderWidth;\n            var scrollLeft;\n            var cellWidth = outerWidth(th);\n            var container = th.closest(\"div\");\n            var button = typeof e.buttons !== \"undefined\" ? e.buttons : (e.which || e.button);\n            var indicatorWidth = this.options.columnResizeHandleWidth || 3;\n            var halfResizeHandle = (indicatorWidth * 3) / 2;\n\n            left = cellWidth;\n\n            if (typeof button !== \"undefined\" && button !== 0) {\n                //do not create a new resize handle if a mouse button is still pressed\n                //this happens during resizing or before UserEvents trigger \"start\"\n                return;\n            }\n\n            if (!resizeHandle) {\n                resizeHandle = this.resizeHandle = $(\n                    '<div class=\"k-resize-handle\"><div class=\"k-resize-handle-inner\"></div></div>'\n                );\n            }\n\n            var cells = leafDataCells(th.closest(\"thead\")).filter(\":visible\");\n            if (isRtl) {\n                scrollLeft = kendo.scrollLeft(container);\n\n                if (browser.mozilla || (browser.webkit && browser.version >= 85)) {\n                    scrollLeft = scrollLeft * -1;\n                }\n                leftBorderWidth = parseFloat(container.css(\"borderLeftWidth\"));\n                left = th.offset().left + scrollLeft - parseFloat(th.css(\"marginLeft\")) - (container.offset().left + leftBorderWidth);\n                rtlCorrection = (left <= scrollLeft ? halfResizeHandle : 0);// when shown on first column headers are misaligned due to the width of the resize handler\n                headerWrap = th.closest(\".k-grid-header-wrap, .k-grid-header-locked\");\n                invisibleSpace = headerWrap[0].scrollWidth - headerWrap[0].offsetWidth; // the difference between the entire width and the visible area\n                leftMargin = parseFloat(headerWrap.css(\"marginLeft\"));\n                ieCorrection = browser.msie ? 2 * kendo.scrollLeft(headerWrap) + leftBorderWidth - leftMargin - rtlCorrection : 0;\n                webkitCorrection = browser.webkit && (browser.version < 85) ? (invisibleSpace - rtlCorrection - leftMargin + leftBorderWidth) : -rtlCorrection; //margin left is added due to a margin that avoids double borders\n                firefoxCorrection = browser.mozilla ? leftBorderWidth - leftMargin - rtlCorrection : 0;\n                left -= webkitCorrection + firefoxCorrection + ieCorrection;\n            } else {\n                for (var idx = 0; idx < cells.length; idx++) {\n                    if (cells[idx] == th[0]) {\n                        break;\n                    }\n                    left += cells[idx].offsetWidth;\n                }\n            }\n\n            container.append(resizeHandle);\n\n            resizeHandle\n                .show()\n                .css({\n                    top: position.top,\n                    left: left - halfResizeHandle,\n                    height: outerHeight(th),\n                    width: indicatorWidth * 3\n                })\n                .data(\"th\", th);\n\n            var that = this;\n            resizeHandle.off(\"dblclick\" + NS).on(\"dblclick\" + NS, function() {\n                //TODO handle frozen columns index\n                var index = th.index();\n                if ($.contains(that.thead[0], th[0])) {\n                    index += grep(that.columns, function(val) { return val.locked && !val.hidden; }).length;\n                }\n                that.autoFitColumn(index);\n            });\n        },\n\n        autoFitColumn: function(column) {\n            var that = this,\n                options = that.options,\n                columns = that.columns,\n                index,\n                th,\n                headerTable,\n                isLocked,\n                visibleLocked = that.lockedHeader ? leafDataCells(that.lockedHeader.find(\">table>thead\")).filter(isCellVisible).length : 0,\n                col;\n\n            //  retrieve the column object, depending on the method argument\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(columns, function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            index = inArray(column, columns);\n            isLocked = column.locked;\n\n            if (isLocked) {\n                headerTable = that.lockedHeader.children(\"table\");\n            } else {\n                headerTable = that.thead.parent();\n            }\n\n            th = headerTable.find(\"[data-index='\" + index + \"']\");\n\n            var contentTable = isLocked ? that.lockedTable : that.table,\n                footer = that.footer || $();\n\n            if (that.footer && that.lockedContent) {\n                footer = isLocked ? that.footer.children(\".k-grid-footer-locked\") : that.footer.children(\".k-grid-footer-wrap\");\n            }\n\n            var footerTable = footer.find(\"table\").first();\n\n            if (that.lockedHeader && visibleLocked >= index && !isLocked) {\n                index -= visibleLocked;\n            }\n\n            // adjust column index, depending on previous hidden columns\n            for (var j = 0; j < columns.length; j++) {\n                if (columns[j] === column) {\n                    break;\n                } else {\n                    if (columns[j].hidden) {\n                        index--;\n                    }\n                }\n            }\n\n            // get col elements\n            if (options.scrollable) {\n                col = headerTable.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index)\n                    .add(contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index))\n                    .add(footerTable.find(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index));\n            } else {\n                col = contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index);\n            }\n\n            var tables = headerTable.add(contentTable).add(footerTable);\n\n            var oldColumnWidth = outerWidth(th);\n\n            // reset the table and autofitted column widths\n            // if scrolling is disabled, we need some additional repainting of the table\n            col.width(\"\");\n            tables.css(\"table-layout\", \"fixed\");\n            col.width(\"auto\");\n            tables.addClass(\"k-autofitting\");\n            tables.css(\"table-layout\", \"\");\n\n            var newColumnWidth = Math.ceil(\n                    Math.max(\n                        outerWidth(th),\n                        outerWidth(contentTable.find(\"tr\").eq(0).children(\"td:visible\").eq(index)),\n                        outerWidth(footerTable.find(\"tr\").eq(0).children(\"td:visible\").eq(index))\n            ));\n\n            col.width(newColumnWidth);\n            column.width = newColumnWidth;\n\n            // if all visible columns have widths, the table needs a pixel width as well\n            if (options.scrollable) {\n                var cols = headerTable.find(\"col\"),\n                    colWidth,\n                    totalWidth = 0;\n                for (var idx = 0, length = cols.length; idx < length; idx += 1) {\n                    colWidth = cols[idx].style.width;\n                    if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                        totalWidth += parseInt(colWidth, 10);\n                    } else {\n                        totalWidth = 0;\n                        break;\n                    }\n                }\n\n                if (totalWidth) {\n                    tables.each(function() {\n                        this.style.width = totalWidth + \"px\";\n                    });\n                }\n            }\n\n            tables.removeClass(\"k-autofitting\");\n\n            that.trigger(COLUMNRESIZE, {\n                column: column,\n                oldWidth: oldColumnWidth,\n                newWidth: newColumnWidth\n            });\n\n            that._applyLockedContainersWidth();\n            that._syncLockedContentHeight();\n            that._syncLockedHeaderHeight();\n        },\n\n        _adjustLockedHorizontalScrollBar: function() {\n            var table = this.table,\n                content = table.parent();\n\n            var scrollbar = table[0].offsetWidth > content[0].clientWidth ? kendo.support.scrollbar() : 0;\n            this.lockedContent.height(outerHeight(content) - scrollbar);\n        },\n\n        _syncLockedContentHeight: function() {\n            if (this.lockedTable) {\n                if (!this._touchScroller) {\n                    this._adjustLockedHorizontalScrollBar();\n                }\n                this._adjustRowsHeight(this.table, this.lockedTable);\n                this._syncLockedScroll();\n            }\n        },\n\n        _syncLockedHeaderHeight: function() {\n            if (this.lockedHeader) {\n                var lockedTable = this.lockedHeader.children(\"table\");\n                var table = this.thead.parent();\n\n                this._adjustRowsHeight(lockedTable, table);\n\n                syncTableHeight(lockedTable, table);\n            }\n        },\n\n        _syncLockedScroll: function() {\n            if (!this.options.scrollable) {\n                return;\n            }\n            this.lockedContent[0].scrollTop = this.content[0].scrollTop;\n        },\n\n        _resizable: function() {\n            if (!this.options.resizable) {\n                return;\n            }\n\n            if (this.resizable) {\n                this.resizable.destroy();\n            }\n\n            var treelist = this;\n\n            $(this.lockedHeader).find(\"thead\").add(this.thead)\n                .on(\"mousemove\" + NS, \"tr:not(.k-filter-row) > th\", this._positionResizeHandle.bind(this));\n\n            this.resizable = new kendo.ui.Resizable(this.wrapper, {\n                handle: \".k-resize-handle\",\n                start: function(e) {\n                    var th = $(e.currentTarget).data(\"th\");\n                    var index = $.inArray(th[0], leafDataCells(th.closest(\"thead\")).filter(\":visible\"));\n                    var header, contentTable;\n\n                    treelist.wrapper.addClass(\"k-grid-column-resizing\");\n\n                    if (treelist.lockedHeader && $.contains(treelist.lockedHeader[0], th[0])) {\n                        header = treelist.lockedHeader;\n                        contentTable = treelist.lockedTable;\n                    } else {\n                        header = treelist.thead.parent();\n                        contentTable = treelist.table;\n                    }\n\n                    this.col = contentTable.children(\"colgroup\").find(\"col\").eq(index)\n                          .add(header.find(\"col\").eq(index));\n                    this.th = th;\n                    this.startLocation = e.x.location;\n                    this.columnWidth = outerWidth(th);\n                    this.table = this.col.closest(\"table\");\n                    this.totalWidth = this.table.width();\n                },\n                resize: function(e) {\n                    var rtlModifier = isRtl ? -1 : 1;\n                    var minColumnWidth = 11;\n                    var delta = (e.x.location * rtlModifier) - (this.startLocation * rtlModifier);\n\n                    if (this.columnWidth + delta < minColumnWidth) {\n                        delta = minColumnWidth - this.columnWidth;\n                    }\n\n                    this.table.width(this.totalWidth + delta);\n                    this.col.width(this.columnWidth + delta);\n                },\n                resizeend: function() {\n                    treelist.wrapper.removeClass(\"k-grid-column-resizing\");\n\n                    var field = this.th.attr(\"data-field\");\n                    var column = grep(leafColumns(treelist.columns), function(c) {\n                        return c.field == field;\n                    });\n                    var newWidth = Math.floor(outerWidth(this.th));\n\n                    column[0].width = newWidth;\n                    treelist._resize();\n                    treelist._syncLockedContentHeight();\n                    treelist._syncLockedHeaderHeight();\n                    treelist.trigger(COLUMNRESIZE, {\n                        column: column,\n                        oldWidth: this.columnWidth,\n                        newWidth: newWidth\n                    });\n\n                    this.table = this.col = this.th = null;\n                }\n            });\n        },\n\n        _sortable: function() {\n            var columns;\n            var column;\n            var sortableInstance;\n            var cells;\n            var cell, idx, length;\n            var sortable = this.options.sortable;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (!sortable) {\n                return;\n            }\n\n            if (hasMultiColumnHeaders) {\n                if (this.lockedHeader) {\n                    cells = sortCells(leafDataCells(this.lockedHeader.find(\">table>thead\")).add(leafDataCells(this.thead)));\n                } else {\n                    cells = leafDataCells(this.thead);\n                }\n            } else {\n                cells = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n            columns = leafColumns(this.columns);\n\n            for (idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (column.sortable !== false && !column.command && column.field && !column.selectable) {\n                    cell = cells.eq(idx);\n\n                    sortableInstance = cell.data(\"kendoColumnSorter\");\n                    if (sortableInstance) {\n                        sortableInstance.destroy();\n                    }\n\n                    cell.kendoColumnSorter(\n                            extend({}, sortable, column.sortable, {\n                                dataSource: this.dataSource\n                            })\n                        );\n                }\n            }\n        },\n\n        _filterable: function() {\n            var cells;\n            var filterable = this.options.filterable;\n            var idx;\n            var length;\n            var columns;\n            var column;\n            var cell;\n            var filterMenuInstance;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (!filterable || this.options.columnMenu) {\n                return;\n            }\n\n            var filterInit = (function(e) {\n                this.trigger(FILTERMENUINIT, { field: e.field, container: e.container });\n            }).bind(this);\n\n            var filterOpen = (function(e) {\n                this.trigger(FILTERMENUOPEN, { field: e.field, container: e.container });\n            }).bind(this);\n\n            if (hasMultiColumnHeaders) {\n                if (this.lockedHeader) {\n                    cells = leafDataCells(this.lockedHeader.find(\">table>thead\").add(this.thead));\n                } else {\n                    cells = leafDataCells(this.thead);\n                }\n            } else {\n                cells = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n            columns = leafColumns(this.columns);\n\n            if (filterable && typeof filterable.mode == STRING && filterable.mode.indexOf(\"menu\") == -1) {\n                filterable = false;\n            }\n\n            if (!filterable) {\n                return;\n            }\n\n            for (idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n                cell = cells.eq(idx);\n\n                filterMenuInstance = cell.data(\"kendoFilterMenu\");\n                if (filterMenuInstance) {\n                    filterMenuInstance.destroy();\n                }\n\n                if (column.command || column.filterable === false || column.selectable) {\n                    continue;\n                }\n\n                cell.kendoFilterMenu(extend(true, {}, filterable, column.filterable, {\n                    dataSource: this.dataSource,\n                    init: filterInit,\n                    open: filterOpen,\n                    appendTo: DOT + classNames.headerCellInner\n                }));\n            }\n        },\n\n        _filterRow: function() {\n            var that = this;\n            if (!that._hasFilterRow()) {\n               return;\n            }\n\n            var settings;\n            var $angular = that.options.$angular;\n            var uidAttr = kendo.attr('uid');\n            var columns = leafColumns(that.columns),\n                filterable = that.options.filterable,\n                filterHandler = function(e) {\n                    if (that.trigger(\"filter\", { filter: e.filter, field: e.field })) {\n                        e.preventDefault();\n                    }\n                },\n                existingInstance;\n\n            for (var i = 0; i < columns.length; i++) {\n                var suggestDataSource,\n                    col = columns[i],\n                    operators = that.options.filterable.operators,\n                    customDataSource = false,\n                    th = this.wrapper.find('.k-grid-header .k-filter-row th[' + uidAttr + '=\"' + col.headerAttributes.id + '\"]'),\n                    field = col.field,\n                    parentColumn = col.parentColumn;\n\n                delete col.parentColumn;\n\n                if (field && col.filterable !== false) {\n                    var cellOptions = col.filterable && col.filterable.cell || {};\n                    existingInstance = th.find('.k-filtercell').data('kendoFilterCell');\n\n                    if (existingInstance) {\n                        existingInstance.destroy();\n                        th.empty();\n                    }\n\n                    suggestDataSource = that.options.dataSource;\n                    if (suggestDataSource instanceof DataSource) {\n                        suggestDataSource = that.options.dataSource.options;\n                    }\n\n                    var messages = extend(true, {}, filterable.messages);\n                    if (col.filterable) {\n                        extend(true, messages, col.filterable.messages);\n                    }\n\n                    if (cellOptions.enabled === false) {\n                        th.html(\"&nbsp;\");\n                        continue;\n                    }\n                    if (cellOptions.dataSource) {\n                        suggestDataSource = cellOptions.dataSource;\n                        customDataSource = true;\n                    }\n                    if (col.filterable && col.filterable.operators) {\n                        operators = col.filterable.operators;\n                    }\n\n                    settings = {\n                        column: col,\n                        dataSource: that.dataSource,\n                        suggestDataSource: suggestDataSource,\n                        customDataSource: customDataSource,\n                        field: field,\n                        messages: messages,\n                        values: col.values,\n                        template: cellOptions.template,\n                        delay: cellOptions.delay,\n                        inputWidth: cellOptions.inputWidth,\n                        suggestionOperator: cellOptions.suggestionOperator,\n                        minLength: cellOptions.minLength,\n                        dataTextField: cellOptions.dataTextField,\n                        operator: cellOptions.operator,\n                        operators: operators,\n                        showOperators: cellOptions.showOperators,\n                        change: filterHandler\n                    };\n\n                    if ($angular) {\n                        settings.$angular = $angular;\n                    }\n\n                    $(\"<span/>\").attr(kendo.attr(\"field\"), field)\n                        .appendTo(th)\n                        .kendoFilterCell(settings);\n                    col.parentColumn = parentColumn;\n                } else {\n                    th.html(\"&nbsp;\");\n                }\n            }\n        },\n\n        _hasFilterRow: function() {\n            var filterable = this.options.filterable;\n            var hasFiltering = filterable &&\n                    typeof filterable.mode == STRING &&\n                    filterable.mode.indexOf(\"row\") != -1;\n            var columns = this.columns;\n            var columnsWithoutFiltering = $.grep(columns, function(col) {\n                return col.filterable === false;\n            });\n\n            if (columns.length && columnsWithoutFiltering.length == columns.length) {\n                hasFiltering = false;\n            }\n\n            return hasFiltering;\n        },\n\n        _change: function() {\n            var that = this;\n            var selectedValues;\n\n            if (that._checkBoxSelection) {\n                selectedValues = that.selectable.value();\n                that._uncheckCheckBoxes();\n                that._checkRows(selectedValues);\n                if (selectedValues.length && selectedValues.length === that.items().length) {\n                    that._toggleHeaderCheckState(true);\n                } else {\n                    that._toggleHeaderCheckState(false);\n                }\n            }\n            this.trigger(CHANGE);\n        },\n\n        _isLocked: function() {\n            return this.lockedHeader !== null;\n        },\n\n        _selectable: function() {\n            var that = this;\n            var selectable = this.options.selectable;\n            var filter;\n            var element = this.table;\n            var useAllItems;\n            var isLocked = that._isLocked();\n            var multi;\n            var cell;\n\n            if (selectable) {\n                selectable = kendo.ui.Selectable.parseOptions(selectable);\n\n                if (this._hasLockedColumns) {\n                    element = element.add(this.lockedTable);\n                    useAllItems = selectable.multiple && selectable.cell;\n                }\n\n                filter = \">tbody>tr:not(.k-footer-template)\";\n\n                if (selectable.cell) {\n                    filter = filter + \">td\";\n                }\n\n                this.selectable = new kendo.ui.Selectable(element, {\n                    filter: filter,\n                    aria: true,\n                    multiple: selectable.multiple,\n                    change: this._change.bind(this),\n                    useAllItems: useAllItems,\n                    continuousItems: this._continuousItems.bind(this, filter, selectable.cell),\n                    relatedTarget: !selectable.cell && this._hasLockedColumns ? this._selectableTarget.bind(this) : undefined\n                });\n\n                if (that.options.navigatable) {\n                    multi = selectable.multiple;\n                    cell = selectable.cell;\n\n                    element.on(\"keydown\" + NS, function(e) {\n                        var current = that.current();\n                        var target = e.target;\n                        if (e.keyCode === keys.SPACEBAR && !e.shiftKey && $.inArray(target, element) > -1 &&\n                            !current.is(\".k-header\")) {\n\n                                e.preventDefault();\n                                e.stopPropagation();\n                                current = cell ? current : current.parent();\n\n                                if (isLocked && !cell) {\n                                    current = current.add(that._relatedRow(current));\n                                }\n\n                                if (multi) {\n                                    if (!e.ctrlKey) {\n                                        that.selectable.clear();\n                                    } else {\n                                        if (current.hasClass(classNames.selected)) {\n                                            current.removeClass(classNames.selected);\n                                            that.trigger(CHANGE);\n                                            return;\n                                        }\n                                    }\n                                } else {\n                                    that.selectable.clear();\n                                }\n                                if (!cell) {\n                                    that.selectable._lastActive = current;\n                                }\n\n                                that.selectable.value(current);\n                        } else if (!cell && ((e.shiftKey && e.keyCode == keys.LEFT) ||\n                                    (e.shiftKey && e.keyCode == keys.RIGHT) ||\n                                    (e.shiftKey && e.keyCode == keys.UP) ||\n                                    (e.shiftKey && e.keyCode == keys.DOWN) ||\n                                    (e.keyCode === keys.SPACEBAR && e.shiftKey))) {\n\n                            e.preventDefault();\n                            e.stopPropagation();\n                            current = current.parent();\n\n                            if (isLocked) {\n                                current = current.add(that._relatedRow(current));\n                            }\n\n                            if (multi) {\n                                if (!that.selectable._lastActive) {\n                                    that.selectable._lastActive = current;\n                                }\n                                that.selectable.selectRange(that.selectable._firstSelectee(), current);\n                            } else {\n                                that.selectable.clear();\n                                that.selectable.value(current);\n                            }\n                        }\n                    });\n                }\n            }\n        },\n\n        _continuousItems: function(filter, cell) {\n            if (!this.lockedContent) {\n                return;\n            }\n\n            var lockedItems = $(filter, this.lockedTable);\n            var nonLockedItems = $(filter, this.table);\n            var columns = cell ? lockedColumns(this.columns).length : 1;\n            var nonLockedColumns = cell ? this.columns.length - columns : 1;\n            var result = [];\n\n            for (var idx = 0; idx < lockedItems.length; idx += columns) {\n                push.apply(result, lockedItems.slice(idx, idx + columns));\n                push.apply(result, nonLockedItems.splice(0, nonLockedColumns));\n            }\n\n            return result;\n        },\n\n        _selectableTarget: function(items) {\n            var related;\n            var result = $();\n            for (var idx = 0, length = items.length; idx < length; idx ++) {\n                related = this._relatedRow(items[idx]);\n\n                if (inArray(related[0], items) < 0) {\n                    result = result.add(related);\n                }\n            }\n\n            return result;\n        },\n\n        _relatedRow: function(row) {\n            var lockedTable = this.lockedTable;\n            row = $(row);\n\n            if (!lockedTable) {\n                return row;\n            }\n\n            var table = row.closest(this.table.add(this.lockedTable));\n            var index = table.find(\">tbody>tr\").index(row);\n\n            table = table[0] === this.table[0] ? lockedTable : this.table;\n\n            return table.find(\">tbody>tr\").eq(index);\n        },\n\n        select: function(value) {\n            var that = this;\n            var selectable = this.selectable;\n\n            if (that._checkBoxSelection) {\n                if (value) {\n                    that._checkRows(value);\n                    if (that.select().length === that.items().length) {\n                        that._toggleHeaderCheckState(true);\n                    }\n                }\n\n                return that.items().filter(\".\" + SELECTED);\n            }\n\n            if (!selectable) {\n                return $();\n            }\n\n            if (typeof value !== \"undefined\") {\n                if (!selectable.options.multiple) {\n                    selectable.clear();\n\n                    value = value.first();\n                }\n\n                if (this._hasLockedColumns) {\n                    value = value.add($.map(value, this._relatedRow.bind(this)));\n                }\n            }\n\n            return selectable.value(value);\n        },\n\n        clearSelection: function() {\n            var that = this;\n\n            if (that.selectable && !that._checkBoxSelection) {\n                that.selectable.clear();\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.select(), true);\n                return;\n            }\n        },\n\n        _uncheckCheckBoxes: function() {\n            var that = this;\n            var tables = that.table.add(that.lockedTable);\n\n            tables.find(\"tbody \" + CHECKBOXINPUT).attr(\"aria-checked\", false)\n                .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n\n        },\n\n        _deselectCheckRows: function(items, preventChange) {\n            var that = this;\n            items = that.table.add(that.lockedTable).find(items);\n\n            if (that._isLocked()) {\n                items = items.add(items.map(function() {\n                    return that._relatedRow(this);\n                }));\n            }\n\n            items.each(function() {\n                $(this).removeClass(SELECTED).find(CHECKBOXINPUT).attr(\"aria-checked\", false)\n                    .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n            });\n            that._toggleHeaderCheckState(false);\n\n            if (!preventChange) {\n                that.trigger(CHANGE);\n            }\n        },\n\n        _headerCheckboxClick: function(e) {\n            var that = this,\n                checkBox = $(e.target),\n                checked = checkBox.prop(\"checked\"),\n                parentGrid = checkBox.closest(\".k-grid.k-widget\").getKendoTreeList();\n\n            if (that !== parentGrid) {\n                return;\n            }\n\n            if (checked) {\n                that.select(parentGrid.items());\n            } else {\n                that.clearSelection();\n            }\n            that.trigger(CHANGE);\n        },\n\n        _checkboxClick: function(e) {\n            var that = this,\n                row = $(e.target).closest(\"tr\"),\n                isSelecting = !row.hasClass(SELECTED),\n                dataItem = that.dataItem(row),\n                children = [],\n                selector = \"\";\n\n            if (that !== row.closest(\".k-grid.k-widget\").getKendoTreeList()) {\n                return;\n            }\n\n            if (that._includeChildren) {\n                that.dataSource.allChildNodes(dataItem, children);\n\n                for (var i = 0; i < children.length; i++) {\n                    selector += \"tr[data-uid='\" +\tchildren[i].uid + \"'],\";\n                }\n            }\n\n            selector += \"tr[data-uid='\" +\tdataItem.uid + \"']\";\n            row = $(selector);\n\n            if (isSelecting) {\n                that.select(row);\n                that.trigger(CHANGE);\n            } else {\n                that._deselectCheckRows(row);\n            }\n        },\n\n        _checkRows: function(items) {\n            items.each(function() {\n                $(this).addClass(SELECTED).find(CHECKBOXINPUT).prop(\"checked\", true)\n                    .attr(\"aria-label\", \"Deselect row\").attr(\"aria-checked\", true);\n            });\n        },\n\n        _toggleHeaderCheckState: function(checked) {\n            var that = this;\n            if (checked) {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", true).attr(\"aria-checked\", true)\n                    .attr(\"aria-label\", \"Deselect all rows\");\n            } else {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", false).attr(\"aria-checked\", false)\n                    .attr(\"aria-label\", \"Select all rows\");\n            }\n        },\n\n        _dataSource: function(dataSource) {\n            var that = this;\n            var ds = this.dataSource;\n            var pageable = that.options.pageable;\n\n            if (ds) {\n                ds.unbind(CHANGE, this._refreshHandler);\n                ds.unbind(ERROR, this._errorHandler);\n                ds.unbind(SORT, this._sortHandler);\n                ds.unbind(PROGRESS, this._progressHandler);\n            }\n\n            this._refreshHandler = this.refresh.bind(this);\n            this._errorHandler = this._error.bind(this);\n            this._sortHandler = this._clearSortClasses.bind(this);\n            this._progressHandler = this._progress.bind(this);\n\n\n            if (isPlainObject(dataSource)) {\n                extend(dataSource, { table: that.table, fields: that.columns });\n\n                if (isPlainObject(pageable) && pageable.pageSize !== undefined) {\n                    dataSource.pageSize = pageable.pageSize;\n                }\n            }\n\n            ds = this.dataSource = TreeListDataSource.create(dataSource);\n\n            if (pageable) {\n                ds._collapsedTotal = undefined;\n            }\n\n            ds.bind(CHANGE, this._refreshHandler);\n            ds.bind(ERROR, this._errorHandler);\n            ds.bind(SORT, this._sortHandler);\n            ds.bind(PROGRESS, this._progressHandler);\n\n            this._dataSourceFetchProxy = (function() {\n                this.dataSource.fetch();\n            }).bind(this);\n        },\n\n        setDataSource: function(dataSource) {\n            this._dataSource(dataSource);\n            this._sortable();\n            this._filterable();\n            this._filterRow();\n            this._columnMenu();\n            this._pageable();\n\n            this._contentTree.render([]);\n\n            if (this.options.autoBind) {\n                this.dataSource.fetch();\n            }\n        },\n\n        dataItem: function(element) {\n            if (element instanceof TreeListModel) {\n                return element;\n            }\n\n            var row = $(element).closest(\"tr\");\n            var uid = row.attr(kendo.attr(\"uid\"));\n            var model = isUndefined(uid) ? null : this.dataSource.getByUid(uid);\n\n            return model;\n        },\n\n        editRow: function(row) {\n            var that = this;\n            var model;\n\n            if (this._isIncellEditable() || !this.options.editable) {\n                return;\n            }\n\n            if (typeof row === STRING) {\n                row = this.tbody.find(row);\n            }\n\n            if (that._isPageable() && that._isPopupEditable() && row instanceof TreeListModel) {\n                // popup editor can be created without a rendered row\n                model = row;\n            } else {\n                model = this.dataItem(row);\n            }\n\n            if (!model) {\n                return;\n            }\n\n            if (that.editor) {\n                model._edit = true;\n                this._render();\n                this._cancelEditor();\n            } else {\n                that._preventPageSizeRestore = false;\n\n            }\n\n            if (this._editMode() != \"popup\") {\n                model._edit = true;\n            }\n\n            if (this.trigger(BEFORE_EDIT, { model: model })) {\n                that.dataSource._restorePageSizeAfterAddChild();\n                return;\n            }\n\n            this._render();\n\n            this._createEditor(model);\n\n            this.trigger(EDIT, {\n                container: this.editor.wrapper,\n                model: model\n            });\n        },\n\n        _cancelEdit: function(e) {\n            if (!this.editor) {\n                return;\n            }\n            var currentIndex;\n\n            e = extend(e, {\n                container: this.editor.wrapper,\n                model: this.editor.model\n            });\n\n            if (this.trigger(CANCEL, e)) {\n                return;\n            }\n\n            if (this.options.navigatable) {\n                currentIndex = this.items().index($(this.current()).parent());\n            }\n\n            this.cancelRow();\n\n            if (this.options.navigatable) {\n                this.current(this.items().eq(currentIndex).children().filter(NAVCELL).first());\n                focusTable(this.table, true);\n            }\n        },\n\n        cancelRow: function() {\n            if (this._isIncellEditable()) {\n                return;\n            }\n\n            this._cancelEditor();\n\n            this._render();\n        },\n\n        saveRow: function() {\n            var editor = this.editor;\n            var args;\n\n            if (this._isIncellEditable()) {\n                return;\n            }\n\n            if (!editor) {\n                return;\n            }\n\n            args = {\n                model: editor.model,\n                container: editor.wrapper\n            };\n\n            if (editor.end() && !this.trigger(SAVE, args)) {\n                this.dataSource.sync();\n            }\n        },\n\n        addRow: function(parent) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var pageable = that._isPageable();\n            var incellEditing = that._isIncellEditable();\n            var inlineEditing = that._isInlineEditable();\n            var editor = this.editor;\n            var index = 0;\n            var model = {};\n\n            if ((editor && !editor.end()) || !this.options.editable) {\n                return;\n            }\n\n            if (parent) {\n                if (!(parent instanceof TreeListModel)) {\n                    parent = this.dataItem(parent);\n                }\n\n                model[parent.parentIdField] = parent.id;\n                index = this.dataSource.indexOf(parent) + 1;\n\n                this.expand(parent)\n                    .then(function() {\n                        var showNewModelInView = pageable && dataSource._isLastItemInView(parent) && (incellEditing || inlineEditing);\n                        that._insertAt(model, index, showNewModelInView);\n                    });\n\n                return;\n            }\n\n            this._insertAt(model, index);\n        },\n\n        _insertAt: function(model, index, showNewModelInView) {\n            var that = this;\n            var dataSource = that.dataSource;\n            model = that.dataSource.insert(index, model);\n\n            if (showNewModelInView) {\n                dataSource._setAddChildPageSize();\n            }\n\n            var row = this._itemFor(model);\n            var cell;\n\n            if (that._isIncellEditable()) {\n                cell = row.children(\"td\").eq(that._firstEditableColumnIndex(row));\n                that.editCell(cell);\n            } else if (row && row[0]) {\n                that.editRow(row);\n            } else if ((that._isPageable() || that.dataSource.filter()) && (that._isPopupEditable() || that._isInlineEditable())) {\n                that.editRow(model);\n            }\n        },\n\n        _firstEditableColumnIndex: function(container) {\n            var that = this;\n            var model = that.dataItem(container);\n            var columns = leafColumns(that.columns);\n            var length = columns.length;\n            var column;\n            var idx;\n\n            for (idx = 0; idx < length; idx++) {\n                column = columns[idx];\n\n                if (model && (!model.editable || model.editable(column.field)) && !column.command && column.field && column.hidden !== true) {\n                    return idx;\n                }\n            }\n\n            return -1;\n        },\n\n        removeRow: function(row) {\n            var model = this.dataItem(row);\n            var args = {\n                model: model,\n                row: row\n            };\n\n            if (this.options.editable && model && !this.trigger(REMOVE, args)) {\n                if (document.activeElement === $(row).find(\".k-grid-delete\")[0]) {\n                    $(row).find(\".k-grid-delete\").trigger(\"blur\");\n                }\n                this.dataSource.remove(model);\n\n                if (!this._isIncellEditable()) {\n                    this.dataSource.sync();\n                }\n            }\n        },\n\n        _cancelEditor: function() {\n            var that = this;\n            var model;\n            var editor = that.editor;\n\n            if (editor) {\n                model = editor.model;\n\n                that._destroyEditor();\n\n                if (!that._isIncellEditable()) {\n                    that.dataSource.cancelChanges(model);\n                } else if (that._shouldRestorePageSize()) {\n                    that.dataSource._restorePageSizeAfterAddChild();\n                }\n\n                model._edit = false;\n            }\n\n            that._preventPageSizeRestore = false;\n        },\n\n        _shouldRestorePageSize: function() {\n            var that = this;\n            return that._isPageable() && that._isIncellEditable() && !that._preventPageSizeRestore;\n        },\n\n        _destroyEditor: function() {\n            if (!this.editor) {\n                return;\n            }\n\n            this.editor.close();\n            this.editor = null;\n        },\n\n        _createEditor: function(model) {\n            var row = this.itemFor(model);\n            var columns = leafColumns(this.columns);\n            var leafCols = [];\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                leafCols.push(extend({}, columns[idx]));\n                delete leafCols[idx].parentColumn;\n            }\n\n            row = row.add(this._relatedRow(row));\n\n            var mode = this._editMode();\n\n            var options = {\n                columns: leafCols,\n                model: model,\n                target: this,\n                clearContainer: false,\n                template: this.options.editable.template\n            };\n\n            if (mode == \"inline\") {\n                this.editor = new Editor(row, options);\n            } else {\n                extend(options, {\n                    window: this.options.editable.window,\n                    commandRenderer: (function() {\n                        return this._buildCommands([\"update\", \"canceledit\"]);\n                    }).bind(this),\n                    fieldRenderer: this._cellContent.bind(this),\n                    save: this.saveRow.bind(this),\n                    cancel: this._cancelEdit.bind(this),\n                    appendTo: this.wrapper\n                });\n\n                this.editor = new PopupEditor(row, options);\n            }\n        },\n\n        _createIncellEditor: function(cell, options) {\n            var that = this;\n            var column = extend({}, options.columns[0]);\n\n            delete column.parentColumn;\n\n            return new IncellEditor(cell, extend({}, {\n                fieldRenderer: that._cellContent.bind(that),\n                appendTo: that.wrapper,\n                clearContainer: false,\n                target: that,\n                columns: [column],\n                model: options.model,\n                change: options.change\n            }));\n        },\n\n        editCell: function(cell) {\n            var that = this;\n            cell = $(cell);\n            var column = leafColumns(that.columns)[that.cellIndex(cell)];\n            var model = that.dataItem(cell);\n\n            if (that._isIncellEditable() && model && isColumnEditable(column, model)) {\n                that._editCell(cell, column, model);\n            }\n        },\n\n        _editCell: function(cell, column, model) {\n            var that = this;\n            var editedCell;\n\n            if (that.trigger(BEFORE_EDIT, { model: model })) {\n                that.dataSource._restorePageSizeAfterAddChild();\n                return;\n            }\n\n            that.closeCell();\n\n            model._edit = true;\n\n            that._cancelEditor();\n\n            that._render({\n                editedColumn: column,\n                editedColumnIndex: cell.index()\n            });\n\n            editedCell = that.table.add(that.lockedTable).find(DOT + classNames.editCell).first();\n\n            that.editor = that._createIncellEditor(editedCell, {\n                columns: [column],\n                model: model,\n                change: function(e) {\n                    if (that.trigger(SAVE, { values: e.values, container: cell, model: model } )) {\n                        e.preventDefault();\n                    }\n\n                }\n            });\n\n            // refresh the current element as the DOM element reference can be changed after render()\n            that._current = editedCell;\n\n            that.trigger(EDIT, { container: cell, model: model });\n        },\n\n        closeCell: function(isCancel) {\n            var that = this;\n            var cell = (that.editor || {}).element;\n            var tr;\n            var model;\n\n            if (!cell || !cell[0] || !that._isIncellEditable()) {\n                return;\n            }\n\n            model = that.dataItem(cell);\n\n            if (isCancel && that.trigger(CANCEL, { container: cell, model: model })) {\n                return;\n            }\n\n            that.trigger(CELL_CLOSE, { type: isCancel ? CANCEL : SAVE, model: model, container: cell });\n\n            that._cancelEditor();\n\n            cell.removeClass(classNames.editCell);\n\n            tr = cell.parent().removeClass(classNames.editRow);\n\n            if (that.lockedContent) {\n                that._relatedRow(tr).removeClass(classNames.editRow);\n            }\n\n            that._render();\n\n            that.trigger(ITEM_CHANGE, { item: tr, data: model, ns: ui });\n\n            if (that.lockedContent) {\n                adjustRowHeight(tr.css(\"height\", \"\")[0], that._relatedRow(tr).css(\"height\", \"\")[0]);\n            }\n        },\n\n        cancelChanges: function() {\n            this.dataSource.cancelChanges();\n        },\n\n        saveChanges: function() {\n            var that = this;\n            var editable = (that.editor || {}).editable;\n            var valid = editable && editable.end();\n\n            if ((valid || !editable) && !that.trigger(SAVE_CHANGES)) {\n                that.dataSource.sync();\n            }\n        },\n\n        _editMode: function() {\n            var mode = \"inline\",\n                editable = this.options.editable;\n\n            if (editable !== true) {\n                if (typeof editable == \"string\") {\n                    mode = editable;\n                } else {\n                    mode = editable.mode || mode;\n                }\n            }\n\n            return mode.toLowerCase();\n        },\n\n        _isIncellEditable: function() {\n            return this._editMode() === INCELL;\n        },\n\n        _isInlineEditable: function() {\n            return this._editMode() === INLINE;\n        },\n\n        _isPopupEditable: function() {\n            return this._editMode() === POPUP;\n        },\n\n        hideColumn: function(column) {\n            this._toggleColumnVisibility(column, true);\n        },\n\n        showColumn: function(column) {\n            this._toggleColumnVisibility(column, false);\n        },\n\n        _toggleColumnVisibility: function(column, hidden) {\n            column = this._findColumn(column);\n\n            if (!column || column.hidden === hidden) {\n                return;\n            }\n\n            column.hidden = hidden;\n            this._setParentsVisibility(column, !hidden);\n\n            this._ensureExpandableColumn();\n            this._clearColsCache();\n            this._renderCols();\n            this._renderHeader();\n            this._render();\n\n            this._adjustTablesWidth();\n\n            this.trigger(hidden ? COLUMNHIDE : COLUMNSHOW, { column: column });\n\n            if (!hidden && !column.width) {\n                this.table\n                    .add(this.thead.closest(\"table\"))\n                    .width(\"\");\n            }\n            this._updateFirstColumnClass();\n        },\n\n        _findColumn: function(column) {\n            if (typeof column == \"number\") {\n                column = this.columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(leafColumns(this.columns), function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(leafColumns(this.columns), function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            return column;\n        },\n\n        _adjustTablesWidth: function() {\n            var idx, length;\n            var cols = this.thead.prev().children();\n            var colWidth, width = 0;\n\n            for (idx = 0, length = cols.length; idx < length; idx++ ) {\n                colWidth = cols[idx].style.width;\n                if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                    width += parseInt(colWidth, 10);\n                } else {\n                    width = 0;\n                    break;\n                }\n            }\n\n\n            if (width) {\n                this.table\n                    .add(this.thead.closest(\"table\"))\n                    .width(width);\n            }\n        },\n\n        _reorderable: function() {\n            if (!this.options.reorderable) {\n                return;\n            }\n\n            var scrollable = this.options.scrollable === true;\n            var selector = (scrollable ? \".k-grid-header:first \" : \"table:first>.k-grid-header \") + HEADERCELLS;\n            var that = this;\n\n            this._draggableInstance = new ui.Draggable(this.wrapper, {\n                group: kendo.guid(),\n                filter: selector,\n                hint: function(target) {\n                    return $('<div class=\"k-reorder-clue k-drag-clue\" />')\n                    .html(target.attr(kendo.attr(\"title\")) || target.attr(kendo.attr(\"field\")) || target.text())\n                    .prepend('<span class=\"k-icon k-drag-status k-i-cancel\" />');\n                }\n            });\n\n            this.reorderable = new ui.Reorderable(this.wrapper, {\n                draggable: this._draggableInstance,\n                dragOverContainers: this._allowDragOverContainers.bind(this),\n                inSameContainer: function(e) {\n                    return $(e.source).parent()[0] === $(e.target).parent()[0] && targetParentContainerIndex(flatColumnsInDomOrder(that.columns), that.columns, e.sourceIndex, e.targetIndex) > -1;\n                },\n                change: function(e) {\n                    var columns = flatColumnsInDomOrder(that.columns);\n                    var column = columns[e.oldIndex];\n                    var newIndex = targetParentContainerIndex(columns, that.columns, e.oldIndex, e.newIndex);\n\n                    that.trigger(COLUMNREORDER, {\n                        newIndex: newIndex,\n                        oldIndex: inArray(column, columns),\n                        column: column\n                    });\n\n                    that.reorderColumn(newIndex, column, e.position === \"before\");\n                }\n            });\n        },\n\n        _allowDragOverContainers: function(sourceIndex, targetIndex) {\n            var columns = flatColumnsInDomOrder(this.columns);\n            return columns[sourceIndex].lockable !== false && targetParentContainerIndex(columns, this.columns, sourceIndex, targetIndex) > -1;\n        },\n\n        _reorderTrees: function(destSources, destContainer, destDomTree, sources, sourcesContainer, sourcesDomTree, before, depth) {\n            var ths = $();\n            var source = sourcesContainer.find(\"tr\").eq(sources[0].rowIndex);\n            var sourceDOM = sourcesDomTree.children[sources[0].rowIndex];\n            var sourceChildren = source.children();\n            var destDomChildren;\n            var currentIndex;\n            var destColumn = before ? destSources[0] : destSources[destSources.length - 1];\n            var destRow;\n            var sourcesLeafs;\n            var destLeafs;\n            var reorderTaget;\n            var destThs;\n\n            for (var idx = 0; idx < sources.length; idx++) {\n                currentIndex = sources[idx].cellIndex;\n                ths = ths.add(sourceChildren.eq(currentIndex));\n                destDomChildren = destDomTree.children[destColumn.rowIndex].children;\n                if (destDomTree === sourcesDomTree && before) {\n                    currentIndex += idx;\n                }\n\n                destDomChildren.splice(before ? destColumn.cellIndex + idx : destColumn.cellIndex + 1 + idx, 0, sourceDOM.children[currentIndex]);\n            }\n\n            if (destDomTree === sourcesDomTree && before) {\n                sourceDOM.children.splice(sources[0].cellIndex + sources.length, sources.length);\n            } else {\n                sourceDOM.children.splice(sources[0].cellIndex, sources.length);\n            }\n            destRow = destContainer.find(\"tr\").eq(destColumn.rowIndex);\n            destThs = destRow.find(\">th.k-header\").eq(destColumn.cellIndex);\n\n            if (destThs.length && ths[0] !== destThs[0]) {\n                ths[before ? \"insertBefore\" : \"insertAfter\"](destThs);\n            }\n\n            if (depth >= sources[0].rowIndex + 1 && depth != 1) {\n                sourcesLeafs = [];\n                for (idx = 0; idx < sources.length; idx++) {\n                    if (sources[idx].columns) {\n                        sourcesLeafs = sourcesLeafs.concat(sources[idx].columns);\n                    }\n                }\n                if (!sourcesLeafs.length) {\n                    return;\n                }\n\n                destLeafs = [];\n\n                for (idx = 0; idx < destSources.length; idx++) {\n                    if (destSources[idx].columns) {\n                        destLeafs = destLeafs.concat(destSources[idx].columns);\n                    }\n                }\n\n                if (!destLeafs.length && (destContainer !== sourcesContainer || (destColumn.cellIndex - sources[0].cellIndex > 1 || sources[0].cellIndex - destColumn.cellIndex > 1))) {\n                    reorderTaget = findReorderTarget(this.columns, destColumn, sources[0], before, this.columns);\n\n                    destLeafs = [reorderTaget];\n                    if (!reorderTaget && sourcesLeafs.length && destContainer.find(\"tr\").length > sources[0].rowIndex + 1) {\n                        this._insertTree(sourcesLeafs, sourcesContainer, sourcesDomTree, destContainer, destDomTree);\n                        return;\n                    }\n                }\n\n                if (!destLeafs.length) {\n                    return;\n                }\n\n                this._reorderTrees(destLeafs, destContainer, destDomTree, sourcesLeafs, sourcesContainer, sourcesDomTree, before, depth);\n            }\n        },\n\n        _insertTree: function(columns, sourcesContainer, sourcesDomTree, destContainer, destDomTree) {\n            var leafs = [];\n            var row;\n            var ths = $();\n            var domTr;\n\n            row = sourcesContainer.find(\"tr\").eq(columns[0].rowIndex);\n            domTr = sourcesDomTree.children[columns[0].rowIndex];\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                if (columns[idx].columns) {\n                    leafs = leafs.concat(columns[idx].columns);\n                }\n                destDomTree.children[columns[0].rowIndex].children.splice(idx, 0, domTr.children[columns[idx].rowIndex]);\n                ths = ths.add(row.find(\">th.k-header\").eq(columns[idx].cellIndex));\n            }\n\n            sourcesDomTree.children[columns[0].rowIndex].children.splice(columns[0].cellIndex, columns.length);\n            destContainer.find(\"tr\").eq(columns[0].rowIndex).append(ths);\n\n            if (leafs.length) {\n                this._insertTree(leafs, sourcesContainer, sourcesDomTree, destContainer, destDomTree);\n            }\n        },\n\n        _reorderHeader: function(destColumn, column, before) {\n            var sourcesDepth = column.columns ? depth([column]) : 1;\n            var targetDepth = destColumn.columns ? depth([destColumn]) : 1;\n            var sourceLocked = isLocked(column);\n            var destLocked = isLocked(destColumn);\n            var destContainer = destLocked ? this.lockedHeader : this.thead;\n            var sourcesContainer = sourceLocked ? this.lockedHeader : this.thead;\n            var destDomTree = destLocked ? this._lockedHeaderTree : this._headerTree;\n            var sourcesDomTree = sourceLocked ? this._lockedHeaderTree : this._headerTree;\n            var rowsToAdd;\n            var destRows = destContainer.find(\"tr:not(.k-filter-row)\");\n            var destTarget;\n\n\n            if (sourcesDepth === targetDepth || sourcesDepth < destRows.length ) {\n                this._reorderTrees([destColumn], destContainer, destDomTree , [column], sourcesContainer ,sourcesDomTree, before, sourcesDepth);\n                updateRowSpans(destContainer, destDomTree);\n                removeEmptyRows(sourcesContainer, sourcesDomTree);\n            } else {\n                if (destContainer !== sourcesContainer) {\n                    rowsToAdd = sourcesDepth - destRows.length;\n\n                    destRows.each(function(idx) {\n                        var cells = this.cells;\n                        for (var i = 0; i < cells.length; i++) {\n                            if (cells[i].colSpan <= 1 && cells[i].attributes.rowspan) {\n                                destDomTree.children[idx].children[i].attr.rowSpan += rowsToAdd;\n                                cells[i].rowSpan += rowsToAdd;\n                            }\n                        }\n                    });\n\n                    for (var j = 0; j < rowsToAdd; j++) {\n                       destDomTree.children.push(kendoDomElement(\"tr\", { \"role\": \"row\" }));\n                       if (destContainer.is(\"thead\")) {\n                           destTarget = destContainer;\n                       } else {\n                          destTarget = destContainer.find(\"thead\");\n                       }\n\n                       if (this._hasFilterRow()) {\n                           $(\"<tr role='row'></tr>\").insertBefore(destTarget.find('tr.k-filter-row'));\n                       } else {\n                           destTarget.append(\"<tr role='row'></tr>\");\n                       }\n                    }\n                }\n\n                this._reorderTrees([destColumn], destContainer, destDomTree , [column], sourcesContainer ,sourcesDomTree, before, sourcesDepth);\n                removeEmptyRows(sourcesContainer, sourcesDomTree);\n             }\n        },\n\n        reorderColumn: function(destIndex, column, before) {\n            var lockChanged;\n            var parent = column.parentColumn;\n            var columns = parent ? parent.columns : this.columns;\n            var sourceIndex = inArray(column, columns);\n            var destColumn = columns[destIndex];\n            var isLocked = !!destColumn.locked;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n            var nonLockedColumnsLength = nonLockedColumns(columns).length;\n\n            if (sourceIndex === destIndex) {\n                return;\n            }\n\n            if (isLocked && !column.locked && nonLockedColumnsLength == 1) {\n                return;\n            }\n\n            if (!isLocked && column.locked && (columns.length - nonLockedColumnsLength == 1)) {\n                return;\n            }\n\n            if (before === undefined) {\n                before = destIndex < sourceIndex;\n            }\n\n            if (hasMultiColumnHeaders) {\n                this._reorderHeader(destColumn, column, before);\n            }\n\n            lockChanged = !!column.locked;\n            lockChanged = lockChanged != isLocked;\n\n            column.locked = isLocked;\n            columns.splice(before ? destIndex : destIndex + 1, 0, column);\n            columns.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n            this._setColumnDataIndexes(leafColumns(this.columns));\n            this._clearColsCache();\n            this._renderCols();\n\n            //reorder column header manually\n            if (!hasMultiColumnHeaders) {\n                var ths = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n\n                ths.eq(sourceIndex)[before ? \"insertBefore\" : \"insertAfter\"](ths.eq(destIndex));\n\n                var dom = this._headerTree.children[0].children;\n                if (this._hasLockedColumns) {\n                    dom = this._lockedHeaderTree.children[0].children.concat(dom);\n                }\n                dom.splice(before ? destIndex : destIndex + 1, 0, dom[sourceIndex]);\n                dom.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n                if (this._hasLockedColumns) {\n                    this._lockedHeaderTree.children[0].children = dom.splice(0, lockedColumns(columns).length);\n                    this._headerTree.children[0].children = dom;\n                }\n            } else {\n                if (this.lockedHeader) {\n                    columns = nonLockedColumns(this.columns);\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], columns);\n                    columns = lockedColumns(this.columns);\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], columns);\n                } else {\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], this.columns);\n                }\n            }\n            this._updateColumnCellIndex();\n            this._applyLockedContainersWidth();\n            this._syncLockedHeaderHeight();\n            this._updateFirstColumnClass();\n\n            if (this._hasFilterRow()) {\n                this._updateFilterThs(before, column, destColumn);\n            }\n\n            this.refresh();\n\n            if (!lockChanged) {\n                return;\n            }\n\n            if (isLocked) {\n                this.trigger(COLUMNLOCK, {\n                    column: column\n                });\n            } else {\n                this.trigger(COLUMNUNLOCK, {\n                    column: column\n                });\n            }\n        },\n\n        lockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length - 1;\n            this.reorderColumn(index, column, false);\n        },\n\n        unlockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length;\n            this.reorderColumn(index, column, true);\n        },\n\n        _columnMenu: function() {\n            var ths = $(this.lockedHeader).add(this.thead).find(\"th\");\n            var columns = this.columns;\n            var options = this.options;\n            var columnMenu = options.columnMenu;\n            var column, menu, menuOptions, sortable, filterable;\n            var initHandler = this._columnMenuInit.bind(this);\n            var openHandler = this._columnMenuOpen.bind(this);\n            var hasLockableColumns = grep(this.columns, function(item) {\n                return item.lockable !== false;\n            }).length > 0;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (hasMultiColumnHeaders) {\n                columns = leafColumns(columns);\n                if (this.lockedHeader) {\n                    ths = sortCells(leafDataCells(this.lockedHeader.find(\">table>thead\")).add(leafDataCells(this.thead)));\n                } else {\n                    ths = leafDataCells(this.thead);\n                }\n            } else {\n                ths = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n\n            if (!columnMenu) {\n                return;\n            }\n\n            if (typeof columnMenu == \"boolean\") {\n                columnMenu = {};\n            }\n\n            for (var i = 0; i < ths.length; i++) {\n                column = columns[i];\n                if (!column.field) {\n                    continue;\n                }\n\n                menu = ths.eq(i).data(\"kendoColumnMenu\");\n                if (menu) {\n                    menu.destroy();\n                }\n\n                sortable = false;\n                if (column.sortable !== false && columnMenu.sortable !== false && options.sortable !== false) {\n                    sortable = extend({}, options.sortable, { compare: (column.sortable || {}).compare });\n                }\n\n                filterable = false;\n                if (options.filterable && column.filterable !== false && columnMenu.filterable !== false) {\n                    filterable = extend({ pane: this.pane }, column.filterable, options.filterable);\n                }\n\n                menuOptions = {\n                    dataSource: this.dataSource,\n                    values: column.values,\n                    columns: columnMenu.columns,\n                    sortable: sortable,\n                    filterable: filterable,\n                    messages: columnMenu.messages,\n                    owner: this,\n                    closeCallback: closeCallback,\n                    init: initHandler,\n                    open: openHandler,\n                    pane: this.pane,\n                    hasLockableColumns: lockedColumns(columns).length > 0 && hasLockableColumns && !hasMultiColumnHeaders,\n                    appendTo: DOT + classNames.headerCellInner\n                };\n\n                if (options.$angular) {\n                    menuOptions.$angular = options.$angular;\n                }\n\n                ths.eq(i).kendoColumnMenu(menuOptions);\n            }\n        },\n\n        _columnMenuInit: function(e) {\n            this.trigger(COLUMNMENUINIT, { field: e.field, container: e.container });\n        },\n\n        _columnMenuOpen: function(e) {\n            this.trigger(COLUMNMENUOPEN, { field: e.field, container: e.container });\n        },\n\n        _pageable: function() {\n            var that = this,\n                wrapper,\n                pageable = that.options.pageable;\n\n            if (pageable) {\n                wrapper = that.wrapper.children(\"div.k-grid-pager\");\n\n                if (!wrapper.length) {\n                    wrapper = $('<div class=\"k-pager-wrap k-grid-pager\"/>').appendTo(that.wrapper);\n                }\n\n                that._destroyPager();\n\n                if (typeof pageable === \"object\" && pageable instanceof kendo.ui.TreeListPager) {\n                    that.pager = pageable;\n                } else if (that.dataSource && !that.dataSource.options.serverPaging) {\n                    that._createPager(wrapper);\n                }\n\n                if (that.pager) {\n                    that.pager.bind(PAGE_CHANGE, function(e) {\n                        if (that.trigger(PAGE, { page: e.index })) {\n                            e.preventDefault();\n                        }\n                    });\n                }\n            }\n        },\n\n        _createPager: function(element, options) {\n            var that = this;\n\n            that.pager = new TreeListPager(element, extend({}, that.options.pageable, {\n                dataSource: that.dataSource,\n                navigatable: that.options.navigatable\n            }, options));\n        },\n\n        _destroyPager: function() {\n            if (this.pager) {\n                this.pager.destroy();\n                this.pager = null;\n            }\n        },\n\n        _isPageable: function() {\n            var that = this;\n            return that.options.pageable && (!that.dataSource || (that.dataSource && that.dataSource._isPageable()));\n        },\n\n        _togglePagerVisibility: function() {\n            var that = this;\n            var pageable = that.options.pageable;\n\n            if (pageable && (isPlainObject(pageable) || pageable instanceof TreeListPager) && pageable.alwaysVisible === false) {\n                that.wrapper.find(\".k-grid-pager\").toggle((that.dataSource.collapsedTotal() || 0) >= that.dataSource.pageSize());\n            }\n        }\n    });\n\n    function closeCallback(element) {\n        focusTable(element.closest(\"table\"), true);\n    }\n\n    function isInputElement(element) {\n       return $(element).is(\":button,a,:input,a>.k-icon,textarea,span.k-select,span.k-icon,span.k-link,.k-input,.k-multiselect-wrap,.k-tool-icon\");\n    }\n\n    function isLocked(column) {\n        if (!column.parentColumn) {\n            return !!column.locked;\n        }\n        return !!isLocked(column.parentColumn);\n    }\n\n    function findParentColumnWithChildren(columns, index, source, rtl) {\n        var target;\n        var locked = !!source.locked;\n        var targetLocked;\n\n        do {\n            target = columns[index];\n            index += rtl ? 1 : -1;\n            targetLocked = !!target.locked;\n        } while (target && index > -1 && index < columns.length && target != source && !target.columns && targetLocked === locked);\n\n        return target;\n    }\n\n    function findReorderTarget(columns, target, source, before, masterColumns) {\n        if (target.columns) {\n            target = target.columns;\n            return target[before ? 0 : target.length - 1];\n        } else {\n            var parent = columnParent(target, columns);\n            var parentColumns;\n\n            if (parent) {\n                parentColumns = parent.columns;\n            } else {\n                parentColumns = columns;\n            }\n\n            var index = inArray(target, parentColumns);\n            if (index === 0 && before && parentColumns.length !== 1) {\n                index++;\n            } else if (index == parentColumns.length - 1 && !before && index !== 0) {\n                index--;\n            } else if (index > 0 || (index === 0 && !before && index !== 0)) {\n                index += before ? -1 : 1;\n            }\n\n            var sourceIndex = inArray(source, parentColumns);\n            target = findParentColumnWithChildren(parentColumns, index, source, sourceIndex > index);\n            var targetIndex = inArray(target, masterColumns);\n            if (target.columns && (!targetIndex || targetIndex === parentColumns.length - 1)) {\n                return null;\n            }\n\n            if (target && target != source && target.columns) {\n                return findReorderTarget(columns, target, source, before, masterColumns);\n            }\n        }\n        return null;\n    }\n\n    function leafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (!columns[idx].columns) {\n                result.push(columns[idx]);\n                continue;\n            }\n            result = result.concat(leafColumns(columns[idx].columns));\n        }\n\n        return result;\n    }\n\n    function getColumnsFields(columns) {\n        var result = [];\n        columns = leafColumns(columns);\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (typeof columns[idx] === \"string\") {\n                result.push(columns[idx]);\n            } else if (columns[idx].field) {\n                result.push(columns[idx].field);\n            }\n        }\n        return result;\n    }\n\n    function visibleChildColumns(columns) {\n        return grep(columns, function(column) {\n            return !column.hidden;\n        });\n    }\n\n    function isVisible(column) {\n        return visibleColumns([column]).length > 0;\n    }\n\n    function visibleColumns(columns) {\n        return grep(columns, function(column) {\n            var result = !column.hidden;\n            if (result && column.columns) {\n                result = visibleColumns(column.columns).length > 0;\n            }\n            return result;\n        });\n    }\n\n    function normalizeColumns(columns, hide, parentIds) {\n        return map(columns, function(column) {\n            var hidden;\n\n            column.parentIds = parentIds;\n\n            if (!isVisible(column) || hide) {\n                hidden = true;\n            }\n\n            var uid = kendo.guid();\n            column.headerAttributes = extend({ headers: parentIds }, column.headerAttributes);\n            if (!column.headerAttributes || !column.headerAttributes.id) {\n                column.headerAttributes = extend({ id: uid }, column.headerAttributes);\n            } else {\n                uid = column.headerAttributes.id;\n            }\n\n            if (column.columns) {\n                column.columns = normalizeColumns(column.columns, hidden, parentIds ? (parentIds + \" \" + uid) : uid);\n            }\n            return extend({ hidden: hidden }, column);\n        });\n    }\n\n    function flatColumnsInDomOrder(columns) {\n        var result = flatColumns(lockedColumns(columns));\n        return result.concat(flatColumns(nonLockedColumns(columns)));\n    }\n\n    function targetParentContainerIndex(flatColumns, columns, sourceIndex, targetIndex) {\n        var column = flatColumns[sourceIndex];\n        var target = flatColumns[targetIndex];\n\n        var parent = columnParent(column, columns);\n        columns = parent ? parent.columns : columns;\n\n        return inArray(target, columns);\n    }\n\n    function parentColumnsCells(cell) {\n        var container = cell.closest(\"table\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr\");\n        var level = headerRows.index(row);\n        if (level > 0) {\n            var parent = headerRows.eq(level - 1);\n            var parentCellsWithChildren = parent.find(\"th\").filter(function() {\n                return !$(this).attr(\"rowspan\");\n            });\n\n            var offset = 0;\n            var index = row.find(\"th\").index(cell);\n\n            var prevCells = cell.prevAll().filter(function() {\n                return this.colSpan > 1;\n            });\n\n            for (var idx = 0; idx < prevCells.length; idx++) {\n                offset += prevCells[idx].colSpan || 1;\n            }\n\n            index += Math.max(offset - 1, 0);\n\n            offset = 0;\n            for (idx = 0; idx < parentCellsWithChildren.length; idx++) {\n                var parentCell = parentCellsWithChildren.eq(idx);\n                if (parentCell.attr(\"data-colspan\")) {\n                    offset += parentCell[0].getAttribute(\"data-colspan\");\n                } else {\n                    offset += 1;\n                }\n                if (index >= idx && index < offset) {\n                    result = parentColumnsCells(parentCell).add(result);\n                    break;\n                }\n            }\n        }\n        return result;\n    }\n\n    function childColumnsCells(cell) {\n        var container = cell.closest(\"thead\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr\");\n        var level = headerRows.index(row) + cell[0].rowSpan;\n        var colSpanAttr = kendo.attr(\"colspan\");\n\n        if (level <= headerRows.length - 1) {\n            var child = row.next();\n            var prevCells = cell.prevAll();\n\n            var idx;\n\n            prevCells = prevCells.filter(function() {\n                return !this.rowSpan || this.rowSpan === 1;\n            });\n\n            var offset = 0;\n\n            for (idx = 0; idx < prevCells.length; idx++) {\n                offset += parseInt(prevCells.eq(idx).attr(colSpanAttr), 10) || 1;\n            }\n\n            var cells = child.find(\"th\");\n            var colSpan = parseInt(cell.attr(colSpanAttr), 10) || 1;\n\n            idx = 0;\n\n            while (idx < colSpan) {\n                child = cells.eq(idx + offset);\n                result = result.add(childColumnsCells(child));\n                var value = parseInt(child.attr(colSpanAttr), 10);\n                if (value > 1) {\n                    colSpan -= value - 1;\n                }\n                idx++;\n            }\n        }\n\n        return result;\n    }\n\n    function columnParent(column, columns) {\n        var parents = [];\n        columnParents(column, columns, parents);\n        return parents[parents.length - 1];\n    }\n\n    function columnParents(column, columns, parents) {\n        parents = parents || [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (column === columns[idx]) {\n                return true;\n            } else if (columns[idx].columns) {\n                var inserted = parents.length;\n                parents.push(columns[idx]);\n                if (!columnParents(column, columns[idx].columns, parents)) {\n                    parents.splice(inserted, parents.length - inserted);\n                } else {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    function flatColumns(columns) {\n        var result = [];\n        var children = [];\n        for (var idx = 0; idx < columns.length; idx++) {\n            result.push(columns[idx]);\n            if (columns[idx].columns) {\n                children = children.concat(columns[idx].columns);\n            }\n\n        }\n        if (children.length) {\n            result = result.concat(flatColumns(children));\n        }\n        return result;\n    }\n\n    function columnPosition(column, columns, row, cellCounts) {\n        var result;\n        var idx;\n\n        row = row || 0;\n        cellCounts = cellCounts || {};\n        cellCounts[row] = cellCounts[row] || 0;\n\n        for (idx = 0; idx < columns.length; idx++) {\n           if (columns[idx] == column) {\n                result = { cell: cellCounts[row], row: row };\n                break;\n           } else if (columns[idx].columns) {\n               result = columnPosition(column, columns[idx].columns, row + 1, cellCounts);\n               if (result) {\n                    break;\n               }\n           }\n\n           cellCounts[row]++;\n        }\n        return result;\n    }\n\n    function updateCellIndex(thead, columns, offset) {\n        offset = offset || 0;\n\n        var position;\n        var cell;\n        var allColumns = columns;\n        columns = leafColumns(columns);\n\n        var cells = {};\n        var rows = thead.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        for (var idx = 0, length = columns.length; idx < length; idx++) {\n            position = columnPosition(columns[idx], allColumns);\n\n            if (!cells[position.row]) {\n                cells[position.row] = rows.eq(position.row)\n                    .find(\".k-header\")\n                    .filter(filter);\n            }\n\n            cell = cells[position.row].eq(position.cell);\n            cell.attr(kendo.attr(\"index\"), offset + idx);\n        }\n\n        return columns.length;\n    }\n\n    function depth(columns) {\n        var result = 1;\n        var max = 0;\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].columns) {\n                var temp = depth(columns[idx].columns);\n                if (temp > max) {\n                    max = temp;\n                }\n            }\n        }\n        return result + max;\n    }\n\n    function lockedColumns(columns) {\n        return grep(columns, is(\"locked\"));\n    }\n\n    function nonLockedColumns(columns) {\n        return grep(columns, not(is(\"locked\")));\n    }\n\n    function updateRowSpans(container, containerDOMtree) {\n        var rows = container.find(\"tr:not(.k-filter-row)\");\n        var length = rows.length;\n\n        rows.each(function(idx) {\n            var cells = this.cells;\n            for (var i = 0; i < cells.length; i++) {\n                if (cells[i].colSpan <= 1 && cells[i].attributes.rowspan) {\n                    containerDOMtree.children[idx].children[i].attr.rowSpan = length - idx;\n                    cells[i].rowSpan = length - idx;\n                }\n            }\n        });\n    }\n\n    function removeEmptyRows(container, containerDOMtree) {\n        var rows = container.find(\"tr\");\n        var emptyRows = [];\n\n        rows.filter(function(idx) {\n            var shouldRemove = !$(this).children().length;\n            if (shouldRemove) {\n                emptyRows.push(idx);\n\n            }\n            return shouldRemove;\n        }).remove();\n\n        for (var i = emptyRows.length - 1; i >= 0; i--) {\n            containerDOMtree.children.splice(emptyRows[i], 1);\n        }\n\n        updateRowSpans(container, containerDOMtree);\n    }\n\n    function focusTable(table, direct) {\n      if (direct === true) {\n         table = $(table);\n         var scrollTop, scrollLeft;\n         scrollTop = table.parent().scrollTop();\n         scrollLeft = kendo.scrollLeft(table.parent());\n\n        kendo.focusElement(table);\n\n        kendo.scrollLeft(table.parent().scrollTop(scrollTop), scrollLeft);\n\n      } else {\n         $(table).one(\"focusin\", function(e) { e.preventDefault(); }).trigger(\"focus\");\n      }\n    }\n\n    function adjustRowHeight(row1, row2) {\n       var height;\n       var offsetHeight1 = row1.offsetHeight;\n       var offsetHeight2 = row2.offsetHeight;\n\n       if (offsetHeight1 > offsetHeight2) {\n           height = offsetHeight1 + \"px\";\n       } else if (offsetHeight1 < offsetHeight2) {\n           height = offsetHeight2 + \"px\";\n       }\n\n       if (height) {\n           row1.style.height = row2.style.height = height;\n       }\n    }\n\n    function isColumnEditable(column, model) {\n        if (!column || !model || !column.field || column.selectable || column.command || (column.editable && !column.editable(model))) {\n            return false;\n        }\n\n        return (column.field && model.editable && model.editable(column.field));\n    }\n\n    function isDirtyColumn(column, model) {\n        var field = (column || {}).field || \"\";\n        return (model.dirty && model.dirtyFields && model.dirtyFields[field] && isColumnEditable(column, model));\n    }\n\n    function isUndefined(value) {\n        return typeof(value) === \"undefined\";\n    }\n\n    function isNumber(value) {\n        return typeof value === \"number\" && !isNaN(value);\n    }\n\n    if (kendo.ExcelMixin) {\n        kendo.ExcelMixin.extend(TreeList.prototype);\n    }\n\n    if (kendo.PDFMixin) {\n        kendo.PDFMixin.extend(TreeList.prototype);\n\n       TreeList.prototype._drawPDF = function(progress) {\n           var treeList = this;\n\n           if (treeList.options.pdf.paperSize && treeList.options.pdf.paperSize != \"auto\") {\n               return treeList._drawPDF_autoPageBreak(progress);\n           }\n\n           var result = new $.Deferred();\n           var dataSource = treeList.dataSource;\n           var allPages = treeList.options.pdf.allPages;\n\n           this._initPDFProgress(progress);\n\n           // This group will be our document containing all pages\n           var doc = new kendo.drawing.Group();\n           var startingPage = dataSource.page();\n\n           function resolve() {\n               if (allPages && startingPage !== undefined) {\n                   dataSource.unbind(\"change\", exportPage);\n                   dataSource.one(\"change\", function() {\n                       result.resolve(doc);\n                   });\n\n                   dataSource.page(startingPage);\n               } else {\n                   result.resolve(doc);\n               }\n           }\n\n           function exportPage() {\n                treeList._drawPDFShadow({\n                    width: treeList.wrapper.width()\n                }, {\n                    avoidLinks: treeList.options.pdf.avoidLinks\n                })\n                .done(function(group) {\n                    var pageNum = dataSource.page();\n                    var totalPages = allPages ? dataSource.totalPages() : 1;\n\n                    var args = {\n                        page: group,\n                        pageNumber: pageNum,\n                        progress: pageNum / totalPages,\n                        totalPages: totalPages\n                    };\n\n                    progress.notify(args);\n                    doc.append(args.page);\n\n                    if (pageNum < totalPages) {\n                        dataSource.page(pageNum + 1);\n                    } else {\n                        resolve();\n                    }\n                })\n                .fail(function(err) {\n                    result.reject(err);\n                });\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", exportPage);\n                dataSource.page(1);\n            } else {\n                exportPage();\n            }\n\n            return result.promise();\n        };\n\n        TreeList.prototype._initPDFProgress = function(deferred) {\n            var loading = $(\"<div class='k-loading-pdf-mask'><div class='k-loading-color'></div></div>\");\n            loading.prepend(this.wrapper.clone().css({\n                position: \"absolute\", top: 0, left: 0\n            }));\n\n            this.wrapper.append(loading);\n\n            var progressBar = $(\"<div class='k-loading-pdf-progress'>\")\n                .appendTo(loading)\n                .kendoProgressBar({\n                    type: \"chunk\",\n                    chunkCount: 10,\n                    min: 0,\n                    max: 1,\n                    value: 0\n                }).data(\"kendoProgressBar\");\n\n            deferred.progress(function(e) {\n                progressBar.value(e.progress);\n            })\n            .always(function() {\n                kendo.destroy(loading);\n                loading.remove();\n            });\n        };\n\n        TreeList.prototype._drawPDF_autoPageBreak = function(progress) {\n            var treeList = this;\n            var result = new $.Deferred();\n            var dataSource = treeList.dataSource;\n            var allPages = treeList.options.pdf.allPages;\n            var origBody = treeList.wrapper.find('table[role=\"treeList\"] > tbody');\n            var cont = $(\"<div>\")\n                .css({ position: \"absolute\", left: -10000, top: -10000 });\n            var clone = treeList.wrapper.clone().css({\n                height: \"auto\", width: \"auto\"\n            }).appendTo(cont);\n            clone.find(\".k-grid-content\").css({ height: \"auto\", width: \"auto\", overflow: \"visible\" });\n            clone.find('table[role=\"treeList\"], .k-grid-footer table').css({ height: \"auto\", width: \"100%\", overflow: \"visible\" });\n            clone.find(\".k-grid-pager, .k-grid-toolbar, .k-grouping-header\").remove();\n            clone.find(\".k-grid-header, .k-grid-footer\").css({ paddingRight: 0 });\n\n            this._initPDFProgress(progress);\n\n            var body = clone.find('table[role=\"treeList\"] > tbody').empty();\n            var startingPage = dataSource.page();\n\n            function resolve() {\n                if (allPages && startingPage !== undefined) {\n                    dataSource.one(\"change\", draw);\n                    dataSource.page(startingPage);\n                } else {\n                    treeList.refresh();\n                    draw();\n                }\n            }\n\n            function draw() {\n                cont.appendTo(document.body);\n                var options = $.extend({}, treeList.options.pdf, {\n                    _destructive: true,\n                    progress: function(p) {\n                        progress.notify({\n                            page: p.page,\n                            pageNumber: p.pageNum,\n                            progress: 0.5 + p.pageNum / p.totalPages / 2,\n                            totalPages: p.totalPages\n                        });\n                    }\n                });\n                kendo.drawing.drawDOM(clone, options)\n                    .always(function() {\n                        cont.remove();\n                    })\n                    .then(function(group) {\n                        result.resolve(group);\n                    })\n                    .fail(function(err) {\n                        result.reject(err);\n                    });\n            }\n\n            function renderPage() {\n                var pageNum = dataSource.page();\n                var totalPages = allPages ? dataSource.totalPages() : 1;\n                body.append(origBody.find(\"tr\"));\n                if (pageNum < totalPages) {\n                    dataSource.page(pageNum + 1);\n                } else {\n                    dataSource.unbind(\"change\", renderPage);\n                    resolve();\n                }\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", renderPage);\n                dataSource.page(1);\n            } else {\n                renderPage();\n            }\n\n            return result.promise();\n        };\n    }\n\n    extend(true, kendo.data, {\n        TreeListDataSource: TreeListDataSource,\n        TreeListModel: TreeListModel\n    });\n\n    ui.plugin(TreeList);\n    ui.plugin(TreeListPager);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","features","$","window","kendo","jQuery","undefined","data","kendoDom","dom","kendoDomElement","element","kendoTextElement","text","kendoHtmlElement","html","outerWidth","_outerWidth","keys","outerHeight","_outerHeight","ui","DataBoundWidget","DataSource","ObservableArray","Query","Model","browser","support","kendoTemplate","template","activeElement","_activeElement","touchDevice","touch","isArray","Array","extend","map","grep","inArray","isPlainObject","push","prototype","STRING","CHANGE","ITEM_CHANGE","ERROR","PROGRESS","DOT","NS","CLICK","INPUT","BEFORE_EDIT","EDIT","PAGE","PAGE_CHANGE","SAVE","SAVE_CHANGES","SORT","EXPAND","COLLAPSE","CELL_CLOSE","REMOVE","DATA_CELL","FILTER_CELL","DATABINDING","DATABOUND","CANCEL","TABINDEX","FILTERMENUINIT","FILTERMENUOPEN","COLUMNHIDE","COLUMNSHOW","HEADERCELLS","COLUMNREORDER","COLUMNRESIZE","COLUMNMENUINIT","COLUMNMENUOPEN","COLUMNLOCK","COLUMNUNLOCK","PARENTIDFIELD","DRAGSTART","DRAG","DROP","DRAGEND","NAVROW","NAVCELL","NAVHEADER","NORECORDSCLASS","ITEMROW","isRtl","HEIGHT","INCELL","INLINE","POPUP","TABLE","CHECKBOX","CHECKBOXINPUT","SELECTCOLUMNTMPL","SELECTCOLUMNHEADERTMPL","SELECTED","whitespaceRegExp","filterRowRegExp","RegExp","classNames","wrapper","header","button","alt","editCell","editRow","dirtyCell","group","toolbar","gridToolbar","gridHeader","gridHeaderWrap","gridContent","gridContentWrap","gridFilter","footerTemplate","focused","loading","refresh","retry","selected","status","link","filterable","icon","iconFilter","iconCollapse","iconExpand","iconHidden","iconPlaceHolder","input","dropPositions","dropTop","dropBottom","dropAdd","dropMiddle","dropDenied","dragStatus","dragClue","dragClueText","headerCellInner","columnTitle","defaultCommands","create","imageClass","className","methodName","createchild","destroy","edit","update","canceledit","cancel","save","excel","pdf","search","TreeView","Class","init","options","that","this","defaultParentId","idField","parentIdField","childrenMap","dataLength","length","dataItem","dataItemId","dataItemParentId","_childrenMap","i","idsMap","_idMap","dataMaps","_dataMaps","children","ids","rootNodes","removeCollapsedSubtreesFromRootNodes","result","prunedTree","maxDepth","Infinity","removeCollapsedSubtrees","concat","rootNode","childIdx","expanded","isUndefined","TreeQuery","TreeListModel","constructor","process","inPlace","query","sort","normalizeGroup","normalizeSort","filterCallback","filter","skip","take","total","filteredChildrenMap","view","prunedData","toArray","processFromRootNodes","range","parentId","fields","type","nullable","value","fn","call","_loaded","get","accept","set","field","initiator","loaded","shouldSerialize","is","object","not","func","base","model","TreeListDataSource","_getDataMaps","schema","modelBase","_addRange","_createNewModel","fromModel","_modelParentIdField","_isPageable","_shouldWrap","_push","operation","_readData","_getData","_data","newData","toJSON","_replaceData","source","target","sourceLength","_readAggregates","_aggregateResult","reader","aggregates","_defaultParentId","read","_modelOptions","_skip","_page","_collapsedTotal","remove","root","_removeChildData","_removeFromDataMaps","removePristine","pageable","_getChildrenMap","items","_subtree","shouldRemovePristine","removedItems","_removeItems","pushDestroy","insert","index","newModel","_insertInDataMaps","_filterCallback","item","_modelIdField","parentSubtree","parent","_parentNode","unshift","parentNode","len","_observeView","_createTreeView","_initIdsMap","_idsMap","_getIdsMap","_getFilteredChildrenMap","filteredChildren","_setFilteredChildrenMap","_initDataMaps","_initChildrenMapForParent","_defaultTreeModelOptions","modelOptions","_defaultDataItemType","ObservableObject","_calculateAggregates","subtree","pageableChildrenMap","aggregate","bind","_queryProcess","_processPageableQuery","hasLoadedChildren","hasChildren","slice","_processTreeQuery","_replaceWithObservedData","_processDataItemsState","_replaceItemsInDataMaps","dataToAggregate","_dataToAggregate","_replaceInMapWithObservedData","_calculateCollapsedTotal","firstDataItem","firstItemParents","_parentNodes","observableArray","itemType","parents","directParent","viewIndex","_insertInIdsMap","_replaceInMap","replacement","itemInArray","itemIndex","indexOf","dataToReplace","replacementArray","itemToReplace","itemToReplaceId","dataItemIndex","observableItem","_getById","at","key","_insertInChildrenMap","itemId","splice","_removeFromIdsMap","_removeFromChildrenMap","_indexInChildrenMap","_itemIndexInMap","dataMap","uid","_isLastItemInView","_defaultPageableQueryOptions","page","pageSize","serverPaging","_updateTotalForAction","action","_updateCollapsedTotalForAction","parseInt","isNumber","_setFilterTotal","filterTotal","setDefaultValue","collapsedTotal","filteredData","_dataWithoutCollapsedSubtrees","_removeCollapsedSubtrees","_processDataItemState","_queueRequest","callback","_modelLoaded","childNodes","_modelError","e","_error","success","requestParams","_observe","_total","load","method","remote","serverSorting","serverFiltering","serverGrouping","serverAggregates","defaultPromise","Deferred","resolve","promise","done","fail","contains","child","rootId","_byParentId","defaultId","current","defaults","allChildNodes","directChildren","_rootNode","_pageableRootNodes","nodesWithoutParentInView","_nodesWithoutParentInView","node","_parentNodesNotInView","parentInView","_parentInView","level","_pageableModelLevel","baseFilter","_pageableQueryOptions","_flatData","cancelChanges","_restorePageSizeAfterAddChild","_modelCanceled","_changesCanceled","_setAddChildPageSize","queryOptions","_addChildPageSize","_query","sync","then","_syncEnd","isCellVisible","style","display","sortCells","cells","indexAttr","attr","a","b","indexA","indexB","leafDataCells","container","rows","find","el","hasClass","add","last","createPlaceholders","spans","columnsWidth","cols","colWidth","width","idx","syncTableHeight","table1","table2","lockedHeigth","offsetHeight","tableHeigth","row","diff","test","height","TreeListPager","Pager","totalPages","dataSource","_filter","Math","ceil","_createDataSource","Editor","Observable","events","_fields","columns","_initContainer","createEditable","renderForm","form","Form","buttonsTemplate","formData","change","editable","Editable","clearContainer","_isEditable","column","isColumnEditable","format","editor","editorOptions","label","title","end","close","empty","removeAttr","PopupEditor","_attachHandlers","cycleForm","open","modal","resizable","draggable","visible","formContent","append","_appendTemplate","_appendButtons","Tree","render","appendTo","Window","unescape","class","commandRenderer","closeHandler","_cancelProxy","_cancel","on","_saveProxy","_save","userTriggered","_detachHandlers","off","trigger","center","IncellEditor","TreeList","_events","_dataSource","_aria","_columns","_layout","_navigatable","_selectable","_sortable","_resizable","_filterable","_filterRow","_attachEvents","_toolbar","_scrollable","_reorderable","_columnMenu","_minScreenSupport","_draggable","_pageable","autoBind","fetch","_hasLockedColumns","widget","addClass","_resizeHandler","resize","notify","reorderable","move","_dragging","HierarchicalDragAndDrop","$angular","autoScroll","holdToDrag","itemSelector","allowedContainers","hintText","separator","join","destination","dest","src","itemFromTarget","tr","closest","prevRow","prev","nextRow","next","first","sameLevel","content","dragstart","css","drag","drop","removeClass","dragend","originalSrcParentId","originalSrcIndex","position","isPrevented","insertBefore","insertAfter","dropHintContainer","eq","dropPositionFrom","dropHint","contents","dropHintElement","isAfterText","prevAll","nodeType","arguments","nodeData","referenceNode","insertAction","indexOffset","referenceNodeIndex","nodeDataIndex","originalDestIndex","destIndex","_unbindDataSource","_unbindDataChange","_destroyed","pop","_bindDataChange","_bindDataSource","_changeHandler","unbind","_refreshHandler","itemFor","tbody","_itemFor","table","lockedContent","lockedTable","scrollable","scrollables","thead","_wheelScroll","scrollLeft","scrollTop","touchScroller","movable","_touchScroller","sender","x","y","ctrlKey","delta","wheelDeltaY","lockedDiv","currentTarget","scrollHeight","clientHeight","preventDefault","one","_progress","messages","_showStatus","_render","error","isCurrentInHeader","currentIndex","_cancelEditor","_adjustHeight","navigatable","_isActiveInTable","max","cellIndex","_restoreCurrent","_checkBoxSelection","_deselectCheckRows","_angularFooters","command","footer","allAggregates","footerRows","_footerItems","_angularFooter","angular","elements","col","_items","dataItems","n","tmp","_showNoRecordsTemplate","defaultTemplate","scrollableNoGridHeightStyles","_contentTree","_lockedContentTree","noRows","message","hide","_hideStatus","_hideNoRecordsTempalte","show","contentWrap","pagerHeight","pager","scrollbar","isHeightSet","initialHeight","newHeight","offsetWidth","clientWidth","_resize","size","force","_applyLockedContainersWidth","any","hideMinScreenCols","minScreenResizeHandler","_iterateMinScreenCols","screenWidth","minWidth","minScreenWidth","hideColumn","showColumn","hidden","innerWidth","screen","_destroyColumnAttachments","_errorHandler","_progressHandler","_navigatableTables","_current","_draggableInstance","selectable","_userEvents","_destroyEditor","_destroyPager","_autoExpandable","_dataSourceFetchProxy","lockedHeader","_statusTree","_headerTree","_lockedHeaderColsTree","_lockedContentColsTree","_lockedHeaderTree","sortable","columnMenu","requestFailed","commands","hierarchy","renderAllRows","rowTemplate","altRowTemplate","getOptions","deepExtend","initialData","transport","setOptions","currentOptions","before","_setEvents","each","th","filterMenu","_toggle","expand","_isIncellEditable","closeCell","afterModelLoaded","_toggleData","_syncLockedContentHeight","always","_togglePageableData","_renderProgress","_refreshPager","collapse","_toggleChildren","event","tables","headerTables","_openHeaderMenu","_tableClick","_tableFocus","_tableBlur","_tableKeyDown","altKey","keyCode","DOWN","click","stopImmediatePropagation","td","lockedColumnOffset","leafColumns","lockedColumns","active","rowIndex","focusTable","newCurrent","_updateCurrentAttr","_scrollCurrent","_lastCellIndex","_setCurrent","tableContainer","isInLockedContainer","isInContent","scrollableContainer","_scrollTo","_relatedRow","_findCurrentCell","elementToLowercase","tagName","toLowerCase","isHorizontal","elementOffsetDir","containerScroll","containerOffsetDir","elementOffset","abs","offsetLeft","bottomDistance","ieCorrection","firefoxCorrection","msie","edge","mozilla","webkit","version","_elementId","_currentDataIndex","lockedColumnsCount","_prevVerticalCell","cellSelector","parentColumnsCells","_nextVerticalCell","childColumnsCells","rowSpan","tmpIndex","currentRowCells","hiddenColumns","_verticalContainer","up","step","floor","headerId","replace","handled","canHandle","isDefaultPrevented","UP","_moveUp","shiftKey","_moveDown","LEFT","RIGHT","_handleExpand","_moveRight","_handleCollapse","_moveLeft","PAGEDOWN","_handlePageDown","PAGEUP","_handlePageUp","ENTER","F2","_handleEnterKey","ESC","_handleEscKey","HOME","_handleHome","END","_handleEnd","TAB","_handleTabKey","stopPropagation","ctrl","rowContainer","isInLockedTable","isInBody","currentTable","has","blur","cancelRow","focusable","_handleEditing","incellEditing","cell","_tabNext","_preventPageSizeRestore","back","switchRow","nextAll","isIE","editContainer","isEdited","nextFocusableCellRowIndex","nextFocusableCellIndex","currentFocusedCellRowIndex","currentFocusedCellIndex","editedCell","opera","triggerHandler","saveRow","focus","isHeader","headerTable","isInput","isInputElement","setTimeout","_setTabIndex","retryButton","UserEvents","press","_onPress","allowSelection","_commandClick","_search","_attachCellEditingEventHandlers","icons","multiple","relatedTarget","isLockedCell","clearTimeout","_closeCellTimeout","_commandByName","j","currentName","commandName","parentsUntil","_searchTimeOut","searchFields","expression","filters","logic","getColumnsFields","operator","_ensureExpandableColumn","expandable","visibleColumns","expandableColumns","encoded","lockedCols","Error","nonLockedColumns","normalizeColumns","_columnTemplates","_columnAttributes","_includeChildren","includeChildren","_checkboxClick","_headerCheckboxClick","dirtyCellTemplate","_createDirtyColumnTemplate","dirtyIndicatorTemplate","_createIndicatorTemplate","headerTemplate","convertStyle","properties","declaration","split","trim","camelCase","attributes","headerAttributes","_clearSortClasses","layout","addBack","rtl","_initVirtualTrees","_renderCols","_renderHeader","_headerColsTree","_contentColsTree","buttons","_buildCommands","_lockedColumns","_nonLockedColumns","_templateColumns","_flushCache","_renderOptions","maps","_dataToRender","_renderedModelLevel","uidAttr","hasFooterTemplate","select","_","viewChildrenMap","_absoluteIndex","_angularItems","_clearRenderMap","buttonClass","_viewChildrenMap","_hasFooterTemplate","_trs","editedColumn","editedColumnIndex","contentResized","_muteAngularRebind","_togglePagerVisibility","_setExpanderElement","hiddenDivClass","hiddenDiv","expander","toggle","progress","parentsNotInView","parentNotInView","parentNotInViewId","childId","parentsCopy","_markNodeAsNonRenderable","parentIndex","_skipRenderingMap","nodeId","_adjustRowsHeight","rows2","containers","containersLength","heights","offsetHeight1","offsetHeight2","_ths","ths","cellClasses","headerContent","leafs","scope","role","colSpan","data-field","data-title","_cols","_clearColsCache","_retrieveFirstColumn","_updateFirstColumnClass","_updateRowSpans","included","visibleChildColumns","_setColumnDataIndexes","_updateColumnCellIndex","offset","updateCellIndex","_setParentsVisibility","predicate","p","columnParents","_prepareColumns","parentCell","parentRow","parentColumn","childRow","totalColSpan","_renderHeaderTree","tree","hasMultiColumnHeaders","rowsToRender","filterThs","_hasFilterRow","_filterThs","_syncLockedHeaderHeight","_updateFilterThs","refColumn","filterRowThs","refIndex","currIndex","thIndex","lockedWidth","nonLockedWidth","wrapperWidth","modelId","_edit","rowOptions","isAlt","_trFromTemplate","_tds","_td","data-parentId","_footerId","isFunction","parseRowTemplate","nodeName","toLocaleLowerCase","currElement","parseAttributes","nodeValue","_createCellElement","_isTextNode","spaceElements","iconElement","noop","c","renderer","editedColumnField","editColumn","iconClass","columnHasEditCommand","isDirtyColumn","_cellContent","dirtyIndicator","_evalColumnTemplate","templateSettings","_customTemplateSettings","columnTemplateAlias","paramName","templateString","_dirtyIndicatorTemplate","templateFunction","columnTemplate","dirtyField","charAt","expr","Template","_handleCommand","_button","data-command","_positionResizeHandle","resizeHandle","left","rtlCorrection","headerWrap","webkitCorrection","leftMargin","invisibleSpace","leftBorderWidth","cellWidth","which","indicatorWidth","columnResizeHandleWidth","halfResizeHandle","parseFloat","scrollWidth","top","val","locked","autoFitColumn","isLocked","visibleLocked","contentTable","footerTable","oldColumnWidth","newColumnWidth","totalWidth","oldWidth","newWidth","_adjustLockedHorizontalScrollBar","_syncLockedScroll","treelist","Resizable","handle","start","startLocation","location","columnWidth","rtlModifier","minColumnWidth","resizeend","sortableInstance","kendoColumnSorter","filterMenuInstance","filterInit","filterOpen","mode","kendoFilterMenu","settings","filterHandler","existingInstance","suggestDataSource","operators","customDataSource","cellOptions","enabled","values","delay","inputWidth","suggestionOperator","minLength","dataTextField","showOperators","kendoFilterCell","hasFiltering","columnsWithoutFiltering","_change","selectedValues","_uncheckCheckBoxes","_checkRows","_toggleHeaderCheckState","_isLocked","useAllItems","multi","Selectable","parseOptions","aria","continuousItems","_continuousItems","_selectableTarget","SPACEBAR","clear","_lastActive","selectRange","_firstSelectee","lockedItems","nonLockedItems","apply","related","clearSelection","prop","preventChange","checkBox","checked","parentGrid","getKendoTreeList","isSelecting","selector","ds","_sortHandler","setDataSource","getByUid","_isPopupEditable","_editMode","_createEditor","_cancelEdit","args","addRow","inlineEditing","_isInlineEditable","showNewModelInView","_insertAt","_firstEditableColumnIndex","removeRow","document","_shouldRestorePageSize","leafCols","fieldRenderer","_createIncellEditor","_editCell","isCancel","ns","adjustRowHeight","saveChanges","valid","_toggleColumnVisibility","_findColumn","_adjustTablesWidth","Draggable","guid","hint","prepend","Reorderable","dragOverContainers","_allowDragOverContainers","inSameContainer","targetParentContainerIndex","flatColumnsInDomOrder","sourceIndex","targetIndex","oldIndex","newIndex","reorderColumn","lockable","_reorderTrees","destSources","destContainer","destDomTree","sources","sourcesContainer","sourcesDomTree","depth","sourceDOM","sourceChildren","destDomChildren","destColumn","destRow","sourcesLeafs","destLeafs","reorderTaget","destThs","findReorderTarget","_insertTree","domTr","_reorderHeader","sourcesDepth","targetDepth","sourceLocked","destLocked","rowsToAdd","destRows","destTarget","updateRowSpans","removeEmptyRows","rowspan","lockChanged","nonLockedColumnsLength","lockColumn","unlockColumn","menu","menuOptions","initHandler","_columnMenuInit","openHandler","_columnMenuOpen","hasLockableColumns","compare","pane","owner","closeCallback","kendoColumnMenu","_createPager","alwaysVisible","findParentColumnWithChildren","targetLocked","masterColumns","columnParent","parentColumns","isVisible","parentIds","headers","flatColumns","headerRows","parentCellsWithChildren","prevCells","getAttribute","colSpanAttr","inserted","columnPosition","cellCounts","allColumns","temp","containerDOMtree","emptyRows","shouldRemove","direct","focusElement","row1","row2","dirty","dirtyFields","isNaN","ExcelMixin","PDFMixin","_drawPDF","treeList","paperSize","_drawPDF_autoPageBreak","allPages","_initPDFProgress","doc","drawing","Group","startingPage","exportPage","_drawPDFShadow","avoidLinks","pageNum","pageNumber","err","reject","deferred","clone","progressBar","kendoProgressBar","chunkCount","min","origBody","cont","overflow","paddingRight","body","draw","_destructive","drawDOM","renderPage","plugin","amd","a1","a2","a3"],"mappings":"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"}